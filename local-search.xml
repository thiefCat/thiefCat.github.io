<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CSE276A - Kalman Filter</title>
    <link href="/2025/11/08/CSE276A/CSE276A-kalman-filter/"/>
    <url>/2025/11/08/CSE276A/CSE276A-kalman-filter/</url>
    
    <content type="html"><![CDATA[<h2 id="Basis">Basis</h2><h3 id="What-is-Kalman-Filter">What is Kalman Filter</h3><p>An 1 dimensional example: We have two measurements <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> measuring a value. Each measurement has an uncertainty (standard deviation), <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\sigma_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\sigma_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. How to find the optimal estimate, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>, that best combines <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p><p>The idea is to use a weighted least squares, We want to find an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> that minimizes the “cost” function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>^</mo></mover><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">S = \sum_{i=1}^{n}w_i(\hat{x} - x_i)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. We want to give more weight to the measurement we trust more (the one with lower uncertainty), so we set <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup></mfrac></mrow><annotation encoding="application/x-tex">w_i = \frac{1}{\sigma_i^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4443em;vertical-align:-0.5992em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.6264em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1777em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5992em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>. We solve <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover><mo>=</mo><mfrac><mrow><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><mrow><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{x} = \frac{\sum w_i x_i}{\sum w_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mrow><mo fence="true">(</mo><mfrac><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\hat{x} = \left( \frac{\sigma_2^2}{\sigma_1^2 + \sigma_2^2} \right) x_1 + \left( \frac{\sigma_1^2}{\sigma_1^2 + \sigma_2^2} \right) x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4434em;vertical-align:-0.9523em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4434em;vertical-align:-0.9523em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>The new uncertainty of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>: Since <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Var</mtext><mo stretchy="false">(</mo><mi>a</mi><mo>⋅</mo><mi>X</mi><mo>+</mo><mi>b</mi><mo>⋅</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>a</mi><mn>2</mn></msup><mo>⋅</mo><mtext>Var</mtext><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>⋅</mo><mtext>Var</mtext><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Var}(a \cdot X + b \cdot Y) = a^2 \cdot \text{Var}(X) + b^2 \cdot \text{Var}(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Var</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Var</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Var</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>, we get:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>σ</mi><mover accent="true"><mi>x</mi><mo>^</mo></mover><mn>2</mn></msubsup><mo>=</mo><msup><mrow><mo fence="true">(</mo><mfrac><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msup><mrow><mo fence="true">(</mo><mfrac><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_{\hat{x}}^2 = \left( \frac{\sigma_2^2}{\sigma_1^2 + \sigma_2^2} \right)^2 \sigma_1^2 + \left( \frac{\sigma_1^2}{\sigma_1^2 + \sigma_2^2} \right)^2 \sigma_2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1111em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight">x</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord mtight">^</span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.6474em;vertical-align:-0.9523em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6951em;"><span style="top:-3.944em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.6474em;vertical-align:-0.9523em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6951em;"><span style="top:-3.944em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>σ</mi><mover accent="true"><mi>x</mi><mo>^</mo></mover><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\sigma_{\hat{x}}^2 = \frac{\sigma_1^2 \sigma_2^2}{\sigma_1^2 + \sigma_2^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1111em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight">x</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord mtight">^</span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4434em;vertical-align:-0.9523em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Rewrite the above formula as an update step:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mfrac><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{x} = x_1 + \frac{\sigma_1^2}{\sigma_1^2 + \sigma_2^2} (x_2 - x_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4434em;vertical-align:-0.9523em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><h3 id="Discrete-Kalman-Filter">Discrete Kalman Filter</h3><p><strong>In robotics case, the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the prediction of the robot’s state given previous state, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the actual measurement of robot’s state from sensor.</strong></p><h4 id="The-Process-Model">The Process Model</h4><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>=</mo><mi>F</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>G</mi><msub><mi>u</mi><mi>t</mi></msub><mo>+</mo><msub><mi>w</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t = Fs_{t-1} + Gu_t + w_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: The <strong>true state</strong> of the system at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>: It defines how the state would change if there were no control inputs. For example, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>p</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>v</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">s = \begin{bmatrix} p \\ v \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span> (where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> is position, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> is velocity), then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">p_t = p_{t-1} + v_{t-1} \cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6528em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub><mo>=</mo><msub><mi>v</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">v_t = v_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>, then</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>p</mi><mi>t</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mi>t</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} p_t \\ v_t \end{bmatrix} = \begin{bmatrix} 1 &amp; \Delta t \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} p_{t-1} \\ v_{t-1} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><msub><mi>u</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">Gu_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">u_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is control input. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span> maps that command to a change in the state. For example, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>t</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">u_t = [a]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span></span></span></span> which is acceleration, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>v</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Delta v = a \cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>p</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>a</mi><mo stretchy="false">(</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\Delta p = \frac{1}{2} a (\Delta t)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">Δ</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. As a result,</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><msub><mi>u</mi><mi>t</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Δ</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Δ</mi><mi>v</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">Gu_t = \begin{bmatrix} \Delta p \\ \Delta v \end{bmatrix} = \begin{bmatrix} \frac{1}{2} (\Delta t)^2 \\ \Delta t \end{bmatrix} \begin{bmatrix} a \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">p</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4051em;vertical-align:-0.9526em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4526em;"><span style="top:-3.6074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.4074em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9526em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: Process noise, for example, a bump in the road or wheel slippage. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>Q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(w) \sim N(0, Q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mclose">)</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> represents “How much do I distrust my system model?”.</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><mi>H</mi><msub><mi>s</mi><mi>t</mi></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">z_t = Hs_t + v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: The observation that sensor gives.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span>: For example, your state <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> might be a 6D vector (position x, y, z; velocity vx, vy, vz), but measurement <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is only a 3D vector (position x, y, z). The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> matrix would be a 3x6 matrix that just “selects” the first three components of the state.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: Measurement Noise by the sensor itself. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(v) \sim N(0, R)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span></span></span></span>. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> represents “How much do I distrust my sensor?”.</li></ul><h4 id="Kalman-Prediction">Kalman Prediction</h4><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>F</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>G</mi><msub><mi>u</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_{t|t-1} = Fs_{t-1|t-1} + Gu_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t-1|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: The corrected state after the last update.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: The new predicted state for the current time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, based only on information from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>F</mi><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msup><mi>F</mi><mi>T</mi></msup><mo>+</mo><msub><mi>Q</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t-1} = F\Sigma_{t-1|t-1}F^T + Q_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2465em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t-1|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: Uncertainty covariance matrix of last best estimate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t-1|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: New, larger predicted uncertainty for the current time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</li></ul><h4 id="Kalman-Updating">Kalman Updating</h4><p>State Update:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>K</mi><mi>t</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mi>t</mi></msub><mo>−</mo><mi>H</mi><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">s_{t|t} = s_{t|t-1} + K_t(z_t - H s_{t|t-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><ul><li>The above formula is equivalent to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>^</mo></mover><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>K</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{x} = x_1 + K(x_2 - x_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t|t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: The corrected state for time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>z</mi><mi>t</mi></msub><mo>−</mo><mi>H</mi><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(z_t - H s_{t|t-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is new measurement, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">H s_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span> is expected measurement. The difference is called “surprise”.</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>K</mi><mi>t</mi></msub><mo>=</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msup><mi>H</mi><mi>T</mi></msup><msubsup><mi>S</mi><mi>t</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">K_t = \Sigma_{t|t-1} H^T S_t^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2465em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mi>t</mi></msub><mo>=</mo><mi>H</mi><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msup><mi>H</mi><mi>T</mi></msup><mo>+</mo><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">S_t = H \Sigma_{t|t-1} H^T + R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2465em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">S_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: Equivalent to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_1^2 + \sigma_2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span> in the 1D example. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span> is predicted uncertainty (like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_1^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>), and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msup><mi>H</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">H \Sigma_{t|t-1} H^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1965em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> is the predicted uncertainty projected into the measurement space. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">R_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is measurement sensor’s uncertainty (like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>).</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">K_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>: This is the matrix version of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mfrac><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">K = \frac{\sigma_1^2}{\sigma_1^2 + \sigma_2^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7258em;vertical-align:-0.5916em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1341em;"><span style="top:-2.6264em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5102em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5916em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>.</li></ul><p>Covariance Update:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi>I</mi><mo>−</mo><msub><mi>K</mi><mi>t</mi></msub><mi>H</mi><mo stretchy="false">)</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t} = (I - K_t H) \Sigma_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">)</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span>: Corrected, smaller uncertainty (like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mover accent="true"><mi>x</mi><mo>^</mo></mover><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_{\hat{x}}^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0972em;vertical-align:-0.2831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4169em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathnormal mtight">x</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord mtight">^</span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831em;"><span></span></span></span></span></span></span></span></span></span>).</li></ul><h3 id="Extended-Kalman-Filter">Extended Kalman Filter</h3><p>The previous formula all assumed a linear world. However, in many cases, the state change is non-linear. For example, a robot’s state <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>θ</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[x, y, \theta]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">]</span></span></span></span>:</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub><mo>⋅</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">x_t = x_{t-1} + v_t \cdot \cos(\theta_{t-1}) \cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mi>t</mi></msub><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">y_t = y_{t-1} + v_t \cdot \sin(\theta_{t-1}) \cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>ω</mi><mi>t</mi></msub><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\theta_t = \theta_{t-1} + \omega_t \cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></li></ul><p>As a result, there is no way to write the relationship with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>=</mo><mi>F</mi><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>G</mi><msub><mi>u</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t = F s_{t-1} + G u_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. In this section, we will use a non-linear expression:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>w</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_t = f(s_{t-1}, u_{t-1}) + w_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><mi>h</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>v</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">z_t = h(s_t) + v_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>If the system is non-linear, we can’t use the Kalman filter. So, at every single time step, we will approximate the non-linear function with a linear one. The best linear approximation of a function at a specific point is its tangent line (or tangent plane in multi-dimensions) found by <strong>first-order Taylor series expansion</strong>.</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>≈</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>+</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>w</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_t \approx f(s_{t-1|t-1}, u_{t-1}, 0) + F(s_{t-1} - s_{t-1|t-1}) + w_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6331em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub><mo>≈</mo><mi>h</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>+</mo><mi>H</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>−</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>v</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">z_t \approx h(s_{t|t}, 0) + H(s_t - s_{t|t}) + v_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6331em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>f</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>s</mi><mi>j</mi></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F_{ij} = \frac{\partial f_i}{\partial s_j}(s_{t-1|t-1}, u_{t-1}, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4745em;vertical-align:-0.5423em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1076em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>h</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>s</mi><mi>j</mi></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H_{ij} = \frac{\partial h_i}{\partial s_j}(s_{t|t}, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4385em;vertical-align:-0.5423em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8962em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>.</p><h4 id="EKF-Prediction">EKF Prediction</h4><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">s_{t|t-1} = f(s_{t-1|t-1}, u_{t-1}, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>F</mi><mi>t</mi></msub><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msubsup><mi>F</mi><mi>t</mi><mi>T</mi></msubsup><mo>+</mo><msub><mi>Q</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t-1} = F_t \Sigma_{t-1|t-1} F_t^T + Q_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2465em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span></p><h4 id="EKF-Updating">EKF Updating</h4><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>K</mi><mi>t</mi></msub><mo>=</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msubsup><mi>H</mi><mi>t</mi><mi>T</mi></msubsup><mo stretchy="false">(</mo><msub><mi>H</mi><mi>t</mi></msub><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msubsup><mi>H</mi><mi>t</mi><mi>T</mi></msubsup><mo>+</mo><msub><mi>R</mi><mi>t</mi></msub><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">K_t = \Sigma_{t|t-1} H_t^T (H_t \Sigma_{t|t-1} H_t^T + R_t)^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2465em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>K</mi><mi>t</mi></msub><mo stretchy="false">(</mo><msub><mi>z</mi><mi>t</mi></msub><mo>−</mo><mi>h</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">s_{t|t} = s_{t|t-1} + K_t (z_t - h(s_{t|t-1}, 0))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7858em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">))</span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi>I</mi><mo>−</mo><msub><mi>K</mi><mi>t</mi></msub><msub><mi>H</mi><mi>t</mi></msub><mo stretchy="false">)</mo><msub><mi mathvariant="normal">Σ</mi><mrow><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\Sigma_{t|t} = (I - K_t H_t) \Sigma_{t|t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span></span></p>]]></content>
    
    
    <categories>
      
      <category>CSE276A</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ROS2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE276A - ROS2 TF</title>
    <link href="/2025/11/08/CSE276A/CSE276A-tf/"/>
    <url>/2025/11/08/CSE276A/CSE276A-tf/</url>
    
    <content type="html"><![CDATA[<h3 id="Introduction">Introduction</h3><p>There are many coordinate systems in the environment (e.g., robot frame, world frame, camera frame, arm frame, landmark frame). If we can get the transformation from camera to a landmark, then where is the landmark relative to the robot? The ROS2 tf system can help us do the transformation.</p><h3 id="tf2">tf2</h3><p>tf2 stores all frames in a tree structure.</p><ul><li>Each frame has only one parent frame.</li><li>A parent frame can have many children frames.</li></ul><p>This tree structure ensures there is always a single path between any two frames. If a frame is not connected to the main tree, tf2 cannot transform to it.</p><h4 id="Static-Transform-Broadcaster">Static Transform Broadcaster</h4><p>This node publishes an unchanging transform. This is perfect for fixed relationships. This node publish transforms to <code>/tf_static</code> topic.</p><div class="code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> TransformStamped<span class="hljs-keyword">from</span> tf2_ros.static_transform_broadcaster <span class="hljs-keyword">import</span> StaticTransformBroadcaster<span class="hljs-keyword">import</span> tf_transformations<span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticFramePublisher</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    This node publishes a static transform between &#x27;base_link&#x27; and &#x27;camera_link&#x27;.</span><span class="hljs-string">    &quot;&quot;&quot;</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;static_transform_broadcaster_node&#x27;</span>)        <span class="hljs-comment"># 1. Initialize the StaticTransformBroadcaster</span>        <span class="hljs-variable language_">self</span>.tf_static_broadcaster = StaticTransformBroadcaster(<span class="hljs-variable language_">self</span>)        <span class="hljs-comment"># 2. Create the TransformStamped message</span>        static_transform = TransformStamped()        static_transform.header.stamp = <span class="hljs-variable language_">self</span>.get_clock().now().to_msg()        static_transform.header.frame_id = <span class="hljs-string">&#x27;base_link&#x27;</span>  <span class="hljs-comment"># Parent frame</span>        static_transform.child_frame_id = <span class="hljs-string">&#x27;camera_link&#x27;</span> <span class="hljs-comment"># Child frame</span>        <span class="hljs-comment"># 3. Set the translation</span>        static_transform.transform.translation.x = <span class="hljs-number">0.5</span>        static_transform.transform.translation.y = <span class="hljs-number">0.0</span>        static_transform.transform.translation.z = <span class="hljs-number">0.2</span>        <span class="hljs-comment"># 4. Set the rotation</span>        q = tf_transformations.quaternion_from_euler(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># default order: (roll, pitch, yaw)</span>        static_transform.transform.rotation.x = q[<span class="hljs-number">0</span>]        static_transform.transform.rotation.y = q[<span class="hljs-number">1</span>]        static_transform.transform.rotation.z = q[<span class="hljs-number">2</span>]        static_transform.transform.rotation.w = q[<span class="hljs-number">3</span>]        <span class="hljs-comment"># 5. Publish the transform</span>        <span class="hljs-variable language_">self</span>.tf_static_broadcaster.sendTransform(static_transform)        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">&#x27;Published static transform: base_link -&gt; camera_link&#x27;</span>)</code></pre></div><h4 id="Dynamic-Transform-Broadcaster">Dynamic Transform Broadcaster</h4><div class="code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> TransformStamped<span class="hljs-keyword">from</span> tf2_ros <span class="hljs-keyword">import</span> TransformBroadcaster<span class="hljs-keyword">import</span> tf_transformations<span class="hljs-keyword">import</span> math<span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicFrameBroadcaster</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    This node publishes a dynamic transform from &#x27;odom&#x27; to &#x27;base_link&#x27;.</span><span class="hljs-string">    &quot;&quot;&quot;</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;dynamic_transform_broadcaster_node&#x27;</span>)        <span class="hljs-comment"># 1. Initialize the TransformBroadcaster</span>        <span class="hljs-variable language_">self</span>.tf_broadcaster = TransformBroadcaster(<span class="hljs-variable language_">self</span>)        <span class="hljs-comment"># 2. Create a timer to call the publish_callback function</span>        <span class="hljs-variable language_">self</span>.timer = <span class="hljs-variable language_">self</span>.create_timer(<span class="hljs-number">0.1</span>, <span class="hljs-variable language_">self</span>.publish_callback) <span class="hljs-comment"># 10 Hz</span>        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">&#x27;Publishing dynamic transform: odom -&gt; base_link&#x27;</span>)    <span class="hljs-keyword">def</span> <span class="hljs-title function_">publish_callback</span>(<span class="hljs-params">self</span>):        current_time = <span class="hljs-variable language_">self</span>.get_clock().now()                seconds, _ = <span class="hljs-variable language_">self</span>.get_clock().now().seconds_nanoseconds()                t = TransformStamped()        t.header.stamp = current_time.to_msg()        t.header.frame_id = <span class="hljs-string">&#x27;odom&#x27;</span>        t.child_frame_id = <span class="hljs-string">&#x27;base_link&#x27;</span>        t.transform.translation.x = math.sin(seconds)        t.transform.translation.y = math.cos(seconds)        t.transform.translation.z = <span class="hljs-number">0.0</span>        q = tf_transformations.quaternion_from_euler(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -seconds) <span class="hljs-comment"># (roll, pitch, yaw)</span>        t.transform.rotation.x = q[<span class="hljs-number">0</span>]        t.transform.rotation.y = q[<span class="hljs-number">1</span>]        t.transform.rotation.z = q[<span class="hljs-number">2</span>]        t.transform.rotation.w = q[<span class="hljs-number">3</span>]        <span class="hljs-variable language_">self</span>.tf_broadcaster.sendTransform(t)</code></pre></div><h4 id="Transform-Listener">Transform Listener</h4><p>This node listens to the <code>/tf</code> and <code>/tf_static</code> topics (via the buffer) and can look up any transform in the tree.</p><ul><li>The <code>tf2::Buffer</code> is is the “brain” of the operation. When you ask for odom -&gt; camera_link, it looks at its data and figures out the path, then performs all the mathematical calculations to get the final transform.</li><li>The <code>TransformListener</code> automatically subscribe to the <code>/tf</code> and <code>/tf_static</code> topics and feed all the incoming transform messages directly into the <code>tf2::Buffer</code>.</li></ul><div class="code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> rclpy.duration <span class="hljs-keyword">import</span> Duration<span class="hljs-keyword">from</span> tf2_ros <span class="hljs-keyword">import</span> TransformException<span class="hljs-keyword">from</span> tf2_ros.buffer <span class="hljs-keyword">import</span> Buffer<span class="hljs-keyword">from</span> tf2_ros.transform_listener <span class="hljs-keyword">import</span> TransformListener<span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameListener</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    This node listens to the TF tree and looks up the transform</span><span class="hljs-string">    from &#x27;odom&#x27; (target) to &#x27;camera_link&#x27; (source).</span><span class="hljs-string">    &quot;&quot;&quot;</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;tf_listener_node&#x27;</span>)        <span class="hljs-variable language_">self</span>.target_frame = <span class="hljs-string">&#x27;odom&#x27;</span>        <span class="hljs-variable language_">self</span>.source_frame = <span class="hljs-string">&#x27;camera_link&#x27;</span>        <span class="hljs-comment"># The Buffer stores incoming transforms</span>        <span class="hljs-variable language_">self</span>.tf_buffer = Buffer()        <span class="hljs-comment"># The Listener subscribes to /tf and /tf_static and fills the buffer</span>        <span class="hljs-variable language_">self</span>.tf_listener = TransformListener(<span class="hljs-variable language_">self</span>.tf_buffer, <span class="hljs-variable language_">self</span>)        <span class="hljs-variable language_">self</span>.timer = <span class="hljs-variable language_">self</span>.create_timer(<span class="hljs-number">1.0</span>, <span class="hljs-variable language_">self</span>.lookup_callback) <span class="hljs-comment"># 1 Hz</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lookup_callback</span>(<span class="hljs-params">self</span>):        target = <span class="hljs-variable language_">self</span>.target_frame        source = <span class="hljs-variable language_">self</span>.source_frame        <span class="hljs-keyword">try</span>:            <span class="hljs-comment"># Look up the transform</span>            trans = <span class="hljs-variable language_">self</span>.tf_buffer.lookup_transform(                target,                source,                rclpy.time.Time(), <span class="hljs-comment"># this parameter means finding the newest transform in the buffer</span>                timeout=Duration(seconds=<span class="hljs-number">0.5</span>)) <span class="hljs-comment"># Wait up to 0.5s for the transform, if time exceeds, throw exception</span>            <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;  Translation: [x: <span class="hljs-subst">&#123;trans.transform.translation.x:<span class="hljs-number">.2</span>f&#125;</span>, &#x27;</span> +                                  <span class="hljs-string">f&#x27;y: <span class="hljs-subst">&#123;trans.transform.translation.y:<span class="hljs-number">.2</span>f&#125;</span>, &#x27;</span> +                                  <span class="hljs-string">f&#x27;z: <span class="hljs-subst">&#123;trans.transform.translation.z:<span class="hljs-number">.2</span>f&#125;</span>]&#x27;</span>)            <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;  Rotation: [x: <span class="hljs-subst">&#123;trans.transform.rotation.x:<span class="hljs-number">.2</span>f&#125;</span>, &#x27;</span> +                                  <span class="hljs-string">f&#x27;y: <span class="hljs-subst">&#123;trans.transform.rotation.y:<span class="hljs-number">.2</span>f&#125;</span>, &#x27;</span> +                                  <span class="hljs-string">f&#x27;z: <span class="hljs-subst">&#123;trans.transform.rotation.z:<span class="hljs-number">.2</span>f&#125;</span>, &#x27;</span> +                                  <span class="hljs-string">f&#x27;w: <span class="hljs-subst">&#123;trans.transform.rotation.w:<span class="hljs-number">.2</span>f&#125;</span>]&#x27;</span>)        <span class="hljs-keyword">except</span> TransformException <span class="hljs-keyword">as</span> ex:            <span class="hljs-comment"># Handle exceptions (e.g., transform not available)</span>            <span class="hljs-variable language_">self</span>.get_logger().warn(                <span class="hljs-string">f&#x27;Could not get transform from <span class="hljs-subst">&#123;source&#125;</span> to <span class="hljs-subst">&#123;target&#125;</span>: <span class="hljs-subst">&#123;ex&#125;</span>&#x27;</span>)</code></pre></div><h3 id="TransformStamped-Message">TransformStamped Message</h3><p><code>TransformStamped</code> is the standard ROS message used to communicate a single transformation. It’s not a matrix itself, but it contains the data needed to build one.</p><ul><li><code>header.stamp</code>: When this transform was measured</li><li><code>header.frame_id</code>: The parent frame</li><li><code>child_frame_id</code>: The child frame</li><li><code>transform.translation</code>: The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">t</mi></mrow><annotation encoding="application/x-tex">\mathbf{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6349em;"></span><span class="mord mathbf">t</span></span></span></span> vector</li><li><code>transform.rotation</code>: The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">R</mi></mrow><annotation encoding="application/x-tex">\mathbf{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord mathbf">R</span></span></span></span> matrix represented as a quaternion</li></ul><h3 id="tf-transformations-Package"><code>tf_transformations</code> Package</h3><p>This package helps us do the calculations related to transformations.</p><ul><li><code>translation_matrix([x, y, z])</code>: Creates a 4x4 translation-only matrix.</li><li><code>quaternion_matrix([x, y, z, w])</code>: Creates a 4x4 rotation-only matrix from a quaternion.</li><li><code>concatenate_matrices(matrix1, matrix2, ...)</code>: Multiplies (chains) matrices.</li><li><code>inverse_matrix(matrix)</code>: Calculates the inverse of a 4x4 matrix (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mi>B</mi></msup><msub><mi>T</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">{}^B T_{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9913em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">{}^{A} T_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9913em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>).</li><li><code>translation_from_matrix(matrix)</code>: Extracts the translation vector <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>t</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[t_x, t_y, t_z]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> from a 4x4 matrix.</li><li><code>quaternion_from_matrix(matrix)</code>: Extracts the rotation part as a quaternion <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[x, y, z, w]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">]</span></span></span></span>.</li><li><code>(roll, pitch, yaw) = tf_transformations.euler_from_quaternion([x, y, z, w], axes='sxyz')</code>: Converts a quaternion to Euler angles.</li></ul><p>Suppose we have a <code>TransformStamped</code> message and we want to build a homogeneous from it:</p><div class="code-wrapper"><pre><code class="hljs python">trans = Tstamped.transform.translationrot = Tstamped.transform.rotationTmatrix = tf_transformations.concatenate_matrices(    tf_transformations.translation_matrix([trans.x, trans.y, trans.z]),    tf_transformations.quaternion_matrix([rot.x, rot.y, rot.z, rot.w]))</code></pre></div><p>When we apply a homogeneous transformation to a point, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>A</mi></msub><mo>=</mo><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>⋅</mo><msub><mi>p</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">p_A = {}^A T_B \cdot p_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9913em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, where</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>R</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>t</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">{}^A T_B = \begin{bmatrix}R &amp; t \\0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>It’s equivalent to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>A</mi></msub><mo>=</mo><mi>R</mi><mo>⋅</mo><msub><mi>p</mi><mi>B</mi></msub><mo>+</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">p_A = R \cdot p_B + t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, which means, we first rotate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>, then apply translation. This is equivalent to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>A</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>T</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>⋅</mo><msub><mi>T</mi><mrow><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo><mo>⋅</mo><msub><mi>p</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">p_A = (T_{translation} \cdot T_{rotation}) \cdot p_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, as a result</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><msub><mi>T</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>⋅</mo><msub><mi>T</mi><mrow><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{}^A T_B = T_{translation} \cdot T_{rotation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>That’s why in the above code, we first concatenate translation then rotation.</p>]]></content>
    
    
    <categories>
      
      <category>CSE276A</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ROS2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE276A - Mathematics behind Coordinate Transformations</title>
    <link href="/2025/11/08/CSE276A/CSE276A-pose/"/>
    <url>/2025/11/08/CSE276A/CSE276A-pose/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><ul><li>How to describe the relationship between two coordinate frames?</li><li>If I know a point in frame A, how to compute the point in frame B?</li></ul><h2 id="Homogeneous-Transformation-Matrix">Homogeneous Transformation Matrix</h2><p>If we have constructed two coordinates (e.g., robot base link frame and camera frame), how to describe the transformation between the two coordinates? Suppose we want to find a matrix that can map coordinates in camera frame to robot frame, denoted by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mi>r</mi></msup><mi mathvariant="bold">x</mi><mo>=</mo><msup><mrow></mrow><mi>r</mi></msup><msub><mi mathvariant="bold">T</mi><mi>c</mi></msub><msup><mrow></mrow><mi>c</mi></msup><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">{}^r\mathbf{x} = {}^r\mathbf{T}_c {}^c\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mord mathbf">x</span></span></span></span></p><h3 id="Translation">Translation</h3><p>The child frame’s origin (camera) in the parent frame (robot).</p><h3 id="Rotation">Rotation</h3><p>A useful online rotation representation converter: <a href="https://www.andre-gaschler.com/rotationconverter/">rotation converter</a>.</p><h4 id="Euler-Angles">Euler Angles</h4><p>Any 3D orientation can be achieved by performing three sequential rotations around a set of defined axes. The order matters for Euler angles. As a result, a 3-dimensional euler vector cannot describe an orientation unless we specify the rotation order.</p><h4 id="Rotation-Matrix">Rotation Matrix</h4><p><strong>A 3x3 matrix where the columns are the child frame’s (camera’s) X, Y, and Z axes, as described in the parent frame’s (robot’s) coordinates.</strong></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mover accent="true"><mi>X</mi><mo>⃗</mo></mover><mi>C</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mover accent="true"><mi>Y</mi><mo>⃗</mo></mover><mi>C</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mover accent="true"><mi>Z</mi><mo>⃗</mo></mover><mi>C</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">∣</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">R = \begin{bmatrix}| &amp; | &amp; | \\\vec{X}_C &amp; \vec{Y}_C &amp; \vec{Z}_C \\| &amp; | &amp; |\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.7263em;vertical-align:-1.6132em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.1132em;"><span style="top:-4.2732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.6132em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.1132em;"><span style="top:-4.2732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.6132em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.1132em;"><span style="top:-4.2732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.6132em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h4 id="Quaternion">Quaternion</h4><p>Instead of 3 separate rotations, a quaternion represents orientation as a single rotation around one specific axis in 3D space. The quaternion representation is 4 dimensional.</p><h3 id="Transformation">Transformation</h3><p>After obtaining transformation and rotation, this 4x4 transformation matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> is constructed by plugging in the 3x3 rotation matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> and the 3x1 translation vector <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>T</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span>.</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mrow></mrow><mi>r</mi></msup><msub><mi mathvariant="bold">T</mi><mi>c</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>R</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mover accent="true"><mi>T</mi><mo>⃗</mo></mover></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>3</mn><mo>×</mo><mn>3</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>3</mn><mo>×</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">{}^r\mathbf{T}_c =\begin{bmatrix} &amp; &amp; &amp; \\ &amp; R &amp; &amp; \vec{T} \\ &amp; (3 \times 3) &amp; &amp; (3 \times 1) \\ &amp; &amp; &amp; \\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8644em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:6.1263em;vertical-align:-2.8132em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.25em;"><span class="pstrut" style="height:8em;"></span><span style="width:0.667em;height:6.000em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="6.000em" viewBox="0 0 667 6000"><path d="M403 1759 V84 H666 V0 H319 V1759 v2400 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v2400 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3132em;"><span style="top:-5.4732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.1468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.5468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8132em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3132em;"><span style="top:-5.4732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.1468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">3</span><span class="mclose">)</span></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.5468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8132em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3132em;"><span style="top:-5.4732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.1468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.5468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8132em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3132em;"><span style="top:-5.4732em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.1468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span><span style="top:-2.9468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.7468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.5468em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8132em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.25em;"><span class="pstrut" style="height:8em;"></span><span style="width:0.667em;height:6.000em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="6.000em" viewBox="0 0 667 6000"><path d="M347 1759 V0 H0 V84 H263 V1759 v2400 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v2400 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>This matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> can transform any point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">P_C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> defined in the camera_frame coordinates directly into its corresponding point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">P_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the base_link frame coordinates with a single matrix multiplication:</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>B</mi><mo separator="true">,</mo><mi>x</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>B</mi><mo separator="true">,</mo><mi>y</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>B</mi><mo separator="true">,</mo><mi>z</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow></mrow><mi>r</mi></msup><msub><mi mathvariant="bold">T</mi><mi>c</mi></msub><mo>⋅</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>C</mi><mo separator="true">,</mo><mi>x</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>C</mi><mo separator="true">,</mo><mi>y</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>P</mi><mrow><mi>C</mi><mo separator="true">,</mo><mi>z</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} P_{B,x} \\ P_{B,y} \\ P_{B,z} \\ 1 \end{bmatrix}={}^r\mathbf{T}_c\cdot\begin{bmatrix} P_{C,x} \\ P_{C,y} \\ P_{C,z} \\ 1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M403 1759 V84 H666 V0 H319 V1759 v1200 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M347 1759 V0 H0 V84 H263 V1759 v1200 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8644em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M403 1759 V84 H666 V0 H319 V1759 v1200 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.667em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.800em" viewBox="0 0 667 4800"><path d="M347 1759 V0 H0 V84 H263 V1759 v1200 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v1200 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="Application">Application</h3><ul><li>Chaining Transforms</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>C</mi></msub><mo>=</mo><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>⋅</mo><msup><mrow></mrow><mi>B</mi></msup><msub><mi>T</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">{}^A T_C = {}^A T_B \cdot {}^B T_C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li>Transform a Point Between Frames</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>A</mi></msub><mo>=</mo><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>⋅</mo><msub><mi>P</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">P_A = {}^A T_B \cdot P_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li>Inverse of Transformation</li></ul><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo>=</mo><msup><mrow></mrow><mi>A</mi></msup><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="bold">R</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="bold">t</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">T = {}^A T_B = \begin{bmatrix}\mathbf{R} &amp; \mathbf{t} \\0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathbf">R</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathbf">t</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>T</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mrow></mrow><mi>B</mi></msup><msub><mi>T</mi><mi>A</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi mathvariant="bold">R</mi><mi>T</mi></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msup><mi mathvariant="bold">R</mi><mi>T</mi></msup><mi mathvariant="bold">t</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">T^{-1} = {}^B T_A = \begin{bmatrix}\mathbf{R}^T &amp; -\mathbf{R}^T \mathbf{t} \\0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0413em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4013em;vertical-align:-0.9507em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4507em;"><span style="top:-3.6093em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span><span style="top:-2.4093em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9507em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4507em;"><span style="top:-3.6093em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord mathbf">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf">t</span></span></span><span style="top:-2.4093em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9507em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>]]></content>
    
    
    <categories>
      
      <category>CSE276A</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ROS2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE276A - ROS2 Commands</title>
    <link href="/2025/10/26/CSE276A/CSE276A-ROS2-Commands/"/>
    <url>/2025/10/26/CSE276A/CSE276A-ROS2-Commands/</url>
    
    <content type="html"><![CDATA[<h3 id="Set-Up">Set Up</h3><ul><li><p><code>ros2 pkg create &lt;package_name&gt; --build-type &lt;type&gt; --dependencies &lt;deps&gt;</code>: Automatically generates the entire file and directory structure for a new, empty ROS 2 package.</p></li><li><p><code>ros2 pkg list</code>: Shows all packages that the ROS 2 environment can currently find.</p></li><li><p><code>ros2 pkg executables &lt;package_name&gt;</code>: Lists all the nodes that a specific package provides.</p></li><li><p><code>ros2 pkg dependencies &lt;package_name&gt;</code>:</p></li><li><p><code>colcon build</code>: Run this command from the workspace, it will find all the ROS 2 packages in the src directory, compile them in the correct order based on their dependencies, and place the resulting files in the install and build directories. After build, we need to source using <code>source install/setup.bash</code>.</p></li></ul><h3 id="Launch-Node">Launch Node</h3><ul><li><p><code>ros2 run &lt;package_name&gt; &lt;executable_name&gt;</code>: Launch a single node from a specific package.</p></li><li><p><code>ros2 launch &lt;package_name&gt; &lt;launch_file_name&gt;</code>: This launch file describes all the nodes that should be started, any parameters they should be set with, and how they might be connected. Running the launch file enable us to launch a complex application.</p></li></ul><h3 id="Node">Node</h3><ul><li><code>ros2 node list</code>: Shows all nodes currently active in the system.</li><li><code>ros2 node info &lt;node_name&gt;</code>: Lists all the publishers, subscribers, services, and actions associated with that specific node.</li></ul><h3 id="Topic">Topic</h3><ul><li><code>ros2 topic list</code>: Shows all topics currently active in the system.</li><li><code>ros2 topic echo &lt;topic_name&gt;</code>: Prints the data being published on a topic to the terminal in real-time.</li><li><code>ros2 topic pub &lt;topic_name&gt; &lt;message_type&gt; '&lt;data&gt;'</code>: Publishes a single message to a topic from the command line. Used for debugging.</li><li><code>ros2 topic hz &lt;topic_name&gt;</code>: Reports the average frequency in hertz at which messages are being published on a topic.</li></ul><h3 id="service">service</h3><ul><li><code>ros2 service list</code>: Shows all services currently active in the system.</li><li><code>ros2 service type &lt;service_name&gt;</code>: Shows the data type (interface) of the service.</li></ul>]]></content>
    
    
    <categories>
      
      <category>CSE276A</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ROS2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE276A - ROS2</title>
    <link href="/2025/10/24/CSE276A/CSE276A-ROS2/"/>
    <url>/2025/10/24/CSE276A/CSE276A-ROS2/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>ROS 2 (Robot Operating System 2) is a framework that runs on an existing OS. In a robot, there are separate programs that read camera data, controlling wheels, planning paths .etc. ROS 2 provides a standard way for all these independent programs to discover each other and exchange information.</p><h3 id="Nodes">Nodes</h3><p>A node is a single program responsible for one specific task.</p><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rclpy <span class="hljs-comment"># ROS Client Library for Python</span><span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">class</span> <span class="hljs-title class_">SensorNode</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-comment"># Initialize the node with the name &#x27;sensor_node&#x27;</span>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;sensor_node&#x27;</span>)        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">&#x27;LIDAR sensor node has started.&#x27;</span>)</code></pre></div><h3 id="Topics">Topics</h3><p>Topics are channels where nodes can send (publish) or receive (subscribe) data. This communication is asynchronous. E.g., the <code>sensor_node</code> needs to continuously broadcast sensor data to anyone who cares.</p><ul><li><p>Publisher</p><ul><li><code>self.publisher_ = self.create_publisher(String, 'chatter', 10)</code>: <code>String</code> specifies the message type, <code>'chatter'</code> is topic name, <code>10</code> is the the depth of the message queue.</li><li><code>self.timer = self.create_timer()</code>: register a timer event, the event is scheduled by <code>rclpy.init()</code>.</li><li><code>rclpy.init()</code>: Initializes the rclpy library, first step, mandatory.</li><li><code>rclpy.spin(node)</code>: ROS2 nodes are event-driven, this function will keep the node running and constantly listen for events. The program will stay at this line until <code>Ctrl+C</code> is entered.</li><li><code>node.destroy_node()</code>: Gracefully cleans up the node’s internal resources.</li><li><code>rclpy.shutdown()</code>: Shuts down the rclpy Library.</li></ul>  <div class="code-wrapper"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> String<span class="hljs-keyword">class</span> <span class="hljs-title class_">Talker</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;talker&#x27;</span>)        <span class="hljs-variable language_">self</span>.publisher_ = <span class="hljs-variable language_">self</span>.create_publisher(String, <span class="hljs-string">&#x27;chatter&#x27;</span>, <span class="hljs-number">10</span>)        timer_period = <span class="hljs-number">0.5</span>        <span class="hljs-variable language_">self</span>.timer = <span class="hljs-variable language_">self</span>.create_timer(timer_period, <span class="hljs-variable language_">self</span>.timer_callback) <span class="hljs-comment"># timer_callback is called every 0.5 seconds</span>        <span class="hljs-variable language_">self</span>.count = <span class="hljs-number">0</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">timer_callback</span>(<span class="hljs-params">self</span>):        msg = String()        msg.data = <span class="hljs-string">f&#x27;Hello ROS2: <span class="hljs-subst">&#123;self.count&#125;</span>&#x27;</span>        <span class="hljs-variable language_">self</span>.publisher_.publish(msg)        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;Publishing: &quot;<span class="hljs-subst">&#123;msg.data&#125;</span>&quot;&#x27;</span>)        <span class="hljs-variable language_">self</span>.count += <span class="hljs-number">1</span><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args=<span class="hljs-literal">None</span></span>):    rclpy.init(args=args)    node = Talker() <span class="hljs-comment"># Creates an instance of the Talker node class</span>    rclpy.spin(node)     node.destroy_node()    rclpy.shutdown()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre></div></li><li><p>Subscriber</p>  <div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> String<span class="hljs-keyword">class</span> <span class="hljs-title class_">Listener</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;listener&#x27;</span>)        <span class="hljs-variable language_">self</span>.subscription = <span class="hljs-variable language_">self</span>.create_subscription(            String,          <span class="hljs-comment"># message type</span>            <span class="hljs-string">&#x27;chatter&#x27;</span>,       <span class="hljs-comment"># topic name</span>            <span class="hljs-variable language_">self</span>.listener_callback,  <span class="hljs-comment"># callback function</span>            <span class="hljs-number">10</span>               <span class="hljs-comment"># queue size</span>        )        <span class="hljs-variable language_">self</span>.subscription    <span class="hljs-keyword">def</span> <span class="hljs-title function_">listener_callback</span>(<span class="hljs-params">self, msg</span>):        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;I heard: &quot;<span class="hljs-subst">&#123;msg.data&#125;</span>&quot;&#x27;</span>)<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args=<span class="hljs-literal">None</span></span>):    rclpy.init(args=args)    node = Listener()    rclpy.spin(node)    node.destroy_node()    rclpy.shutdown()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre></div></li></ul><h3 id="Services">Services</h3><p>Services are used for two-way communication. This communication is synchronous.</p><ul><li><p>Service Server</p>  <div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> example_interfaces.srv <span class="hljs-keyword">import</span> AddTwoInts<span class="hljs-keyword">class</span> <span class="hljs-title class_">AddTwoIntsServer</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;add_two_ints_server&#x27;</span>)        <span class="hljs-comment"># create a service</span>        <span class="hljs-variable language_">self</span>.srv = <span class="hljs-variable language_">self</span>.create_service(AddTwoInts, <span class="hljs-string">&#x27;add_two_ints&#x27;</span>, <span class="hljs-variable language_">self</span>.add_two_ints_callback)    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_two_ints_callback</span>(<span class="hljs-params">self, request, response</span>):        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;Received request: a=<span class="hljs-subst">&#123;request.a&#125;</span>, b=<span class="hljs-subst">&#123;request.b&#125;</span>&#x27;</span>)        response.<span class="hljs-built_in">sum</span> = request.a + request.b        <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">f&#x27;Returning response: sum=<span class="hljs-subst">&#123;response.<span class="hljs-built_in">sum</span>&#125;</span>&#x27;</span>)        <span class="hljs-keyword">return</span> response<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args=<span class="hljs-literal">None</span></span>):    rclpy.init(args=args)    node = AddTwoIntsServer()    rclpy.spin(node)  <span class="hljs-comment"># spin to waiting for requests</span>    node.destroy_node()    rclpy.shutdown()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre></div></li><li><p>Client</p></li></ul><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rclpy<span class="hljs-keyword">from</span> rclpy.node <span class="hljs-keyword">import</span> Node<span class="hljs-keyword">from</span> example_interfaces.srv <span class="hljs-keyword">import</span> AddTwoInts<span class="hljs-keyword">class</span> <span class="hljs-title class_">AddTwoIntsClient</span>(<span class="hljs-title class_ inherited__">Node</span>):    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&#x27;add_two_ints_client&#x27;</span>)        <span class="hljs-variable language_">self</span>.client = <span class="hljs-variable language_">self</span>.create_client(AddTwoInts, <span class="hljs-string">&#x27;add_two_ints&#x27;</span>)        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.client.wait_for_service(timeout_sec=<span class="hljs-number">1.0</span>):            <span class="hljs-variable language_">self</span>.get_logger().info(<span class="hljs-string">&#x27;Service not available, waiting...&#x27;</span>)        <span class="hljs-variable language_">self</span>.request = AddTwoInts.Request()        <span class="hljs-variable language_">self</span>.request.a = <span class="hljs-number">5</span>        <span class="hljs-variable language_">self</span>.request.b = <span class="hljs-number">7</span>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_request</span>(<span class="hljs-params">self</span>):        <span class="hljs-variable language_">self</span>.future = <span class="hljs-variable language_">self</span>.client.call_async(<span class="hljs-variable language_">self</span>.request)        rclpy.spin_until_future_complete(<span class="hljs-variable language_">self</span>, <span class="hljs-variable language_">self</span>.future) <span class="hljs-comment"># wait for response</span>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.future.result()<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args=<span class="hljs-literal">None</span></span>):    rclpy.init(args=args)    node = AddTwoIntsClient()    response = node.send_request()    node.get_logger().info(<span class="hljs-string">f&#x27;Result of addition: <span class="hljs-subst">&#123;response.<span class="hljs-built_in">sum</span>&#125;</span>&#x27;</span>)    node.destroy_node()    rclpy.shutdown()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CSE276A</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ROS2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发基础知识 - JUnit 5</title>
    <link href="/2025/08/10/JAVA/junit/"/>
    <url>/2025/08/10/JAVA/junit/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>一个简单的例子：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;<span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorTest</span> &#123;    <span class="hljs-comment">// @Test 注解表明这是一个测试方法</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAddition</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// 创建被测试类的实例</span>        <span class="hljs-type">Calculator</span> <span class="hljs-variable">calculator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();        <span class="hljs-comment">// 执行被测试的方法</span>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> calculator.add(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);        <span class="hljs-comment">// 使用断言 (Assertion) 来验证结果是否符合预期</span>        assertEquals(<span class="hljs-number">5</span>, result, <span class="hljs-string">&quot;2 + 3 应该等于 5&quot;</span>);    &#125;&#125;</code></pre></div><h3 id="注解">注解</h3><ul><li>@Test<br>它声明了一个方法是一个标准的测试方法。方法应该是 void 类型，方法不应该是 private 的，JUnit 会自动创建测试类的实例来运行这些方法。</li><li>@BeforeEach &amp; @AfterEach<br>这两个注解用于在每个 @Test 方法执行前后设置和清理环境。这对于确保测试之间的独立性至关重要。</li><li>@BeforeAll &amp; @AfterAll<br>这两个注解在当前测试类的所有测试方法运行前后只执行一次。</li><li>@DisplayName<br>默认情况下，测试报告会显示方法名。@DisplayName 允许你提供一个更具描述性的自定义名称。<br>比如：<code>@DisplayName(&quot;用户名和密码正确时应认证成功&quot;)</code></li></ul><h3 id="断言">断言</h3><p>位于 <code>org.junit.jupiter.api.Assertions</code>下。</p><ul><li>assertEquals(expected, actual)</li><li>assertNotEquals(unexpected, actual)</li><li>assertTrue(boolean condition)</li><li>assertNull(Object actual)</li><li>assertArrayEquals(expectedArray, actualArray)</li><li>assertThrows(expectedType, executable)</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-keyword">void</span> <span class="hljs-title function_">testDivisionByZero</span><span class="hljs-params">()</span> &#123;    <span class="hljs-type">Calculator</span> <span class="hljs-variable">calculator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();    <span class="hljs-comment">// 验证当除数为0时，是否会抛出 ArithmeticException 异常</span>    assertThrows(ArithmeticException.class, () -&gt; &#123;        calculator.divide(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);    &#125;);&#125;</code></pre></div><h2 id="Mockito">Mockito</h2><h3 id="为什么需要-Mocking">为什么需要 Mocking</h3><p>单元测试强调 隔离性。当你测试一个类 A 时，如果它依赖于另一个复杂的类 B（例如，B 可能需要访问数据库、调用网络接口），你不希望因为 B 的问题（如数据库连接失败）导致 A 的测试失败。<br>Mocking 技术就是为了解决这个问题。它允许你创建一个 Mock 对象，你可以指定它的方法被调用时应该返回什么值或执行什么操作，从而将测试目标从其依赖项中隔离开来。</p><h3 id="Mock">Mock</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 被测试的类</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">(UserRepository userRepository)</span> &#123;        <span class="hljs-built_in">this</span>.userRepository = userRepository;    &#125;    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserGreeting</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;        <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> userRepository.findUserNameById(userId);        <span class="hljs-keyword">if</span> (userName == <span class="hljs-literal">null</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, Guest!&quot;</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, &quot;</span> + userName + <span class="hljs-string">&quot;!&quot;</span>;    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> &#123;    String <span class="hljs-title function_">findUserNameById</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span>;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ExtendWith(MockitoExtension.class)</span> <span class="hljs-comment">// 让 Mockito 注解生效</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> &#123;    <span class="hljs-meta">@Mock</span> <span class="hljs-comment">// 1. 创建一个 UserRepository 的 Mock 对象</span>    <span class="hljs-keyword">private</span> UserRepository mockUserRepository;    <span class="hljs-meta">@InjectMocks</span> <span class="hljs-comment">// 2. 创建 UserService 实例，并自动注入上面 @Mock 标记的对象</span>    <span class="hljs-keyword">private</span> UserService userService;    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGreetingForExistingUser</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// 3. Stubbing: 定义 Mock 对象的行为</span>        <span class="hljs-comment">// 当调用 mockUserRepository 的 findUserNameById 方法并传入参数 1 时，返回 &quot;Alice&quot;</span>        <span class="hljs-keyword">when</span>(mockUserRepository.findUserNameById(<span class="hljs-number">1</span>)).thenReturn(<span class="hljs-string">&quot;Alice&quot;</span>);        <span class="hljs-comment">// 执行测试</span>        <span class="hljs-type">String</span> <span class="hljs-variable">greeting</span> <span class="hljs-operator">=</span> userService.getUserGreeting(<span class="hljs-number">1</span>);        <span class="hljs-comment">// 断言结果</span>        assertEquals(<span class="hljs-string">&quot;Hello, Alice!&quot;</span>, greeting);    &#125;&#125;</code></pre></div><h3 id="Spy">Spy</h3><ul><li>Mock：当你创建一个 Mock 对象时，你创建的是一个目标类的“空壳子”。调用 Mock 对象的任何方法，除非你用 <code>when(...).thenReturn(...)</code> 对其行为进行了stubbing，否则它只会返回该方法返回类型的默认值（null、0、false、空集合等）。</li><li>Spy：当你创建一个 Spy 对象时，你实际上是创建了一个真实的对象实例。调用 Spy 对象的任何方法，默认会直接调用真实对象的原始方法，并返回真实的结果。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceTest</span> &#123;    <span class="hljs-keyword">private</span> OrderService spyOrderService;    <span class="hljs-meta">@BeforeEach</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;        spyOrderService = Mockito.spy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>());    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPlaceOrder_Successfully</span><span class="hljs-params">()</span> &#123;                <span class="hljs-comment">// 错误的方式，会抛出 UnsupportedOperationException，因为它先执行了真实的 saveToDatabase 方法</span>        <span class="hljs-comment">// when(spyOrderService.saveToDatabase(anyString())).then... </span>        <span class="hljs-comment">// 正确的方式：使用 do...when... 语法</span>        doNothing().<span class="hljs-keyword">when</span>(spyOrderService).saveToDatabase(anyString());        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> spyOrderService.placeOrder(<span class="hljs-number">101</span>, <span class="hljs-number">5</span>);        assertEquals(<span class="hljs-string">&quot;下单成功&quot;</span>, result);    &#125;</code></pre></div><ul><li><code>when(spy.method()).thenReturn(...)</code> 的形式会先执行真实的方法。</li><li><code>doReturn/doThrow/doAnswer</code> 避免执行真实方法带来的副作用。</li></ul>]]></content>
    
    
    <categories>
      
      <category>开发基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>JUnit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Java函数式编程 - Stream API</title>
    <link href="/2025/08/02/JAVA/java-fp-stream/"/>
    <url>/2025/08/02/JAVA/java-fp-stream/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p><a href="https://thiefcat.github.io/2025/08/02/JAVA/java-fp-basic">函数式编程介绍</a></p><h2 id="Stream-API">Stream API</h2><h3 id="Stream-API的特性">Stream API的特性</h3><ul><li>声明式: 你只需描述做什么，而无需关心如何做</li><li>可组合: 中间操作返回一个新的Stream，因此可以将多个操作链接起来</li><li>一次性消费: 一个Stream只能被一个终端操作消费一次</li><li>支持并行化</li></ul><h3 id="Stream的创建">Stream的创建</h3><p>stream的创建：在使用Stream API之前，你必须先获得一个Stream实例。Collection接口提供了<code>stream()</code>和<code>parallelStream()</code>默认方法。</p><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);Stream&lt;String&gt; sequentialStream = list.stream(); <span class="hljs-comment">// 创建串行流</span>Set&lt;Integer&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));Stream&lt;Integer&gt; parallelStream = set.parallelStream(); <span class="hljs-comment">// 创建并行流</span>String[] array = &#123;<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-string">&quot;z&quot;</span>&#125;;Stream&lt;String&gt; streamFromArray = Arrays.stream(array);<span class="hljs-comment">// 静态工厂方法创建</span>Stream&lt;String&gt; streamOf = Stream.of(<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;cherry&quot;</span>);</code></pre></div><h3 id="Stream的中间操作">Stream的中间操作</h3><p>中间操作接收一个Stream，返回一个新的Stream。</p><ul><li><code>filter(Predicate&lt;T&gt; predicate)</code>: 过滤。保留使predicate返回true的元素。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 筛选出长度大于5的字符串</span>stream.filter(s -&gt; s.length() &gt; <span class="hljs-number">5</span>);</code></pre></div><ul><li><code>map(Function&lt;T, R&gt; mapper)</code>: 映射/转换。将每个元素T转换为一个新的元素R。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 将字符串列表转换为其长度的列表</span>stream.map(String::length); <span class="hljs-comment">// 返回一个 Stream&lt;Integer&gt;</span></code></pre></div><ul><li><code>peek(Consumer&lt;T&gt; action)</code>: 主要用于调试，它会对流中的每个元素执行一个操作，但不会改变流本身。</li></ul><div class="code-wrapper"><pre><code class="hljs java">stream.peek(s -&gt; System.out.println(<span class="hljs-string">&quot;Processing: &quot;</span> + s));</code></pre></div><ul><li><code>sorted()</code> / <code>sorted(Comparator&lt;T&gt; comparator)</code>: 排序。</li><li><code>limit(long maxSize)</code>: 截断流，使其元素数量不超过maxSize。</li><li><code>distinct()</code>: 去重。基于元素的equals()方法。</li></ul><h3 id="Stream的终端操作">Stream的终端操作</h3><p>终端操作是流水线的终点。它会触发所有惰性中间操作的执行，并产生一个最终结果或副作用（打印到控制台，调用某个服务的API等）。</p><p>惰性求值：中间操作不会立即执行。它们只是在流水线上注册了一个待执行的操作。只有当一个终端操作被调用时，整个流水线才会从源头开始，依次执行所有中间操作。</p><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Charlie&quot;</span>, <span class="hljs-string">&quot;David&quot;</span>);Stream&lt;String&gt; stream = names.stream()    .filter(name -&gt; &#123;        System.out.println(<span class="hljs-string">&quot;Filtering: &quot;</span> + name);        <span class="hljs-keyword">return</span> name.length() &gt; <span class="hljs-number">4</span>;    &#125;)    .map(name -&gt; &#123;        System.out.println(<span class="hljs-string">&quot;Mapping: &quot;</span> + name);        <span class="hljs-keyword">return</span> name.toUpperCase();    &#125;);<span class="hljs-comment">// 直到下面这行终端操作被调用，上面的打印语句才会执行</span><span class="hljs-type">String</span> <span class="hljs-variable">firstResult</span> <span class="hljs-operator">=</span> stream.findFirst().get(); System.out.println(<span class="hljs-string">&quot;First result: &quot;</span> + firstResult);</code></pre></div><h4 id="消费与副作用：对每个元素执行操作">消费与副作用：对每个元素执行操作</h4><ul><li><code>void forEach(Consumer&lt;? super T&gt; action)</code></li></ul><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Charlie&quot;</span>);names.stream()     .filter(s -&gt; s.startsWith(<span class="hljs-string">&quot;A&quot;</span>))     .forEach(System.out::println); <span class="hljs-comment">// 副作用：打印到控制台</span><span class="hljs-comment">// 输出: Alice</span></code></pre></div><h4 id="查询与匹配：检查元素属性">查询与匹配：检查元素属性</h4><ul><li><code>Optional&lt;T&gt; findFirst()</code></li><li><code>Optional&lt;T&gt; findAny()</code></li><li><code>boolean anyMatch(Predicate&lt;? super T&gt; predicate)</code>, e.g.</li></ul><div class="code-wrapper"><pre><code class="hljs java">users.stream().anyMatch(user -&gt; user.isAdmin())</code></pre></div><ul><li><code>boolean allMatch(Predicate&lt;? super T&gt; predicate)</code></li></ul><h4 id="归约：将流合并为单个值">归约：将流合并为单个值</h4><p>比如，计算总和、求最大值、或将所有字符串连接起来等。</p><ul><li><code>long count()</code></li><li><code>Optional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator)</code></li><li><code>Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator)</code></li></ul><div class="code-wrapper"><pre><code class="hljs java">List&lt;Integer&gt; numbers = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);Optional&lt;Integer&gt; sum = numbers.stream().reduce((a, b) -&gt; a + b); <span class="hljs-comment">// or Integer::sum</span>sum.ifPresent(System.out::println); <span class="hljs-comment">// 输出: 15</span></code></pre></div><h4 id="收集：将流元素聚合到容器中">收集：将流元素聚合到容器中</h4><p>将流中的元素重新组织成另一种形式，通常是一个集合（如List, Set, Map）。语法：<code>&lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector)</code>。</p><div class="code-wrapper"><pre><code class="hljs java">Set&lt;String&gt; uniqueNames = names.stream().collect(Collectors.toSet());</code></pre></div><ul><li><code>Collectors.toList()</code></li><li><code>Collectors.toMap()</code></li></ul><div class="code-wrapper"><pre><code class="hljs java">Map&lt;String, Integer&gt; nameToAgeMap = people.stream()    .collect(Collectors.toMap(        p -&gt; p.getName(),   <span class="hljs-comment">// 获取Key</span>        p -&gt; p.getAge()     <span class="hljs-comment">// 获取Value</span>    ));</code></pre></div><ul><li><code>Collectors.joining()</code></li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">names</span> <span class="hljs-operator">=</span> people.stream()                     .map(Person::getName) <span class="hljs-comment">// Stream&lt;Person&gt; -&gt; Stream&lt;String&gt;</span>                     .collect(Collectors.joining(<span class="hljs-string">&quot;, &quot;</span>));</code></pre></div><ul><li><code>Collectors.summingDouble()</code></li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">Double</span> <span class="hljs-variable">totalElectronicsPrice</span> <span class="hljs-operator">=</span> products.stream()    .filter(p -&gt; <span class="hljs-string">&quot;Electronics&quot;</span>.equals(p.getCategory()))    .collect(Collectors.summingDouble(Product::getPrice));</code></pre></div><h2 id="Optional类">Optional类</h2><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> findUserById(<span class="hljs-string">&quot;123&quot;</span>);<span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> user.getName(); <span class="hljs-comment">// 如果 user 为 null，这里将抛出 NullPointerException</span></code></pre></div><p>Optional 的诞生正是为了在类型系统层面解决这个问题。</p><h3 id="Definition">Definition</h3><p><code>java.util.Optional&lt;T&gt;</code> 是一个容器对象，它最多可以持有一个非 null 的 T 类型的值。</p><h3 id="创建Optional">创建Optional</h3><ul><li><code>Optional.of(T value)</code>，当你确定 value 绝对不为 null 时使用。如果 value 为 null，它会立即抛出 NullPointerException。</li></ul><div class="code-wrapper"><pre><code class="hljs java">Optional&lt;String&gt; name = Optional.of(<span class="hljs-string">&quot;John Doe&quot;</span>);</code></pre></div><ul><li><code>Optional.ofNullable(T value)</code>，当你持有一个可能为 null 的值时使用。如果 value 不为 null，它会创建一个包含该值的 Optional；如果 value 为 null，它会创建一个空的 Optional。</li></ul><div class="code-wrapper"><pre><code class="hljs java">Optional&lt;User&gt; user = Optional.ofNullable(findUserFromDB());</code></pre></div><ul><li><code>Optional.ofNullable(T value)</code>，如果 value 不为 null，它会创建一个包含该值的 Optional；如果 value 为 null，它会创建一个空的 Optional。</li><li><code>Optional.empty()</code>，创建一个空的 Optional 实例。</li></ul><h3 id="使用Optional">使用Optional</h3><ul><li><code>ifPresent(Consumer&lt;? super T&gt; consumer)</code><br>当你只想在值存在时执行某个操作，可以使用 ifPresent() 方法。<br>传统方法：</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> getNullableName();<span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span>) &#123;    System.out.println(<span class="hljs-string">&quot;Name is: &quot;</span> + name);&#125;</code></pre></div><p>使用 ifPresen：</p><div class="code-wrapper"><pre><code class="hljs java">Optional.ofNullable(getNullableName()).ifPresent(name -&gt; System.out.println(<span class="hljs-string">&quot;Name is: &quot;</span> + name));</code></pre></div><ul><li><code>orElse(T other)</code> and <code>orElseGet(Supplier&lt;? extends T&gt; other)</code><br>当 Optional 为空时，我们常常需要提供一个默认值。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> Optional.ofNullable(getNullableName()).orElse(<span class="hljs-string">&quot;default&quot;</span>);<span class="hljs-type">String</span> <span class="hljs-variable">name2</span> <span class="hljs-operator">=</span> Optional.ofNullable(getNullableName()).orElseGet(() -&gt; createDefaultName());</code></pre></div><ul><li><code>Optional</code> 配合 <code>map()</code></li></ul><div class="code-wrapper"><pre><code class="hljs java">Optional&lt;User&gt; userOptional = Optional.ofNullable(getUser());Optional&lt;String&gt; zipCodeOptional = userOptional    .map(User::getAddress)    .map(Address::getZipCode);<span class="hljs-type">String</span> <span class="hljs-variable">zipCode</span> <span class="hljs-operator">=</span> zipCodeOptional.orElse(<span class="hljs-string">&quot;Not available&quot;</span>);</code></pre></div><p>以上例子中，<code>map(User::getAddress)</code> 将 <code>Optional&lt;User&gt;</code> 转换为了 <code>Optional&lt;Address&gt;</code>，整个过程无需任何 null 检查。</p><ul><li><code>Optional</code> 配合 <code>filter()</code></li></ul><div class="code-wrapper"><pre><code class="hljs java">Optional&lt;String&gt; name = Optional.of(<span class="hljs-string">&quot;John Doe&quot;</span>);<span class="hljs-comment">// 只有当名字包含 &quot;John&quot; 时才保留</span>Optional&lt;String&gt; johnOptional = name.filter(n -&gt; n.contains(<span class="hljs-string">&quot;John&quot;</span>)); <span class="hljs-comment">// 结果为 Optional[&quot;John Doe&quot;]</span>Optional&lt;String&gt; janeOptional = name.filter(n -&gt; n.contains(<span class="hljs-string">&quot;Jane&quot;</span>)); <span class="hljs-comment">// 结果为 Optional.empty</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Java函数式编程 - 函数式接口</title>
    <link href="/2025/07/28/JAVA/java-fp-basic/"/>
    <url>/2025/07/28/JAVA/java-fp-basic/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>函数式编程是一种编程范式，与其相对的是面向对象编程。</p><ul><li>OOP：将数据和操作该数据的行为（方法）封装在对象中。程序的设计围绕着对象及其相互作用展开。</li><li>FP：它将计算视为数学函数的求值过程。程序的设计是通过组合一系列函数来完成的。</li></ul><p>不像JavaScript，函数可以被当作参数传入函数中。在 Java 中，函数无法独立于类或对象存在。<strong>那么如何让Java代码可以传递函数作为参数呢？答案是函数式接口</strong>。</p><h2 id="回调函数">回调函数</h2><p>考虑以下场景：<br>文件下载是一个耗时的任务，我希望调用文件下载函数（downloadFile）之后立刻返回，继续处理别的数据，当文件下载结束之后，downloadFile函数可以自动调用一个onSuccess函数来对下载的文件作处理。</p><ol><li>如果同步的对下载文件作处理：</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> File <span class="hljs-title function_">downloadFileSync</span><span class="hljs-params">(String url)</span> &#123;    <span class="hljs-comment">// ... 执行耗时的下载逻辑 ...</span>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;...&quot;</span>);    <span class="hljs-keyword">return</span> file;&#125;<span class="hljs-comment">// 调用代码</span>System.out.println(<span class="hljs-string">&quot;开始下载...&quot;</span>);<span class="hljs-type">File</span> <span class="hljs-variable">myFile</span> <span class="hljs-operator">=</span> downloadFileSync(<span class="hljs-string">&quot;[http://example.com/largefile.zip](http://example.com/largefile.zip)&quot;</span>); <span class="hljs-comment">// &lt;--- 程序会在这里卡住10秒钟</span>System.out.println(<span class="hljs-string">&quot;下载完成！文件路径：&quot;</span> + myFile.getPath()); <span class="hljs-comment">// 10秒后才会执行这句</span></code></pre></div><p>在 downloadFileSync 方法完成并返回结果之前，调用它的线程会被阻塞（Block），无法执行任何其他操作。</p><ol start="2"><li>我们可以考虑使用两个线程来解决这个问题：一个是主线程，另一个线程负责执行下载以及之后的回调。思路：将函数作为参数传递到downloadFile的函数中。但是Java不支持函数作为参数，有什么解决方法呢？答案是：将函数包装在一个对象里。</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span>&lt;T&gt; &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(T result)</span>; <span class="hljs-comment">// 成功时调用，结果类型为 T</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span>;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileDownloader</span> &#123;    <span class="hljs-comment">// 使用线程池来管理异步任务</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">(String url, Callback&lt;File&gt; callback)</span> &#123;        System.out.println(<span class="hljs-string">&quot;Downloader: 开始下载文件，URL: &quot;</span> + url);        <span class="hljs-comment">// 提交一个新任务到线程池中执行，实现异步</span>        executor.submit(() -&gt; &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">// 模拟网络延迟和下载过程</span>                System.out.println(<span class="hljs-string">&quot;正在下载中...&quot;</span>);                Thread.sleep(<span class="hljs-number">2500</span>);                <span class="hljs-type">File</span> <span class="hljs-variable">downloadedFile</span> <span class="hljs-operator">=</span> File.createTempFile(<span class="hljs-string">&quot;download_&quot;</span>, <span class="hljs-string">&quot;.tmp&quot;</span>);                System.out.println(<span class="hljs-string">&quot;文件下载成功&quot;</span>);                <span class="hljs-comment">// 任务成功，执行成功回调</span>                <span class="hljs-keyword">if</span> (callback != <span class="hljs-literal">null</span>) &#123;                    callback.onSuccess(downloadedFile);                &#125;            &#125; <span class="hljs-keyword">catch</span> (InterruptedException | IOException e) &#123;                <span class="hljs-comment">// 模拟下载过程中发生错误</span>                System.err.println(<span class="hljs-string">&quot;下载时发生错误&quot;</span>);                                <span class="hljs-keyword">if</span> (callback != <span class="hljs-literal">null</span>) &#123;                    callback.onError(e);                &#125;            &#125;        &#125;);        System.out.println(<span class="hljs-string">&quot;Downloader: downloadFile 方法已立即返回，主线程不会被阻塞。&quot;</span>);    &#125;    <span class="hljs-comment">// 提供一个关闭线程池的方法，以便在程序退出时释放资源</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> &#123;        executor.shutdown();    &#125;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        System.out.println(<span class="hljs-string">&quot;程序启动，准备调用下载方法。&quot;</span>);                <span class="hljs-type">FileDownloader</span> <span class="hljs-variable">downloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileDownloader</span>();        <span class="hljs-comment">// 创建了一个 Callback&lt;File&gt; 的匿名内部类实例，</span>        <span class="hljs-comment">// 这里相当于先创建一个class implements Callback&lt;File&gt;，再创建一个对象</span>        Callback&lt;File&gt; myDownloadCallback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;File&gt;() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(File result)</span> &#123;                System.out.println(<span class="hljs-string">&quot;回调函数被执行：任务成功！&quot;</span>);                System.out.println(<span class="hljs-string">&quot;文件保存在: &quot;</span> + result.getAbsolutePath());                <span class="hljs-comment">// 可以在这里做文件重命名、移动或通知用户等操作</span>            &#125;            <span class="hljs-meta">@Override</span>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span> &#123;                System.err.println(<span class="hljs-string">&quot;回调函数被执行：任务失败！&quot;</span>);                e.printStackTrace();                <span class="hljs-comment">// 可以在这里记录日志、提示用户下载失败等</span>            &#125;        &#125;;        downloader.downloadFile(fileUrl, myDownloadCallback);        System.out.println(<span class="hljs-string">&quot;downloadFile 方法已调用完毕，主线程继续执行其他任务...&quot;</span>);        <span class="hljs-comment">// 主线程可以继续做其他事情，比如响应用户点击等，而不会被下载任务卡住</span>    &#125;&#125;</code></pre></div><h2 id="函数式接口">函数式接口</h2><p>Java 8对上述模式中的“接口”进行了一次概念上的升级。如果一个接口只有一个抽象方法，它就被称为函数式接口。<strong>一个函数式接口是指有且仅有一个抽象方法的接口</strong>。Java 提供了 @FunctionalInterface 注解来在编译时强制校验这一点。一个经典的例子是 java.lang.Runnable：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Runnable</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 这是唯一的一个抽象方法</span>&#125;</code></pre></div><p>创建一个线程的本质可以理解为启动一个线程来执行某个函数，这个函数通过Runnable包装起来，使得这个函数可以被当作参数传递给其他函数。</p><h3 id="直接实现-Runnable-接口">直接实现 Runnable 接口</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;任务正在执行...&quot;</span>);    &#125;&#125;<span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>();<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task);thread.start();  <span class="hljs-comment">// 启动线程，执行 run 方法</span></code></pre></div><h3 id="使用匿名类实现-Runnable">使用匿名类实现 Runnable</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;任务正在执行...&quot;</span>);    &#125;&#125;;<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task);thread.start();  <span class="hljs-comment">// 启动线程，执行 run 方法</span></code></pre></div><p>匿名类是 Java 中的一种特殊类，用来创建一个没有名字的类并立即实例化它。本质上，<strong>以上代码创建了一个匿名类，它实现了 Runnable 接口，并提供了 run() 方法的具体实现</strong>。</p><h3 id="使用-Lambda-表达式">使用 Lambda 表达式</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> () -&gt; System.out.println(<span class="hljs-string">&quot;任务正在执行...&quot;</span>); <span class="hljs-comment">// Runnable是一个函数式接口</span><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task);thread.start();  <span class="hljs-comment">// 启动线程，执行 run 方法</span></code></pre></div><p><strong>Lambda函数是前两个实现方法的语法糖</strong>。它允许你直接提供那个唯一抽象方法的实现，编译器会自动为你完成“创建对象”这个包装过程。</p><h2 id="java-util-function">java.util.function</h2><p>java.util.function 包提供一套通用、标准化的函数式接口。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 自定义接口</span><span class="hljs-keyword">interface</span> <span class="hljs-title class_">StringOperation</span> &#123;    String <span class="hljs-title function_">apply</span><span class="hljs-params">(String s)</span>;&#125;<span class="hljs-type">StringOperation</span> <span class="hljs-variable">func</span> <span class="hljs-operator">=</span> (s) -&gt; s.toUpperCase();<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processString</span><span class="hljs-params">(String input, StringOperation op)</span> &#123;    System.out.println(op.apply(input));&#125;processString(<span class="hljs-string">&quot;hello&quot;</span>, func);</code></pre></div><p>有了 java.util.function，你不再需要定义 StringOperation，可以直接使用 <code>Function&lt;String, String&gt;</code>。<strong>StringOperation这个函数式接口本质上定义了一个“接受一个 String，返回一个 String”的函数载体</strong>。<code>Function&lt;String, String&gt;</code> 精确地描述了“接受一个 String，返回一个 String”这个函数签名。</p><p><code>Function&lt;String, String&gt;</code>是预先定义好的接口，它就是一个函数式接口，只不过提供了统一的规范：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Function</span>&lt;T, R&gt; &#123;    R <span class="hljs-title function_">apply</span><span class="hljs-params">(T t)</span>;&#125;</code></pre></div><h3 id="Function-T-R">Function&lt;T, R&gt;</h3><ul><li>接口方法: <code>R apply(T t)</code></li><li>接受一个类型为 T 的参数，经过转换后，返回一个类型为 R 的结果。这是最典型的“输入 -&gt; 输出”模型。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 将字符串转换为其长度 (Integer)</span>Function&lt;String, Integer&gt; lengthFunction = s -&gt; s.length();<span class="hljs-type">Integer</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> lengthFunction.apply(<span class="hljs-string">&quot;Hello, World!&quot;</span>); <span class="hljs-comment">// len is 13</span></code></pre></div><h3 id="Predicate-T">Predicate<T></h3><ul><li>接口方法: <code>boolean test(T t)</code></li><li>接受一个类型为 T 的参数，返回一个布尔值。用于判断输入是否满足某个条件。</li></ul><div class="code-wrapper"><pre><code class="hljs java">Predicate&lt;Integer&gt; isPositive = i -&gt; i &gt; <span class="hljs-number">0</span>;<span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> isPositive.test(<span class="hljs-number">10</span>);  <span class="hljs-comment">// true</span><span class="hljs-type">boolean</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> isPositive.test(-<span class="hljs-number">5</span>); <span class="hljs-comment">// false</span></code></pre></div><h3 id="Consumer-T">Consumer<T></h3><ul><li>接口方法: <code>void accept(T t)</code></li><li>接受一个类型为 T 的参数，执行某个操作，但没有返回值。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 打印字符串到控制台</span>Consumer&lt;String&gt; printer = s -&gt; System.out.println(s);printer.accept(<span class="hljs-string">&quot;Processing data...&quot;</span>);</code></pre></div><h3 id="Supplier-T">Supplier<T></h3><ul><li>接口方法: <code>T get()</code></li><li>不接受任何参数，但返回一个类型为 T 的结果。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 生成一个新的 UUID</span>Supplier&lt;UUID&gt; uuidGenerator = () -&gt; UUID.randomUUID();<span class="hljs-type">UUID</span> <span class="hljs-variable">newId</span> <span class="hljs-operator">=</span> uuidGenerator.get();</code></pre></div><h2 id="方法引用">方法引用</h2><p>方法引用可以看作是特定场景下 Lambda 表达式的一种语法糖。<strong>当一个 Lambda 表达式的全部内容只是在调用一个已经存在的方法时，提供一种更简洁的写法来直接引用那个方法</strong>。</p><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Charlie&quot;</span>);<span class="hljs-comment">// 使用 Lambda 表达式</span>names.forEach(s -&gt; System.out.println(s));</code></pre></div><p>这个lambda函数本质上就是接收一个参数 s，然后将这个参数 s 原封不动地传递给了 System.out.println() 方法。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 使用方法引用</span>names.forEach(System.out::println);</code></pre></div><ol><li>静态方法引用: <code>ClassName::staticMethodName</code><br><code>str -&gt; Integer.parseInt(str)</code> 可以写成 <code>Integer::parseInt</code></li></ol><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; stringNumbers = Arrays.asList(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>);List&lt;Integer&gt; numbers = stringNumbers.stream()                                     .map(Integer::parseInt) <span class="hljs-comment">// 代替 s -&gt; Integer.parseInt(s)</span>                                     .collect(Collectors.toList());<span class="hljs-comment">// numbers is [1, 2, 3]</span></code></pre></div><ol start="2"><li>指向特定对象的实例方法引用: <code>instance::instanceMethodName</code><br><code>x -&gt; System.out.println(x)</code> 可以写成 <code>System.out::println</code></li></ol><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Charlie&quot;</span>);names.forEach(System.out::println); <span class="hljs-comment">// 代替 name -&gt; System.out.println(name)</span></code></pre></div><ol start="3"><li>指向任意类型实例方法引用: <code>ClassName::instanceMethodName</code><br>语法：<code>(arg0, rest_of_args) -&gt; arg0.instanceMethodName(rest_of_args)</code><br><code>(s1, s2) -&gt; s1.compareTo(s2)</code> 可以写成 <code>String::compareTo</code></li></ol><div class="code-wrapper"><pre><code class="hljs java">List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);Predicate&lt;String&gt; isEmptyPredicate = String::isEmpty; <span class="hljs-comment">// 目标类型是 Predicate&lt;String&gt;</span>                                                      <span class="hljs-comment">// 其抽象方法是 boolean test(String s)</span>                                                      <span class="hljs-comment">// 映射为 s -&gt; s.isEmpty()</span><span class="hljs-type">boolean</span> <span class="hljs-variable">hasEmptyString</span> <span class="hljs-operator">=</span> list.stream().anyMatch(isEmptyPredicate); <span class="hljs-comment">// true</span></code></pre></div><ol start="4"><li>构造函数引用: <code>ClassName::new</code><br><code>() -&gt; new ArrayList&lt;&gt;()</code> 可以写成 <code>ArrayList::new</code></li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;    String name;    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> &#123; <span class="hljs-built_in">this</span>.name = name; &#125;    <span class="hljs-comment">// ...</span>&#125;List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>);List&lt;Person&gt; people = names.stream()                           .map(Person::<span class="hljs-keyword">new</span>) <span class="hljs-comment">// 代替 name -&gt; new Person(name)</span>                           .collect(Collectors.toList());</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - 泛型</title>
    <link href="/2025/07/27/JAVA/generics/"/>
    <url>/2025/07/27/JAVA/generics/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>范型的作用是在<strong>编译时</strong>推断参数的类型，提高代码重用性，并且将类型安全检查从 “运行期” 提前到 “编译期”，从而写出更安全。<br>在Java引入范型之前如果要定义一个通用容器，比如List：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<span class="hljs-comment">// 什么都能放进去，没有类型限制</span>list.add(<span class="hljs-string">&quot;Hello&quot;</span>);list.add(<span class="hljs-number">123</span>);list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Date());System.out.println(<span class="hljs-string">&quot;list.get(0) = &quot;</span> + list.get(<span class="hljs-number">0</span>));<span class="hljs-comment">// 取出时必须强制类型转换</span><span class="hljs-type">String</span> <span class="hljs-variable">firstItem</span> <span class="hljs-operator">=</span> (String) list.get(<span class="hljs-number">0</span>);<span class="hljs-comment">// RuntimeException: 编译时完全正常，因为编译器不知道list里第二个元素不是String</span><span class="hljs-type">String</span> <span class="hljs-variable">secondItem</span> <span class="hljs-operator">=</span> (String) list.get(<span class="hljs-number">1</span>); <span class="hljs-comment">// 程序崩溃</span></code></pre></div><p>范型避免了这种“类型不匹配的错误在编译时无法被发现，只能等到代码运行时才暴露出来”的问题。</p><h3 id="Generic-Class">Generic Class</h3><p>范型允许我们为类、接口和方法定义一个或多个类型参数。<br>语法：<code>class ClassName&lt;T1, T2, ...&gt; { /* ... */ }</code>。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// T 是一个类型参数，代表 &quot;Type&quot;</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Box</span>&lt;T&gt; &#123;    <span class="hljs-keyword">private</span> T item;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T item)</span> &#123;        <span class="hljs-built_in">this</span>.item = item;    &#125;    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.item;    &#125;&#125;<span class="hljs-comment">// 使用泛型类</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericTypeExample</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-comment">// 实例化时，将 T 指定为 String</span>        Box&lt;String&gt; stringBox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Box</span>&lt;&gt;();        stringBox.set(<span class="hljs-string">&quot;Hello, Generics!&quot;</span>);        <span class="hljs-comment">// stringBox.set(123); // 编译错误！类型不匹配</span>        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> stringBox.get();        System.out.println(content);        <span class="hljs-comment">// 实例化时，将 T 指定为 Integer</span>        Box&lt;Integer&gt; integerBox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Box</span>&lt;&gt;();        integerBox.set(<span class="hljs-number">42</span>);        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> integerBox.get();        System.out.println(number);    &#125;&#125;</code></pre></div><ul><li>stringBox 在编译时就被限定只能存储 String 类型，任何试图存入其他类型的操作都会导致编译失败。</li><li>从 stringBox.get() 返回的就是 String 类型，无需进行类型转换</li></ul><h3 id="Generic-Methods">Generic Methods</h3><p>泛型方法在编写静态工具类时尤其有用。<br>语法：<code>public &lt;T&gt; ReturnType methodName(T parameter) { /* ... */ }</code>。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayUtils</span> &#123;    <span class="hljs-comment">// 一个泛型方法，用于交换数组中的两个元素</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(T[] array, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123;        <span class="hljs-type">T</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> array[i];        array[i] = array[j];        array[j] = temp;    &#125;    <span class="hljs-comment">// 另一个泛型方法，返回数组的中间元素</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;E&gt; E <span class="hljs-title function_">getMiddleElement</span><span class="hljs-params">(E[] array)</span> &#123;        <span class="hljs-keyword">if</span> (array == <span class="hljs-literal">null</span> || array.length == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;        &#125;        <span class="hljs-keyword">return</span> array[array.length / <span class="hljs-number">2</span>];    &#125;&#125;<span class="hljs-comment">// 使用泛型方法</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericMethodExample</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        String[] names = &#123;<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;Charlie&quot;</span>&#125;;        ArrayUtils.swap(names, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 编译器会自动推断 T 是 String</span>        System.out.println(java.util.Arrays.toString(names)); <span class="hljs-comment">// 输出: [Charlie, Bob, Alice]</span>        Integer[] numbers = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;        <span class="hljs-type">Integer</span> <span class="hljs-variable">middleNumber</span> <span class="hljs-operator">=</span> ArrayUtils.getMiddleElement(numbers); <span class="hljs-comment">// E 被推断为 Integer</span>        System.out.println(middleNumber); <span class="hljs-comment">// 输出: 3</span>    &#125;&#125;</code></pre></div><ul><li><code>&lt;T&gt;</code> 的作用域仅限于该方法本身</li><li>类型参数 <code>&lt;T&gt;</code> 声明在方法的返回类型之前</li><li>范型方法允许在调用时动态指定类型，而不是固定使用某种类型</li></ul><h3 id="Generic-Interface">Generic Interface</h3><p><code>Comparable&lt;T&gt;</code> 接口就是一个典型的泛型接口。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt; &#123;    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(T o)</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Student&gt; &#123; <span class="hljs-comment">// 指定 T 就是 Student</span>    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Student other)</span> &#123; <span class="hljs-comment">// 参数直接就是 Student 类型，无需强制转换</span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.age - other.age;     &#125;&#125;</code></pre></div><h3 id="Wildcards">Wildcards</h3><h4 id="上界通配符（-extends-T）">上界通配符（? extends T）</h4><p>未知类型 (?) 是 T 或 T 的某个子类型。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">import</span> java.util.Arrays;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpperBoundWildcard</span> &#123;    <span class="hljs-comment">// 使用上界通配符，表示这个 List 包含的是 Number 或者 Number 的某个子类</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">sumOfList</span><span class="hljs-params">(List&lt;? extends Number&gt; list)</span> &#123;        <span class="hljs-type">double</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;        <span class="hljs-keyword">for</span> (Number n : list) &#123;            <span class="hljs-comment">// 我们可以安全地从中读取数据，并转型为 Number</span>            sum += n.doubleValue();        &#125;        <span class="hljs-comment">// list.add(Integer.valueOf(1)); // 编译错误！</span>        <span class="hljs-keyword">return</span> sum;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        List&lt;Integer&gt; intList = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);        System.out.println(<span class="hljs-string">&quot;Sum = &quot;</span> + sumOfList(intList)); <span class="hljs-comment">// 合法</span>        List&lt;Double&gt; doubleList = Arrays.asList(<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">3.3</span>);        System.out.println(<span class="hljs-string">&quot;Sum = &quot;</span> + sumOfList(doubleList)); <span class="hljs-comment">// 合法</span>    &#125;&#125;</code></pre></div><ul><li>这里的addNumbers函数可以接收<code>List&lt;Integer&gt;</code>, <code>List&lt;Double&gt;</code>等，只要是Number的子类.</li></ul><h4 id="下界通配符-super-T">下界通配符 (? super T)</h4><p>未知类型 (?) 是 T 或 T 的某个父类型。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LowerBoundWildcard</span> &#123;    <span class="hljs-comment">// 使用下界通配符，表示这个 List 的类型是 Integer 或是 Integer 的某个父类</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addNumbers</span><span class="hljs-params">(List&lt;? <span class="hljs-built_in">super</span> Integer&gt; list)</span> &#123;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++) &#123;            <span class="hljs-comment">// 我们可以安全地向其中添加 Integer 对象</span>            list.add(i);        &#125;        <span class="hljs-comment">// Object obj = list.get(0); // 读取时只能保证是 Object 类型</span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        List&lt;Integer&gt; intList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();        addNumbers(intList);        System.out.println(intList); <span class="hljs-comment">// 输出: [1, 2, 3]</span>        List&lt;Number&gt; numList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();        addNumbers(numList);        System.out.println(numList); <span class="hljs-comment">// 输出: [1, 2, 3]</span>        List&lt;Object&gt; objList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();        addNumbers(objList);        System.out.println(objList); <span class="hljs-comment">// 输出: [1, 2, 3]</span>    &#125;&#125;</code></pre></div><ul><li>这里的addNumbers函数可以接收<code>List&lt;Integer&gt;</code>, <code>List&lt;Number&gt;</code>, <code>List&lt;Object&gt;</code>.</li></ul><h2 id="实际应用">实际应用</h2><h3 id="封装统一的-API-响应">封装统一的 API 响应</h3><p>在开发 RESTful API 时，我们通常希望返回统一的 JSON 结构，例如：<br>{ “success”: true, “code”: 200, “message”: “操作成功”, “data”: … }<br>这里的 data 字段内容是动态变化的，可能是单个用户信息，也可能是商品列表。这时可以使用范型响应类来解决：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; &#123;    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;    <span class="hljs-keyword">private</span> String message;    <span class="hljs-keyword">private</span> T data; <span class="hljs-comment">// data 的类型由 T 决定</span>    <span class="hljs-comment">// 构造函数、Getter、Setter...</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> &#123;        <span class="hljs-comment">// ... 返回一个表示成功的 ApiResponse 实例</span>    &#125;&#125;<span class="hljs-comment">// 在 Controller 中的应用</span><span class="hljs-meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span><span class="hljs-keyword">public</span> ApiResponse&lt;UserDTO&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;    <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findUserById(id);    <span class="hljs-keyword">return</span> ApiResponse.success(user);&#125;<span class="hljs-meta">@GetMapping(&quot;/products&quot;)</span><span class="hljs-keyword">public</span> ApiResponse&lt;List&lt;ProductDTO&gt;&gt; <span class="hljs-title function_">listProducts</span><span class="hljs-params">()</span> &#123;    List&lt;ProductDTO&gt; products = productService.findAll();    <span class="hljs-keyword">return</span> ApiResponse.success(products);&#125;</code></pre></div><h3 id="创建通用的服务层-数据访问层">创建通用的服务层/数据访问层</h3><p>在典型的分层架构中，许多实体（如 User, Product, Order）的增删改查逻辑非常相似。为每个实体都写一套重复的 DAO/Repository 和 Service 是非常繁琐的。这时，可以利用泛型来抽象出一个通用的基类或接口。以下是一个用MyBatis的例子：</p><p>创建通用的 BaseMapper 接口：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// BaseMapper.java</span><span class="hljs-comment">// 这个接口不需要 @Mapper 注解，因为它不会被直接实例化</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BaseMapper</span>&lt;T, ID&gt; &#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * 根据ID查找实体</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 主键</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 实体对象</span><span class="hljs-comment">     */</span>    T <span class="hljs-title function_">findById</span><span class="hljs-params">(ID id)</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * 插入一个实体</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> entity 实体对象</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 影响的行数</span><span class="hljs-comment">     */</span>    <span class="hljs-type">int</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(T entity)</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * 更新一个实体</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> entity 实体对象</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 影响的行数</span><span class="hljs-comment">     */</span>    <span class="hljs-type">int</span> <span class="hljs-title function_">update</span><span class="hljs-params">(T entity)</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * 根据ID删除</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 主键</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 影响的行数</span><span class="hljs-comment">     */</span>    <span class="hljs-type">int</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(ID id)</span>;&#125;</code></pre></div><ul><li>这个接口定义了一个契约：任何实现了 BaseMapper 的子接口，都将拥有这四个基本的 CRUD 方法。T 和 ID 此时是占位符。</li></ul><p>创建具体的业务 Mapper 接口：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// UserMapper.java</span><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User, Long&gt; &#123;    <span class="hljs-comment">// 继承了 findById(Long), insert(User), update(User), deleteById(Long)</span>    <span class="hljs-comment">// 只需在这里添加 User 特有的方法</span>    User <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(String username)</span>;&#125;<span class="hljs-comment">// ProductMapper.java</span><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Product, Long&gt; &#123;    <span class="hljs-comment">// 同理</span>    List&lt;Product&gt; <span class="hljs-title function_">findByStatus</span><span class="hljs-params">(<span class="hljs-type">int</span> status)</span>;&#125;</code></pre></div><p>编写xml语句：</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;[http://mybatis.org/dtd/mybatis-3-mapper.dtd](http://mybatis.org/dtd/mybatis-3-mapper.dtd)&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.example.mapper.UserMapper&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.example.model.User&quot;</span>&gt;</span>        SELECT * FROM users WHERE id = #&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.example.model.User&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span>        INSERT INTO users (username, password) VALUES (#&#123;username&#125;, #&#123;password&#125;)    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUsername&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.example.model.User&quot;</span>&gt;</span>        SELECT * FROM users WHERE username = #&#123;username&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p>创建通用的 BaseService 抽象类：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// BaseService.java</span><span class="hljs-comment">// 这是一个抽象类，不能被直接实例化</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseService</span>&lt;T, ID&gt; &#123;    <span class="hljs-comment">// 使用 protected，子类也可以访问</span>    <span class="hljs-keyword">protected</span> BaseMapper&lt;T, ID&gt; mapper;    <span class="hljs-comment">// 通过构造函数，强制子类传入具体的 Mapper 实例</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BaseService</span><span class="hljs-params">(BaseMapper&lt;T, ID&gt; mapper)</span> &#123;        <span class="hljs-built_in">this</span>.mapper = mapper;    &#125;    <span class="hljs-comment">// 通用的业务逻辑</span>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">findById</span><span class="hljs-params">(ID id)</span> &#123;        <span class="hljs-keyword">return</span> mapper.findById(id);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">save</span><span class="hljs-params">(T entity)</span> &#123;        <span class="hljs-comment">// 其他逻辑...</span>        <span class="hljs-keyword">return</span> mapper.insert(entity);    &#125;&#125;</code></pre></div><ul><li>抽象类：它依赖一个不确定的 BaseMapper，它本身不能独立工作，必须由一个具体的子类来提供具体的 Mapper。</li><li>构造函数注入：我们不能直接 @Autowired BaseMapper，因为 Spring 不知道该注入 UserMapper 还是 ProductMapper。所以，我们要求子类在创建时，必须通过构造函数把它自己对应的具体 Mapper 传给父类。</li></ul><p>创建具体的业务 Service 类：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// UserService.java</span><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseService</span>&lt;User, Long&gt; &#123;    <span class="hljs-comment">// Spring 会自动找到 UserMapper 的实例并注入到这个构造函数中</span>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">(UserMapper userMapper)</span> &#123;        <span class="hljs-comment">// 调用父类的构造函数，将具体的 userMapper 传递进去</span>        <span class="hljs-comment">// 这样，父类 BaseService 中的 mapper 字段就持有了 UserMapper 的引用</span>        <span class="hljs-built_in">super</span>(userMapper);    &#125;    <span class="hljs-comment">// UserService继承了BaseService的基础的CRUD逻辑</span>    <span class="hljs-comment">// 在这里编写 User 特有的业务逻辑</span>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password)</span> &#123;        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> ((UserMapper) <span class="hljs-built_in">this</span>.mapper).findByUsername(username); <span class="hljs-comment">// 需要强转来调用子类特有方法</span>        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span> &amp;&amp; user.getPassword().equals(password)) &#123;            <span class="hljs-keyword">return</span> user;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - 日志</title>
    <link href="/2025/07/16/JAVA/java-log/"/>
    <url>/2025/07/16/JAVA/java-log/</url>
    
    <content type="html"><![CDATA[<h2 id="日志">日志</h2><p>日志级别：</p><ol><li>TRACE:  log.trace() 最详细的日志（几乎每一行代码都记录），不常用，只在本地调试</li><li>DEBUG:  log.debug() 调试用的信息，比如变量值、函数调用，但一般只在开发环境用</li><li>INFO: <a href="http://log.info">log.info</a>()  一般性的信息，比如“服务启动成功”、“任务完成”，生产环境常用</li><li>WARN: log.warn()  警告，程序还能运行，但可能有问题，一定要看</li><li>ERROR:  log.error() 严重错误，比如连接失败、抛异常，非常重要</li><li>FATAL:  log.fatal() 致命错误，程序无法继续，较少用，一般跟 error 同级别处理</li></ol><p>在配置文件里可以设置希望打印的日志级别，比如<code>log4j.rootLogger=INFO, console</code>（只打印 INFO 及以上级别的日志，DEBUG 就不打印）。</p><h3 id="log4j">log4j</h3><p>Log4j 是一个流行的 Java 日志框架。Log4j 1.x 已经停止维护，不推荐使用。以下介绍 log4j 2.x。</p><h3 id="如何使用">如何使用</h3><p>配置文件 <code>src/main/resources/log4j2.xml</code>，用于定义日志的配置。主要包含两大部分：</p><ol><li><code>&lt;Appenders&gt;</code>：用于定义输出目的地，以及其对应的输出格式等。</li><li><code>&lt;Loggers&gt;</code>：用于配置不同类/包的日志级别和使用哪些 Appenders。</li></ol><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&quot;WARN&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">Properties</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logPath&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/home/logs&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">Properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Console&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d&#123;HH:mm:ss&#125;] [%t] %-5level %c - %msg%n&quot;</span> /&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FileLogger&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;logPath&#125;/app.log&quot;</span> <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;logs/app-%d&#123;yyyy-MM-dd&#125;.log&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] [%t] %-5level: %msg%n&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">modulate</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.example.main&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span> /&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.example.util&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;debug&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span> /&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FileLogger&quot;</span> /&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></code></pre></div><p>语法解释：</p><ul><li><p><code>&lt;Properties&gt;</code>：用于在配置文件中定义变量，这些变量可以在后续的配置元素中被引用。</p></li><li><p><code>&lt;RollingFile&gt;</code>：用于配置 日志文件滚动，即当日志文件达到一定条件时，自动进行日志切割（例如：按大小、按日期等）。</p></li><li><p><code>&lt;Policies&gt;</code>：定义触发日志滚动的策略</p></li><li><p>TimeBasedTriggeringPolicy：按时间滚动</p></li><li><p>SizeBasedTriggeringPolicy：按日志文件大小滚动</p></li><li><p><code>&lt;PatternLayout&gt;</code>：用于设置日志输出格式，比如<code>&lt;PatternLayout pattern=&quot;[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%t] %-5p [%c{2}] [%X{requestId}] - %m%n&quot; /&gt;</code>的输出示例为：[2025-07-20 13:47:15.324] [main] INFO  [MyService] [abc123] - 用户登录成功。</p></li><li><p><code>%d{HH:mm:ss}</code>：时:分:秒</p></li><li><p><code>%t</code>：当前线程名字</p></li><li><p><code>%–5p</code>：等价于<code>%-5level</code>，以5个字符宽度，左对齐的格式来输出日志级别，比如INFO，ERROR等。</p></li><li><p><code>%m</code>：日志消息内容，就是代码中写的那段文字</p></li><li><p><code>%c{2}</code>：<code>%c</code>是日志记录器的名称，通常是当前类的全限定名，<code>{2}</code>表示只输出“类名的最后两级”（包名 + 类名），比如：<code>com.example.app.MyService</code>，那么<code>{2}</code>代表<code>app.MyService</code>，<code>{1}</code>代表<code>MyService</code></p></li><li><p><code>%X{requestId}</code>：输出MDC（Mapped Diagnostic Context）中的键值对，MDC由ThreadContext定义。这里输出ThreadContext中的requestId。</p></li><li><p><code>&lt;Loggers&gt;</code>：标签用于定义特定包、类或者模块的日志设置。它可以用来调整日志级别和指定该日志使用的输出目标。</p></li><li><p>name：指定要配置的日志器的名称，通常是包名或类名。</p></li><li><p>additivity：表示日志是否向上传递到上级 Logger（通常是 Root Logger）继续输出。<code>additivity=&quot;true&quot;</code>，向上传递，会输出多次。<code>additivity=&quot;false&quot;</code>：不向上传递，只在当前 Logger 配置的 Appender 中输出一次。</p></li><li><p>AppenderRef：指定日志的输出目的地。一个 <code>&lt;Logger&gt;</code> 下可能有多个 AppenderRef，说明该包/类的日志会输出到多个目的地。</p></li></ul><p>示例：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.logging.log4j.LogManager;<span class="hljs-keyword">import</span> org.apache.logging.log4j.Logger;<span class="hljs-keyword">import</span> org.apache.logging.log4j.ThreadContext;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogManager.getLogger(MyService.class);    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String userId)</span> &#123;        ThreadContext.put(<span class="hljs-string">&quot;requestId&quot;</span>, userId); <span class="hljs-comment">// 设置上下文变量</span>        logger.info(<span class="hljs-string">&quot;用户登录成功&quot;</span>);        ThreadContext.clearAll(); <span class="hljs-comment">// 清理</span>    &#125;&#125;</code></pre></div><h3 id="Commons-Logging">Commons Logging</h3><p>Commons Logging 是 Apache 提供的一个轻量级日志抽象层，它并不实际提供日志实现，而是提供了一个统一的接口来调用不同的日志框架。在大型项目或类库中，如果直接使用 Log4j、JUL、SLF4J 等具体实现，会导致项目之间耦合太强、灵活性差。而使用 Commons Logging 可以做到代码不依赖具体的日志实现，可以切换日志底层实现。Commons Logging 会自动绑定到 Log4j，当它在 classpath 中找到 log4j.jar 时，Commons Logging 会选择 Log4j 作为底层日志实现。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.logging.Log;<span class="hljs-keyword">import</span> org.apache.commons.logging.LogFactory;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LogFactory.getLog(MyApp.class);    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        log.info(<span class="hljs-string">&quot;程序开始运行&quot;</span>);        log.warn(<span class="hljs-string">&quot;这是一个警告&quot;</span>);        log.error(<span class="hljs-string">&quot;发生了错误&quot;</span>);    &#125;&#125;</code></pre></div><h3 id="SLF4J">SLF4J</h3><p>类似 Commons Logging，但更加现代、稳定。它提供的是一组统一的日志接口（API），本身不处理日志的输出，而是将日志调用委托给具体的日志实现（如 Logback、Log4j2、JUL 等）来完成。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloSLF4J</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HelloSLF4J.class);    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Eric&quot;</span>;        logger.info(<span class="hljs-string">&quot;My name is &#123;&#125;&quot;</span>, name);        logger.info(<span class="hljs-string">&quot;Hello, SLF4J!&quot;</span>);    &#125;&#125;</code></pre></div><h2 id="绑定器">绑定器</h2><p>在一个项目中只使用一个日志实现库，避免多个日志框架共同参与日志处理。</p><h3 id="slf4j-log4j12">slf4j-log4j12</h3><p>slf4j-log4j12 是 SLF4J 提供的一个绑定器，它的作用是把 SLF4J 的日志调用转发给 Log4j 1.x 实现。只要这个绑定器在你的 classpath 中，所有使用 SLF4J 打的日志（包括你和你引入的库）就都会被转发到 Log4j，并使用你项目里的 log4j.properties 或 log4j.xml 配置输出。</p><p>由于Logback 是 SLF4J 的原生实现，如果想要使用 SLF4J 作为日志门面，并使用 Log4j 作为底层日志实现，必须需要这个绑定器。</p><h3 id="log4j-slf4j-impl">log4j-slf4j-impl</h3><p>Log4j 2 提供的官方 SLF4J 绑定器，用于将所有 SLF4J API 的日志调用转发到 Log4j2 实现。</p>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发基础知识 - Mybatis介绍</title>
    <link href="/2025/07/13/SWE-basis/Database/mybatis/"/>
    <url>/2025/07/13/SWE-basis/Database/mybatis/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>MyBatis的作用：</p><ul><li>自定义MySQL内容，自由度高</li><li>对象映射，查询结果会自动转换成 Java 对象</li><li>代码解耦，SQL 写在 XML 里</li></ul><h2 id="使用MyBatis">使用MyBatis</h2><ol><li>写配置文件<br>告诉MyBatis数据库怎么连接，SQL映射文件的位置</li></ol><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">environments</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span>        ...      <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;mapper/UserMapper.xml&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><ol start="2"><li>定义SQL和映射关系</li></ol><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.example.UserMapper&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>    SELECT * FROM user WHERE id = #&#123;id&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><ul><li>resultType=“User” 表示 SQL 查询结果转换成 User 对象</li><li>#{id} 是 MyBatis 的占位符，会自动替换参数</li></ul><ol start="3"><li>定义接口</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>;&#125;</code></pre></div><ol start="4"><li>在service层使用</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.getUserById(<span class="hljs-number">5</span>);</code></pre></div><h2 id="MyBatis原理">MyBatis原理</h2><p>MyBatis 利用 Java 的动态代理机制，把你写的 Mapper 接口（如 UserMapper）<strong>动态生成一个实现类</strong>，这个实现类会根据配置的 XML/注解执行对应的 SQL，并自动把结果映射成对象。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 这个 SqlSession 是每次数据库操作的“会话对象”</span><span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();<span class="hljs-comment">// 核心：动态生成 Mapper 实现类</span><span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> session.getMapper(UserMapper.class);<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.getUserById(<span class="hljs-number">5</span>);</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>开发基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发基础知识 - Spring的应用结构</title>
    <link href="/2025/07/13/SWE-basis/Spring/spring-architecture/"/>
    <url>/2025/07/13/SWE-basis/Spring/spring-architecture/</url>
    
    <content type="html"><![CDATA[<h2 id="Content">Content</h2><p>以一个基于Dubbo，MyBatis的后台服务框架为例：</p><p>File structure:</p><div class="code-wrapper"><pre><code class="hljs nix">api<span class="hljs-symbol">/</span>├── src<span class="hljs-symbol">/</span>│   ├── main<span class="hljs-symbol">/</span>│   │   ├── java<span class="hljs-symbol">/</span>│   │   │   └── com<span class="hljs-symbol">/</span>│   │   │       └── example<span class="hljs-symbol">/</span>│   │   │           └── api<span class="hljs-symbol">/</span>│   │   │               ├── entity<span class="hljs-symbol">/</span>│   │   │               │   └── User.java│   │   │               ├── mapper<span class="hljs-symbol">/</span>│   │   │               │   └── UserMapper.java│   │   │               ├── service<span class="hljs-symbol">/</span>│   │   │               │   ├── UserService.java│   │   │               │   └── implementation<span class="hljs-symbol">/</span>│   │   │               │       └── UserServiceImpl.java│   │   └── resources<span class="hljs-symbol">/</span>│   │       ├── applicationContext.xml│   │       ├── dubbo-provider.xml│   │       └── mapper<span class="hljs-symbol">/</span>│   │           └── UserMapper.xml└── pom.xml</code></pre></div><h3 id="实体类">实体类</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// User.java</span><span class="hljs-keyword">package</span> com.example.api.entity;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-comment">// getters and setters</span>&#125;</code></pre></div><h3 id="接口">接口</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// UserService.java</span><span class="hljs-keyword">package</span> com.example.api.service;<span class="hljs-keyword">import</span> com.example.api.entity.User;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span>;    List&lt;User&gt; <span class="hljs-title function_">listUsers</span><span class="hljs-params">()</span>;&#125;</code></pre></div><h3 id="MyBatis接口">MyBatis接口</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// UserMapper.java</span><span class="hljs-keyword">package</span> com.example.api.mapper;<span class="hljs-keyword">import</span> com.example.api.entity.User;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;    User <span class="hljs-title function_">selectUserById</span><span class="hljs-params">(Long id)</span>;    List&lt;User&gt; <span class="hljs-title function_">selectAllUsers</span><span class="hljs-params">()</span>;&#125;</code></pre></div><h3 id="MyBatis映射文件">MyBatis映射文件</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><span class="hljs-meta">    <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">    <span class="hljs-string">&quot;[http://mybatis.org/dtd/mybatis-3-mapper.dtd](http://mybatis.org/dtd/mybatis-3-mapper.dtd)&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.example.api.mapper.UserMapper&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.example.api.entity.User&quot;</span>&gt;</span>        SELECT id, name, age FROM user WHERE id = #&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAllUsers&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.example.api.entity.User&quot;</span>&gt;</span>        SELECT id, name, age FROM user    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><h3 id="服务实现类">服务实现类</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// UserServiceImpl.java</span><span class="hljs-keyword">package</span> com.example.api.service.implementation;<span class="hljs-keyword">import</span> com.example.api.entity.User;<span class="hljs-keyword">import</span> com.example.api.mapper.UserMapper;<span class="hljs-keyword">import</span> com.example.api.service.UserService;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;    <span class="hljs-keyword">private</span> UserMapper userMapper;    <span class="hljs-comment">// Spring 注入 setter</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserMapper</span><span class="hljs-params">(UserMapper userMapper)</span> &#123;        <span class="hljs-built_in">this</span>.userMapper = userMapper;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> &#123;        <span class="hljs-keyword">return</span> userMapper.selectUserById(id);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">listUsers</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> userMapper.selectAllUsers();    &#125;&#125;</code></pre></div><h3 id="Dubbo配置文件">Dubbo配置文件</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:application</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user-provider&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;N/A&quot;</span>/&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:protocol</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dubbo&quot;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;20880&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.example.api.service.UserService&quot;</span></span><span class="hljs-tag">               <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userService&quot;</span>/&gt;</span></code></pre></div><h3 id="Spring配置文件">Spring配置文件</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;[http://www.springframework.org/schema/beans](http://www.springframework.org/schema/beans)&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;[http://www.springframework.org/schema/context](http://www.springframework.org/schema/context)&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;[http://www.w3.org/2001/XMLSchema-instance](http://www.w3.org/2001/XMLSchema-instance)&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xmlns:dubbo</span>=<span class="hljs-string">&quot;[http://dubbo.apache.org/schema/dubbo](http://dubbo.apache.org/schema/dubbo)&quot;</span></span><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><span class="hljs-string"><span class="hljs-tag">           [http://www.springframework.org/schema/beans](http://www.springframework.org/schema/beans) [http://www.springframework.org/schema/beans/spring-beans.xsd](http://www.springframework.org/schema/beans/spring-beans.xsd)</span></span><span class="hljs-string"><span class="hljs-tag">           [http://www.springframework.org/schema/context](http://www.springframework.org/schema/context) [http://www.springframework.org/schema/context/spring-context.xsd](http://www.springframework.org/schema/context/spring-context.xsd)</span></span><span class="hljs-string"><span class="hljs-tag">           [http://dubbo.apache.org/schema/dubbo](http://dubbo.apache.org/schema/dubbo) [http://dubbo.apache.org/schema/dubbo/dubbo.xsd](http://dubbo.apache.org/schema/dubbo/dubbo.xsd)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.zaxxer.hikari.HikariDataSource&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/testdb&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mapper/*.xml&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.example.api.mapper&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.example.api.service.implementation.UserServiceImpl&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userMapper&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userMapper&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;dubbo-provider.xml&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre></div><h2 id="properties文件">.properties文件</h2><p>.properties文件是一种键值对格式的文本文件。比如：</p><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8080</span><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/testdb</span><span class="hljs-attr">logging.level.root</span>=<span class="hljs-string">INFO</span></code></pre></div><ol><li>配置文件放在指定路径（比如 src/main/resources 目录下）</li><li>启动 Spring 应用时，Spring 会自动读取这些配置文件</li><li>利用 Spring 的 @Value 或 @ConfigurationProperties 注解，就能把配置值“注入”到 Java 代码里</li></ol><p>比如：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// application.properties: app.title=xxx</span><span class="hljs-meta">@Value(&quot;$&#123;app.title&#125;&quot;)</span><span class="hljs-keyword">private</span> String title;</code></pre></div><p>当程序运行时，Spring 会把 app.title 的值 “我的Spring网站” 注入到这个 title 变量里。</p>]]></content>
    
    
    <categories>
      
      <category>开发基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Annotation</title>
    <link href="/2025/07/10/JAVA/annotation/"/>
    <url>/2025/07/10/JAVA/annotation/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Java 注解（Annotation）是 Java 从 JDK 5 开始引入的一种语法结构，用来为代码添加元数据。比如：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;&#125;</code></pre></div><p>在编译过程中，注释会被忽略，但是注解会被编译器打包进.class文件。</p><h2 id="自定义注解">自定义注解</h2><p>Java中，使用 @interface 来定义注解。比如：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyLog &#123;    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;default log&quot;</span>;&#125;</code></pre></div><h3 id="元注解">元注解</h3><p>元注解是可以修饰其他注解的注解。</p><p>@Taregt 可以定义注解能够被应用于源码的哪些位置。</p><ul><li>ElementType.TYPE：类或接口</li><li>ElementType.FIELD：字段</li><li>ElementType.METHOD：方法</li><li>ElementType.CONSTRUCTOR：构造方法</li><li>ElementType.PARAMETER：方法参数</li></ul><p>@Retention定义了注解要在 Java 编译流程的哪个阶段保留。</p><ul><li>SOURCE：只保留在源码中，编译时就扔掉。</li><li>CLASS：保留在 .class 文件中，但 JVM 运行时无法读取。比如用于指导编译器如何生成字节码。</li><li>RUNTIME：保留到运行时，可以用反射获取。Spring的注解都属于RUNTIME。</li></ul><h3 id="语法">语法</h3><p>比如我想定义一个 @Check 注解，标记在方法上，然后在程序运行的时候，自动检查这个注解是否存在，并打印 value 的内容。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;    <span class="hljs-meta">@Check(&quot;正在检查这个方法&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Do Something...&quot;</span>);    &#125;&#125;<span class="hljs-comment">/*</span><span class="hljs-comment">期望输出：</span><span class="hljs-comment">检查到方法: doSomething()</span><span class="hljs-comment">注解的值是: 正在检查这个方法</span><span class="hljs-comment">Do Something...</span><span class="hljs-comment">*/</span></code></pre></div><p>定义注解：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<span class="hljs-keyword">import</span> java.lang.annotation.Target;<span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<span class="hljs-comment">// 自定义注解</span><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="hljs-comment">// 表示注解在运行时仍然可见</span><span class="hljs-meta">@Target(ElementType.METHOD)</span>         <span class="hljs-comment">// 表示注解可以作用在方法上</span><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Check &#123;    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 注解的参数</span>&#125;</code></pre></div><p>使用注解的类：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;    <span class="hljs-meta">@Check(&quot;正在检查这个方法&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Do Something...&quot;</span>);    &#125;    <span class="hljs-meta">@Check(&quot;另一个需要检查的方法&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">anotherThing</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Do Another Thing...&quot;</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">noCheck</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;这个方法没有注解，不用检查&quot;</span>);    &#125;&#125;</code></pre></div><p>写一个注解处理器，用反射来读取注解信息：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.reflect.Method;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CheckProcessor</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;        <span class="hljs-comment">// 创建被检查对象</span>        <span class="hljs-type">MyService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyService</span>();        <span class="hljs-comment">// 反射获取类信息</span>        Class&lt;?&gt; clazz = service.getClass();        <span class="hljs-comment">// 遍历类中所有方法</span>        <span class="hljs-keyword">for</span> (Method method : clazz.getDeclaredMethods()) &#123;            <span class="hljs-comment">// 判断方法上是否有 @Check 注解</span>            <span class="hljs-keyword">if</span> (method.isAnnotationPresent(Check.class)) &#123;                <span class="hljs-type">Check</span> <span class="hljs-variable">checkAnnotation</span> <span class="hljs-operator">=</span> method.getAnnotation(Check.class);                System.out.println(<span class="hljs-string">&quot;检查到方法: &quot;</span> + method.getName());                System.out.println(<span class="hljs-string">&quot;注解的值是: &quot;</span> + checkAnnotation.value());                <span class="hljs-comment">// 执行这个方法</span>                method.invoke(service);                System.out.println(<span class="hljs-string">&quot;-----------------------------&quot;</span>);            &#125;        &#125;    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Java 编译，打包，运行</title>
    <link href="/2025/07/09/JAVA/java-cli/"/>
    <url>/2025/07/09/JAVA/java-cli/</url>
    
    <content type="html"><![CDATA[<h2 id="Java-Package">Java Package</h2><p>package 是 Java 的命名空间机制，用于将类（class）、接口（interface）组织在一起，形成模块化、层次化的结构。</p><div class="code-wrapper"><pre><code class="hljs avrasm">project/└── src/    └── <span class="hljs-keyword">com</span>/        └── companyName/            └── app/                └── models/                    └── Person.java</code></pre></div><p>这里的Person.java文件位于包 <code>package com.companyName.app.models;</code>.</p><h3 id="导入其他包的类">导入其他包的类</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.companyName.app.models.Person;<span class="hljs-keyword">import</span> com.companyName.app.models.*;</code></pre></div><h2 id="Java编译与运行">Java编译与运行</h2><p>以如下文件结构为例：</p><div class="code-wrapper"><pre><code class="hljs css">project-folder/├── lib/│   └── gson-<span class="hljs-number">2.10</span>.<span class="hljs-number">1</span><span class="hljs-selector-class">.jar</span>├── <span class="hljs-attribute">src</span>/│   ├── <span class="hljs-selector-tag">Main</span><span class="hljs-selector-class">.java</span>  --&gt; package <span class="hljs-attribute">src</span>│   └── models/│       └── Person<span class="hljs-selector-class">.java</span>  --&gt; package <span class="hljs-attribute">src</span><span class="hljs-selector-class">.models</span></code></pre></div><h3 id="编译">编译</h3><p>Java编译基本语法：<code>javac [选项] 文件名.java</code></p><div class="code-wrapper"><pre><code class="hljs shell">javac -cp &quot;lib/gson-2.10.1.jar&quot; -d out src/models/Person.java src/Main.java</code></pre></div><ul><li>-cp 是 classpath 的缩写，用来告诉编译器 在哪找外部的类和库。</li><li>-d 指定输出目录</li></ul><h3 id="运行">运行</h3><p>Java运行基本语法：<code>java [选项] 类名</code></p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">运行时指定classpath</span>java -cp &quot;out:lib/gson-2.10.1.jar&quot; src.Main</code></pre></div><ul><li><code>:</code>：Linux/macOS 上的路径分隔符</li></ul><h2 id="jar文件">.jar文件</h2><h3 id="Definition">Definition</h3><p>在 Java 开发中，你写了很多 <code>.java 文件</code>，编译之后变成 <code>.class</code> 文件。但是如果想要</p><ol><li>让别人用你的程序</li><li>部署到服务器上运行</li><li>用到很多类和资源文件<br>管理许多 <code>.class</code> 文件变成了难题，这时就要用 <code>.jar</code> 来打包这些零碎的文件，合成一个独立的、结构良好的文件。这个文件可以运行，也可以作为库被其他项目引用。</li></ol><p>其实 .jar 就是一个 压缩包（类似 .zip），里面的结构通常像这样：</p><div class="code-wrapper"><pre><code class="hljs stylus">myapp<span class="hljs-selector-class">.jar</span>├── META-INF/│   └── MANIFEST<span class="hljs-selector-class">.MF</span>   ← 描述文件，记录入口点（程序从哪里开始）├── com/│   └── example/│       └── MyClass<span class="hljs-selector-class">.class</span>├── config<span class="hljs-selector-class">.properties</span>├── <span class="hljs-selector-tag">image</span>.png</code></pre></div><p>以如下文件结构为例：</p><div class="code-wrapper"><pre><code class="hljs css">project-folder/├── lib/│   └── gson-<span class="hljs-number">2.10</span>.<span class="hljs-number">1</span><span class="hljs-selector-class">.jar</span>├── <span class="hljs-attribute">src</span>/│   ├── <span class="hljs-selector-tag">Main</span><span class="hljs-selector-class">.java</span>  --&gt; package <span class="hljs-attribute">src</span>│   └── models/│       └── Person<span class="hljs-selector-class">.java</span>  --&gt; package <span class="hljs-attribute">src</span><span class="hljs-selector-class">.models</span></code></pre></div><h3 id="创建，运行jar文件">创建，运行jar文件</h3><ol><li>供别人使用的类（普通的jar）</li></ol><div class="code-wrapper"><pre><code class="hljs shell">jar cf mylib.jar -C out/ .</code></pre></div><ul><li>c：create，表示创建一个新的 JAR 文件</li><li>f：file，表示后面跟的是 JAR 文件名</li><li><code>mylib.jar</code>：要创建的目标 JAR 文件名</li><li><code>-C out/ .</code>：表示进入 out/ 目录，并将其中的所有内容（.）打包进 JAR</li></ul><ol start="2"><li>可执行 JAR（别人可以运行你的程序）<br>创建 MANIFEST.MF 文件:</li></ol><div class="code-wrapper"><pre><code class="hljs mf">Manifest-Version: 1.0Main-Class: src.Main</code></pre></div><div class="code-wrapper"><pre><code class="hljs shell">jar cfm yourlib.jar MANIFEST.MF -C out/ .<span class="hljs-meta prompt_"># </span><span class="language-bash">执行jar文件（自动查找 Main-Class 并执行 main() 方法）</span>java -cp &quot;mylib.jar:lib/gson-2.10.1.jar&quot; src.Main</code></pre></div><ol start="3"><li>Maven打包</li></ol><p>可以把我的 jar 和所有依赖 合并成一个大 jar 文件</p><div class="code-wrapper"><pre><code class="hljs shell">mvn clean package</code></pre></div><p>Maven 会自动下载所需的依赖，并将所有文件打包成一个 JAR 文件，通常会生成一个类似 target/yourlib-1.0.0.jar 的文件。</p><h3 id="Usage">Usage</h3><ul><li>打包项目成一个文件</li><li>作为功能组件被其他 Java 程序引用使用（像 Spring、MyBatis、Lombok 都是以 .jar 的形式分发的）</li><li><code>.jar</code> 文件可以直接部署到服务器上运行</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Java异常</title>
    <link href="/2025/07/07/JAVA/java-exception/"/>
    <url>/2025/07/07/JAVA/java-exception/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Java中，所有异常的公共祖先都是 Throwable，Throwable下有两个子类：Error and Exception。</p><ul><li>Error：表示严重的错误，程序无法处理，比如OutOfMemoryError，StackOverflowError</li><li>Exception：程序本身可以处理的异常，通过Catch捕获。Exception分为两部分：<ul><li>Checked Exception：编译时，如果受检查异常没有被 catch 或者 throws 关键字处理的话，就没办法通过编译。包括Exception及其子类，除了RuntimeException。</li><li>Unchecked Exception：编译时不要求捕捉。包括RuntimeException及其子类。比如IndexOutOfBoundsException等</li></ul></li></ul><p>实际开发中，最重要的事情是保证程序运行不会崩溃。我们<strong>想要程序出错时不崩溃</strong>，而是告知错误发生在哪里，这样才能保证程序稳定的提供服务，因此需要异常机制。如果没有异常机制，则需要多个if-else语句来预测每一个可能出错的操作。</p><h2 id="Exception的工作机制">Exception的工作机制</h2><ul><li>抛出异常</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;    <span class="hljs-keyword">if</span> (age &lt; <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;年龄不能为负数！&quot;</span>);    &#125;&#125;</code></pre></div><ul><li>捕获异常</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> / <span class="hljs-number">0</span>;&#125; <span class="hljs-keyword">catch</span> (ArithmeticException e) &#123;    System.out.println(<span class="hljs-string">&quot;除数不能为 0&quot;</span>);&#125;</code></pre></div><ul><li>声明异常<br>一个方法内部如果可能出异常，但不想处理，就可以用 throws 声明它可能抛出异常，让调用者来处理。</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">(String path)</span> <span class="hljs-keyword">throws</span> FileNotFoundException &#123;    <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(path);&#125;<span class="hljs-comment">// 调用者必须处理这个异常，或者调用者的函数继续throws</span><span class="hljs-keyword">try</span> &#123;    readFile(<span class="hljs-string">&quot;test.txt&quot;</span>);&#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;    System.out.println(<span class="hljs-string">&quot;文件没找到！&quot;</span>);&#125;</code></pre></div><ul><li>自定义异常</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 定义异常类</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">AgeTooSmallException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Exception</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AgeTooSmallException</span><span class="hljs-params">(String message)</span> &#123;        <span class="hljs-built_in">super</span>(message);    &#125;&#125;<span class="hljs-comment">// 使用它</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> <span class="hljs-keyword">throws</span> AgeTooSmallException &#123;    <span class="hljs-keyword">if</span> (age &lt; <span class="hljs-number">18</span>) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgeTooSmallException</span>(<span class="hljs-string">&quot;年龄不能小于18！&quot;</span>);    &#125;&#125;<span class="hljs-keyword">try</span> &#123;    checkAge(<span class="hljs-number">16</span>);&#125; <span class="hljs-keyword">catch</span> (AgeTooSmallException e) &#123;    System.out.println(<span class="hljs-string">&quot;错误：&quot;</span> + e.getMessage());&#125;</code></pre></div><p>当异常被抛出时，Java 运行时系统会在当前方法中查找有没有对应的 catch。如果没有，方法就退出，异常被抛给上一级调用者。一直这样“向上传递”，直到找到匹配的 catch。如果一直没有人处理异常，最终程序崩溃。</p><p>调用一个带有<code>throws</code>的函数有两种处理方式：</p><ol><li>使用try-catch捕获异常</li><li>继续使用throws抛出异常，传递给更上一层</li></ol><h2 id="Exception-使用方法">Exception 使用方法</h2><p>当异常发生后，如果你没处理，Java 会沿着方法调用栈一级一级地回溯，寻找谁能处理。如果当前方法没有找到匹配的 catch 块，方法会立即终止执行，并从调用栈中弹出。然后，异常被传播到上一个调用该方法的方法中。</p><ul><li>使用多个catch语句</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;    <span class="hljs-keyword">try</span> &#123;      doSomething()    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        System.out.println(e);    &#125; <span class="hljs-keyword">catch</span> (NumberFormatException e) &#123;        System.out.println(e);    &#125;&#125;</code></pre></div><p>JVM在捕获到异常后，会从上到下匹配catch语句，直到找到匹配的语句。</p><ul><li>try-catch-finally</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;    <span class="hljs-keyword">try</span> &#123;      doSomething()    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        System.out.println(e);    &#125; <span class="hljs-keyword">catch</span> (NumberFormatException e) &#123;        System.out.println(e);    &#125; <span class="hljs-keyword">finally</span> &#123;        System.out.println(<span class="hljs-string">&quot;END&quot;</span>);    &#125;&#125;</code></pre></div><p>finally语句，无论是有无异常出现，都会执行，而且是最后执行。</p><h2 id="断言">断言</h2><p>断言（assertion）是一种程序中的调试语句，用来检测某个逻辑条件在运行时是否为真。如果条件为假，程序会抛出 AssertionError 异常，说明程序存在 Bug。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> getUserAge();<span class="hljs-keyword">assert</span> age &gt;= <span class="hljs-number">0</span> : <span class="hljs-string">&quot;年龄不能为负数&quot;</span>;<span class="hljs-comment">// 如果age &lt; 0，则输出 Exception in thread &quot;main&quot; java.lang.AssertionError: 年龄不能为负数</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - Java Object Oriented Programming</title>
    <link href="/2025/07/06/JAVA/java-oop/"/>
    <url>/2025/07/06/JAVA/java-oop/</url>
    
    <content type="html"><![CDATA[<h2 id="封装">封装</h2><p>封装就是“把数据和操作数据的方法打包在一起”，同时隐藏内部的实现细节。比如将字段用private修饰，只暴露getter和setter。</p><ul><li>防止外部随意修改对象的内部状态。</li><li>保持代码的安全性和清晰性。</li></ul><h2 id="继承">继承</h2><p>子类可以继承父类的<strong>属性和方法</strong>（使用 Extends 来继承）。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Some sound...&quot;</span>);    &#125;&#125;<span class="hljs-comment">// Dog 类继承了 Animal 类，也可以调用 makeSound()</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">bark</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Woof!&quot;</span>);    &#125;&#125;</code></pre></div><h2 id="多态">多态</h2><h3 id="编译时多态">编译时多态</h3><p>也叫方法重载（Overloading），是指在编译期间就已经确定了哪个方法会被调用。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> &#123;    <span class="hljs-comment">// 重载 add 方法</span>    <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;        <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> &#123;        <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> c)</span> &#123;        <span class="hljs-keyword">return</span> a + b + c;    &#125;&#125;</code></pre></div><p>编译器根据你传入的参数类型和个数，在编译阶段 就能决定调用哪个方法。</p><h3 id="运行时多态">运行时多态</h3><p>也叫 方法重写（Overriding），是指在运行期间才能决定调用哪个方法。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Some animal sound&quot;</span>);    &#125;&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Woof!&quot;</span>);    &#125;&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Meow!&quot;</span>);    &#125;&#125;<span class="hljs-type">Animal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();a.makeSound();  <span class="hljs-comment">// Woof!</span>a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();a.makeSound();  <span class="hljs-comment">// Meow!</span></code></pre></div><p>虽然变量类型是 Animal，但真正调用的是对象 Dog 或 Cat 中的 makeSound() 方法。</p><h2 id="接口和抽象类">接口和抽象类</h2><h3 id="抽象类">抽象类</h3><p>抽象类是一种不能直接创建对象的类，它是为了被继承而存在的。子类是否必须实现父抽象类的抽象方法。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;    String name;  <span class="hljs-comment">// 添加 name 属性</span>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span>; <span class="hljs-comment">// 留给子类实现</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;        System.out.println(name + <span class="hljs-string">&quot; is eating.&quot;</span>);    &#125;&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;    <span class="hljs-comment">// 实现抽象方法</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Woof!&quot;</span>);    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-type">Animal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();        a.name = <span class="hljs-string">&quot;Buddy&quot;</span>;        a.eat();        <span class="hljs-comment">// 输出: Buddy is eating.</span>        a.makeSound();  <span class="hljs-comment">// 输出: Woof!</span>    &#125;&#125;</code></pre></div><h3 id="接口">接口</h3><p>接口（interface）是一些方法的集合，它定义了类应该遵守的一组规范或能力。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// 自动是 public abstract</span>&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Flyable</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Bird is flying&quot;</span>);    &#125;&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Airplane</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Flyable</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Airplane is flying&quot;</span>);    &#125;&#125;<span class="hljs-type">Flyable</span> <span class="hljs-variable">f1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();<span class="hljs-type">Flyable</span> <span class="hljs-variable">f2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Airplane</span>();f1.fly();  <span class="hljs-comment">// Bird is flying</span>f2.fly();  <span class="hljs-comment">// Airplane is flying</span></code></pre></div><p>一个类可以实现多个接口：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span>;&#125;<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Swimmable</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span>;&#125;<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Flyable</span>, Swimmable &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> &#123; System.out.println(<span class="hljs-string">&quot;Duck flies&quot;</span>); &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> &#123; System.out.println(<span class="hljs-string">&quot;Duck swims&quot;</span>); &#125;&#125;</code></pre></div><p>此外</p><ol><li>接口中可以定义 default 方法，提供默认实现。</li><li>接口中可以定义 static 方法，不属于实现类，直接通过接口调用。</li><li>接口中可以定义 private 方法，用于接口内部复用代码。</li></ol><h2 id="Java关键字">Java关键字</h2><ol><li>访问控制</li></ol><ul><li>public：公有，所有地方都可以访问</li><li>private： 私有，只能在本类中访问</li><li>protected： 受保护，同包 + 子类可访问</li></ul><ol start="2"><li>final：表示不可修改：类不能继承、方法不能重写、变量不能变值</li></ol>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码学 - Base64编码</title>
    <link href="/2025/07/06/SWE-basis/Others/base64/"/>
    <url>/2025/07/06/SWE-basis/Others/base64/</url>
    
    <content type="html"><![CDATA[<h2 id="介绍">介绍</h2><p>Base64 是一种将二进制数据编码成文本字符格式（64 bit表示）的方法，常用于储存或者传输二进制数据。它的目的是为了数据传输的兼容性，而不是为了保密。编码后的数据是完全可逆的，任何人都可以通过解码算法还原出原始数据。</p><h3 id="为什么要Base64">为什么要Base64</h3><p>许多系统不支持处理二进制数据，比如HTTP，URL，JSON，HTML，.env文件等，因此要使用Base64编码。比如：</p><ol><li>HTTP 协议的 Header 只能包含 ASCII 字符，如果我要放入JWT做身份认证，但 JWT 的签名部分是二进制，因此要对 JWT 做 Base64 编码。</li><li>公钥和证书是一个二进制的结构，如果我要把公钥或证书放在配置文件或者JSON中做传输，就需要Base64编码，因此我们常看到的公钥或证书是一串字符而不是0/1。</li><li>在 HTML/CSS 中嵌入图片时，可以将小图片直接以 Base64 字符串的形式嵌入到 HTML 或 CSS 中，而无需单独的 HTTP 请求。</li></ol><h2 id="Base64原理">Base64原理</h2><p>Base64是基于64个字符（A-Z、a-z、0-9、+、/、=），也就是对二进制6位一组来表示二进制数据的。</p>]]></content>
    
    
    <categories>
      
      <category>密码学</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - 序列化 &amp; 反序列化</title>
    <link href="/2025/07/06/JAVA/serialization-deserialization/"/>
    <url>/2025/07/06/JAVA/serialization-deserialization/</url>
    
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><h3 id="UTF-8">UTF-8</h3><p>Unicode Transformation Format – 8-bit，用于在计算机中表示世界上所有的文字字符。</p><p>最早的编码是用ASCII，用一个字节（8位）表示字符，但它最多只能表示 128 个字符，不能表示世界上所有语言和符号。UTF-8 使用 1到4个字节 来编码一个字符，向后兼容 ASCII（前128个字符完全一样）。它是目前最广泛使用的字符编码，尤其是在网络、网页、编程语言中。</p><h2 id="Definition">Definition</h2><p>序列化就是把一个在内存中的数据对象（如变量、对象、数据结构）转换成一个可以存储或传输的格式的过程。<strong>在程序运行中，对象位于内存，如果想要把对象保存到硬盘、发送到网络、或写入文件，你必须把它转换成一种通用格式，比如 JSON、XML、或二进制流，这就是序列化</strong>。</p><p>反序列化是把序列化后的数据重新变成程序能使用的对象的过程。</p><h2 id="序列化-反序列化方法">序列化/反序列化方法</h2><h3 id="java-io-Serializable">java.io.Serializable</h3><p>java.io.Serializable 是 Java 自带的<strong>二进制</strong>序列化机制，用于在 Java 内部保存/传输对象（不像JSON是跨语言的）。</p><p>定义：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Serializable</span> &#123;&#125;</code></pre></div><p>它是一个标记接口，用于告诉 JVM 这个类的对象可以被序列化。<strong>如果一个类不实现Serializable，使用Java自带的序列化时，会抛出异常</strong>。因此 Java 要求你必须显示地声明你允许对象被序列化。这个是<strong>Java原生的序列化机制</strong>，使用 <code>ObjectOutputStream</code> 和 <code>ObjectInputStream</code> 来读写对象，Java 自动把对象转换为字节流或从字节流中恢复回来。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;&#125;<span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;p.dat&quot;</span>));out.writeObject(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>());</code></pre></div><h4 id="transient">transient</h4><p>使用 transient 关键字修饰的字段将被序列化机制完全忽略。它不会被写入字节流，因此在反序列化后，该字段将被赋予其类型的默认值。</p><h4 id="serialVersionUID">serialVersionUID</h4><p>如果你将一个对象序列化之后保存在磁盘或数据库中，过了一段时间后，你修改了这个类的结构（比如新增字段或删除字段），然后你尝试从旧的数据反序列化回对象，这时如果 serialVersionUID 不匹配，Java 会报错。如果你不自动加上这个字段，JVM 会根据类结构自动生成 serialVersionUID，但是如果修改了一个方法签名、改了注释、改了访问权限，都会生成不同的 ID，因此建议手动写死 serialVersionUID，以避免版本冲突。</p><p>在反序列化时，JVM 会比较流中对象的 serialVersionUID 和本地加载的类的 serialVersionUID。如果两者不匹配，将抛出 java.io.InvalidClassException。</p><h3 id="JSON">JSON</h3><p>JSON (JavaScript Object Notation)，是一个纯文本格式的数据容器。几乎所有的 Web API 都使用 JSON 作为数据交换标准，许多应用也用 <code>.json</code> 文件保存设置</p><div class="code-wrapper"><pre><code class="hljs javascript">&#123;  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Alice&quot;</span>,  <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">25</span>,  <span class="hljs-string">&quot;is_student&quot;</span>: <span class="hljs-literal">false</span>,  <span class="hljs-string">&quot;skills&quot;</span>: [<span class="hljs-string">&quot;Python&quot;</span>, <span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;C++&quot;</span>]&#125;</code></pre></div><h4 id="JSON原理">JSON原理</h4><p>JAVA语言中可以使用Jackson库来做序列化/反序列化。JSON 使用 UTF-8来编码，底层存储时，JSON 实际是一个 UTF-8 字节流。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();p.name = <span class="hljs-string">&quot;Alice&quot;</span>;p.age = <span class="hljs-number">25</span>;<span class="hljs-comment">// 创建 ObjectMapper（JSON 处理器）</span><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<span class="hljs-comment">// 序列化</span><span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(p);System.out.println(jsonStr); <span class="hljs-comment">// 输出：&#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:25&#125;</span><span class="hljs-comment">// 反序列化</span><span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;name\&quot;:\&quot;Alice\&quot;,\&quot;age\&quot;:25&#125;&quot;</span>;<span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> mapper.readValue(jsonStr, Person.class);</code></pre></div><p>序列化时，Jackson 会使用 Java 的反射机制，找到这个类的所有字段和值，然后 Jackson 根据字段类型判断要怎么转换为 JSON 语法，最后构建 JSON 字符串。</p><h3 id="XML">XML</h3><p>XML（eXtensible Markup Language） 是一种可扩展的标记语言，用于存储和传输数据。</p><p>XML示例：</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">person</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Alice<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">skills</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">skill</span>&gt;</span>Java<span class="hljs-tag">&lt;/<span class="hljs-name">skill</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">skill</span>&gt;</span>Python<span class="hljs-tag">&lt;/<span class="hljs-name">skill</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">skills</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">person</span> <span class="hljs-attr">age</span>=<span class="hljs-string">&quot;25&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Alice&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">city</span>&gt;</span>Beijing<span class="hljs-tag">&lt;/<span class="hljs-name">city</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span></code></pre></div><h3 id="Protobuf">Protobuf</h3><p>Protocol Buffers（Protobuf） 是由 Google 开发的一种高效、结构化、跨语言的数据序列化协议。它把数据结构转换成紧凑的二进制格式，用于在网络中传输或存储。<a href="https://thiefcat.github.io/2025/05/08/CSE224/rpc/#Protobuf">Protobuf 详细介绍</a></p>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - 反射</title>
    <link href="/2025/07/05/JAVA/reflection/"/>
    <url>/2025/07/05/JAVA/reflection/</url>
    
    <content type="html"><![CDATA[<h2 id="类加载器">类加载器</h2><p><a href="https://thiefcat.github.io/2025/07/04/JAVA/java-jvm/#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器介绍</a></p><h2 id="反射是什么">反射是什么</h2><p>反射（Reflection）是 Java 提供的一种能力，它允许程序在运行时检查和操作类、对象、方法、构造函数、字段等程序结构。</p><h2 id="反射的作用：">反射的作用：</h2><ul><li><p>Java 框架（比如 Spring、Hibernate）并不知道你会写哪些类，它必须在运行时“扫描”你的类、方法、注解，然后自动做一些操作。这必须靠反射。</p></li><li><p>一个软件支持插件，需要在运行时加载新插件类，也要用反射。<br>插件可以看作一个 <code>.jar</code> 文件，添加插件时，放到特定的文件夹。主程序运行的时候，会扫描这个文件夹。主程序用自定义类加载器加载插件 jar 文件，然后通过反射调用插件里的代码。</p></li><li><p>测试框架（JUnit）依赖反射。</p></li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogin</span><span class="hljs-params">()</span> &#123;    <span class="hljs-comment">// 测试登录逻辑</span>&#125;</code></pre></div><p>JUnit 并不事先知道你写了哪些测试类和测试方法。它运行的时候，扫描所有类，找出有 @Test 注解的方法，实例化类对象，调用这些方法。</p><ul><li>序列化 / 反序列化工具依赖反射。<br>序列化是把对象转换成可以存储或传输的格式（如 JSON、XML、二进制）。反序列化是反过来。</li></ul><p>比如反序列化时，将 JSON 转换成Java对象（<a href="https://thiefcat.github.io/2025/07/03/SWE-basic/serialization-deserialization/#JSON%E5%8E%9F%E7%90%86">JSON介绍</a>）：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// &#123;&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 20&#125;</span><span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(); <span class="hljs-comment">// name = &quot;Alice&quot;, age = 20</span></code></pre></div><p>我们从 JSON 字符串中知道 “name” 字段，但程序怎么知道它对应哪个 Java 字段？这时要通过反射。</p><h2 id="JAVA反射的原理">JAVA反射的原理</h2><h3 id="Class对象">Class对象</h3><p>在<a href="https://thiefcat.github.io/2025/07/04/JAVA/java-jvm/#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器介绍</a>提到，类加载器在堆中创建一个 Class 对象来存储类的信息。反射正是通过获取Class实例来获取到类的所有信息。</p><p>获取一个类的Class实例的方法：</p><ol><li>通过类名访问</li></ol><div class="code-wrapper"><pre><code class="hljs java">Class&lt;?&gt; clazz = String.class;</code></pre></div><ol start="2"><li>通过类的完整类名</li></ol><div class="code-wrapper"><pre><code class="hljs java">Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;java.lang.String&quot;</span>);</code></pre></div><ol start="3"><li>通过对象的 <code>getClass()</code> 方法</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello&quot;</span>;Class&lt;?&gt; clazz = str.getClass();</code></pre></div><h3 id="Class对象的常见操作">Class对象的常见操作</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> clazz.getName(); <span class="hljs-comment">// &quot;java.lang.String&quot;</span>Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class);<span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;substring&quot;</span>, <span class="hljs-type">int</span>.class, <span class="hljs-type">int</span>.class);<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> clazz.getDeclaredField(<span class="hljs-string">&quot;value&quot;</span>);<span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> clazz.getConstructor().newInstance(); <span class="hljs-comment">// 创建对象</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
      <tag>反射</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java基础 - JVM</title>
    <link href="/2025/07/04/JAVA/java-jvm/"/>
    <url>/2025/07/04/JAVA/java-jvm/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是JVM">什么是JVM</h2><p>Java的理念是：Write Once, Run Anywhere。Java编译器把 Java 程序编译成“字节码”（.class 文件），字节码可以在所有平台运行，这是JAVA特性之一。字节码是 JVM 能理解的“中间语言”，JVM可以把字节码翻译成你的电脑能理解的机器指令。因此只需要在不同的机器上安装适配不同架构的JVM，就可以实现 Write Once, Run Anywhere。</p><h3 id="JVM的功能">JVM的功能</h3><ul><li>跨平台运行</li><li>内存管理：JAVA帮助开发者垃圾回收，分配内存</li><li>性能优化：即时编译器（Just-In-Time ，JIT ），将热点代码（频繁执行的代码段）编译成本地机器码，以提高程序的执行性能</li><li>安全性：异常处理，类加载时字节码验证，沙箱环境等</li></ul><h2 id="JVM的运行时数据区域">JVM的运行时数据区域</h2><p>以JDK 1.7为例，</p><ul><li>线程私有的：<ul><li>程序计数器：当前线程执行的字节码位置</li><li>Java 虚拟机栈：每个线程的JAVA方法的“方法调用栈”，包含栈帧</li><li>本地方法栈：给调用 C、C++ 等非 Java 方法（native 方法）用的栈</li></ul></li><li>线程共享的<ul><li>堆：用来存储所有 Java 对象实例，由垃圾回收器（GC）统一管理</li><li>方法区：用来存储类的元数据（类的信息、常量、静态变量、方法字节码等）。</li></ul></li></ul><h2 id="类加载器">类加载器</h2><p>类加载器是指<strong>把类的字节码（通常是 .class 文件）加载到 JVM 的内存中</strong>，并生成相应的 Class 对象的工具。具体来说，类加载器把字节码（.class 文件）加载到 JVM 的方法区（Method Area）（Java 8 之后是 元空间（Metaspace）），然后在堆中创建一个 Class 对象来存储类的信息，方便反射操作。</p><p>类并不是一开始就全部加载。类加载器可以按需加载：当你第一次使用某个类时，它才去加载它。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;    <span class="hljs-keyword">static</span> List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();    <span class="hljs-keyword">static</span> &#123;        System.out.println(<span class="hljs-string">&quot;Person 类被初始化&quot;</span>);    &#125;    <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Hello&quot;</span>);    &#125;&#125;</code></pre></div><p>根据以上的例子，类加载器执行过程：</p><ol><li>加载：类加载器通过类的名字 Person 找到 Person.class 文件，将 .class 文件的字节码加载到 JVM，并在堆中生成一个代表这个类的 java.lang.Class 对象作为数据访问的入口</li><li>验证：检查字节码是否合法</li><li>准备：为静态变量（<code>List&lt;String&gt; list</code>）分配内存，并赋初始值 null（此时静态变量只是占位，还没初始化）</li><li>解析：将符号引用替换为直接引用，比如将<code>System.out.println</code>方法名解析为真正的内存地址</li><li>初始化：执行静态代码块，给静态变量赋值（这里的list变量本身在方法区，指向的HashMap对象实例在堆里创建）</li></ol><h3 id="Class对象">Class对象</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Class</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Class</span><span class="hljs-params">()</span> &#123;&#125;&#125;</code></pre></div><p>比如，当JVM加载String类时，会执行<code>Class cls = new Class(String);</code>在堆中创建Class对象。这个对象包含类名、包名、父类、实现的接口、所有方法、字段等对应class的所有信息。内存分布：</p><div class="code-wrapper"><pre><code class="hljs text">Java 堆：┌────────────────────────────┐│ Class&lt;Person&gt; clazz        ││ ── name: &quot;Person&quot;          ││ ── loader: AppClassLoader  ││ ── klass_pointer →────────────┐└────────────────────────────┘  │                                |方法区（Metaspace）：              ▼┌────────────────────────────┐│ Class Metadata (Klass*)    ││ ── className: &quot;Person&quot;     ││ ── superClass: java.lang.Object│ ── interfaces: ...         ││ ── methods[]: sayHello()   ││ ── fields[]: name          ││ ── constantPool: ...       ││ ── annotations: ...        │└────────────────────────────┘</code></pre></div><h2 id="JAVA对象在内存中的结构">JAVA对象在内存中的结构</h2><ol><li>对象头<br>包含：</li></ol><ul><li>标记字段（Mark Word）：指向哈希码（HashCode）、GC 分代年龄、锁状态标志、线程持有的锁、偏向线程 ID等。</li><li>类型指针（Klass pointer）：指向类的元数据，是一个在方法区的C++结构，与上文Class对象的klass_pointer指向的结构一样。</li></ul><ol start="2"><li>实例数据</li><li>对齐填充</li></ol>]]></content>
    
    
    <categories>
      
      <category>Java基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Java</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发基础知识 - Spring基本介绍，特性与原理</title>
    <link href="/2025/07/02/SWE-basis/Spring/spring-basic/"/>
    <url>/2025/07/02/SWE-basis/Spring/spring-basic/</url>
    
    <content type="html"><![CDATA[<h2 id="Background">Background</h2><h3 id="单例模式">单例模式</h3><p>单例模式是一种创建对象的设计模式，它确保一个类在整个程序运行过程中，只会被创建一个实例，并提供一个全局访问点。比如一个Printer类，这个类的功能可以被多个服务使用，因为printer实例不保存状态，只提供打印服务，我们不想每次使用时就创建一个新的printer实例，因为这样浪费内存，也容易管理混乱。</p><p>示例单例模式的代码：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Printer</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Printer instance; <span class="hljs-comment">// 1. 类的静态变量保存实例</span>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Printer</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// 2. 私有构造函数，别人不能 new</span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Printer <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;       <span class="hljs-comment">// 3. 第一次调用时才创建</span>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Printer</span>();        &#125;        <span class="hljs-keyword">return</span> instance;    &#125;&#125;<span class="hljs-type">Printer</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Printer.getInstance(); <span class="hljs-comment">// 得到单例</span></code></pre></div><p>但是以上代码不符合单例模式的需求：</p><ul><li>多线程环境下可能会出现两个线程同时判断 <code>instance == null</code> 为 true, 创建两个实例，违反单例模式的设定。</li><li><code>instance = new Printer()</code>可能会被编译器重排成如下顺序：</li><li>分配内存空间</li><li>把内存地址赋给 instance（instance 不再为 null）</li><li>调用构造函数初始化对象<br>如果第二个线程看到<code>instance != null</code>，但其实这个实例还没有被初始化，那么第二个线程会直接使用没有初始化的对象，导致空指针等问题。因此要使用 <code>volatile</code> 防止指令重排。</li></ul><p>正确的单例模式代码：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Printer</span> &#123;    <span class="hljs-comment">// 确保线程可见性以及禁止指令重排</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Printer instance;    <span class="hljs-comment">// private构造函数，防止外部实例化（防止外部使用new Printer()）</span>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Printer</span><span class="hljs-params">()</span> &#123;&#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Printer <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// 第一次检查，如果 instance 已经有了，就直接返回，省去加锁的成本</span>            <span class="hljs-keyword">synchronized</span> (Printer.class) &#123; <span class="hljs-comment">// 确保同一时间只有一个线程能进入</span>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// 第二次检查（可能两个线程同时通过了第一层的 if (instance == null)）</span>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Printer</span>();                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> instance;    &#125;&#125;</code></pre></div><h3 id="Dependency-Injection">Dependency Injection</h3><p>依赖注入是由外部系统将对象所依赖的其他对象传入（注入）它的过程。</p><p>如果不使用依赖注入，比如我的代码中，Car 依赖于具体的 Engine 实现，两者耦合度高：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// Engine.java</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Engine</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Engine started.&quot;</span>);    &#125;&#125;<span class="hljs-comment">// Car.java</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-type">Engine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Engine</span>();  <span class="hljs-comment">// 手动创建依赖</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drive</span><span class="hljs-params">()</span> &#123;        engine.start();        System.out.println(<span class="hljs-string">&quot;Car is driving...&quot;</span>);    &#125;&#125;<span class="hljs-comment">// Main.java</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();  <span class="hljs-comment">// 手动创建 Car 实例</span>        car.drive();    &#125;&#125;</code></pre></div><p>在这个代码中，Car 类自己创建了 Engine 对象 <code>new Engine()</code>。</p><ul><li>如果要换成 TurboEngine，需要修改 Car 的源码。</li><li>不方便测试（比如不能用一个假的 Engine）</li></ul><p>使用依赖注入：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Engine</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span>;&#125;<span class="hljs-comment">// 实现不同类型的Engine</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GasEngine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Engine</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Gas engine started.&quot;</span>);    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElectricEngine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Engine</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Electric engine started.&quot;</span>);    &#125;&#125;<span class="hljs-comment">// Car 接受一个 Engine 参数</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;    <span class="hljs-keyword">private</span> Engine engine;    <span class="hljs-comment">// 构造函数注入（最常见方式）</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Car</span><span class="hljs-params">(Engine engine)</span> &#123;        <span class="hljs-built_in">this</span>.engine = engine;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        engine.start();        System.out.println(<span class="hljs-string">&quot;Car is driving...&quot;</span>);    &#125;&#125;<span class="hljs-comment">// 使用</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-comment">// 注入不同的引擎类型</span>        <span class="hljs-type">Engine</span> <span class="hljs-variable">gasEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GasEngine</span>();        <span class="hljs-type">Car</span> <span class="hljs-variable">car1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(gasEngine);        car1.start(); <span class="hljs-comment">// 输出：Gas engine started.</span>        <span class="hljs-type">Engine</span> <span class="hljs-variable">electricEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ElectricEngine</span>();        <span class="hljs-type">Car</span> <span class="hljs-variable">car2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(electricEngine);        car2.start(); <span class="hljs-comment">// 输出：Electric engine started.</span>    &#125;&#125;</code></pre></div><h2 id="Spring-Framework">Spring Framework</h2><p>Spring 框架的核心目标就是解耦和自动化。Spring负责类的创建、注入、销毁等。</p><h3 id="Spring代码示例">Spring代码示例</h3><p>代码结构</p><div class="code-wrapper"><pre><code class="hljs stylus">spring-demo/├── <span class="hljs-attribute">src</span>/│   └── main/│       ├── java/│       │   └── com/example/demo/│       │       ├── DemoApplication<span class="hljs-selector-class">.java</span>          <span class="hljs-comment">// 主程序入口</span>│       │       ├── controller/UserController.java<span class="hljs-comment">// 控制器</span>│       │       ├── service/UserService<span class="hljs-selector-class">.java</span>      <span class="hljs-comment">// 业务逻辑</span>│       │       ├── model/User<span class="hljs-selector-class">.java</span>               <span class="hljs-comment">// 数据模型</span>│       │       └── repository/UserRepository.java<span class="hljs-comment">// 数据仓库</span>│       └── resources/│           └── application<span class="hljs-selector-class">.properties</span>            <span class="hljs-comment">// 配置文件</span>├── pom<span class="hljs-selector-class">.xml</span>                                       <span class="hljs-comment">// Maven 构建文件</span></code></pre></div><ul><li>DemoApplication.java：应用入口</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        SpringApplication.run(DemoApplication.class, args);    &#125;&#125;</code></pre></div><ul><li>User.java：实体类</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.model;<span class="hljs-keyword">import</span> jakarta.persistence.*;<span class="hljs-meta">@Entity</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>    <span class="hljs-keyword">private</span> Long id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String email;    <span class="hljs-comment">// Getter 和 Setter</span>&#125;</code></pre></div><ul><li>UserRepository.java：仓库接口</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.repository;<span class="hljs-keyword">import</span> com.example.demo.model.User;<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;User, Long&gt; &#123;&#125;</code></pre></div><ul><li>UserService.java：服务类（业务逻辑）</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.service;<span class="hljs-keyword">import</span> com.example.demo.model.User;<span class="hljs-keyword">import</span> com.example.demo.repository.UserRepository;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository repo;        <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">(UserRepository repo)</span> &#123;        <span class="hljs-built_in">this</span>.repo = repo;    &#125;    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> repo.findAll();    &#125;    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> &#123;        <span class="hljs-keyword">return</span> repo.save(user);    &#125;&#125;</code></pre></div><ul><li>UserController.java：控制器（REST 接口）</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.controller;<span class="hljs-keyword">import</span> com.example.demo.model.User;<span class="hljs-keyword">import</span> com.example.demo.service.UserService;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService service;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserController</span><span class="hljs-params">(UserService service)</span> &#123;        <span class="hljs-built_in">this</span>.service = service;    &#125;    <span class="hljs-meta">@GetMapping</span>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> service.getAllUsers();    &#125;    <span class="hljs-meta">@PostMapping</span>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">addUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;        <span class="hljs-keyword">return</span> service.createUser(user);    &#125;&#125;</code></pre></div><h3 id="如果没有Spring">如果没有Spring</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">UserService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>());</code></pre></div><ul><li>手动创建对象，项目初始化的时候很复杂</li><li>手动传依赖（UserService依赖UserRepository）</li><li>管理对象的销毁等</li><li>如果多个类依赖UserRepository，依赖关系复杂难以管理</li></ul><p>会导致代码耦合度高，测试困难等。Spring可以帮你：</p><ul><li>自动创建对象，你不用写 new。</li><li>自动注入依赖</li><li>控制对象的生命周期（什么时候创建、什么时候销毁）</li><li>帮你管理作用域：是单例？还是每次请求一个新的？都可以</li></ul><h3 id="IoC">IoC</h3><p>控制反转(Inversion of Control)，将对象的创建和依赖关系的维护从代码中移除，交给一个专门的容器(Spring 框架中的IoC 容器) 来管理。</p><p>在 Spring 应用 中，通常 Controller、Service 和 DAO（Repository） 都是由 Spring 容器管理的 Bean，这样可以充分利用 Spring 的 IoC（控制反转）和依赖注入（DI）机制，使得各层之间的依赖关系由 Spring 自动管理，减少手动创建对象的代码，提高可维护性和解耦性。</p><h4 id="Bean">Bean</h4><p>Bean是一个由Spring IoC容器管理的对象。这个对象可以是任何Java类的实例。Spring通过“控制反转（IoC）”的机制，把对象的创建权和管理权交给了容器。使用者不再手动 new 对象，而是让Spring把准备好的对象（Bean）交给使用者使用。这样可以使代码更清晰，专注于业务逻辑；更容易替换实现、做单元测试。</p><h4 id="声明类为Beans的方法">声明类为Beans的方法</h4><ol><li>使用注解 @Component</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;Doing something...&quot;</span>);    &#125;&#125;</code></pre></div><ul><li>@Component：通用组件</li><li>@Service：表示业务逻辑层</li><li>@Repository：表示数据访问层</li><li>@Controller：表示Web控制器</li></ul><ol start="2"><li>使用 @Bean 注解<br>当你希望手动控制某个 Bean 的创建过程时，用这个方式。</li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;    <span class="hljs-meta">@Bean</span> <span class="hljs-comment">// 在方法上使用 @Bean，Spring会调用这个方法并将返回值作为一个 Bean。</span>    <span class="hljs-keyword">public</span> MyService <span class="hljs-title function_">myService</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyService</span>(); <span class="hljs-comment">// 手动创建并返回对象</span>    &#125;&#125;</code></pre></div><p>Spring 会执行这个方法，获取返回的对象，把它注册成一个 Bean。</p><h4 id="自动依赖注入">自动依赖注入</h4><p>Spring 会自动找到类型是 Engine 的 Bean，注入给 Car。</p><ul><li>构造器注入</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Engine engine;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Car</span><span class="hljs-params">(Engine engine)</span> &#123;        <span class="hljs-built_in">this</span>.engine = engine;    &#125;&#125;</code></pre></div><ul><li>Setter 注入</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;    <span class="hljs-keyword">private</span> Engine engine;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEngine</span><span class="hljs-params">(Engine engine)</span> &#123;        <span class="hljs-built_in">this</span>.engine = engine;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        engine.run();    &#125;&#125;</code></pre></div><ul><li>字段注入</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> Engine engine;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;        engine.run();    &#125;&#125;</code></pre></div><h3 id="AOP">AOP</h3><p>AOP（Aspect-Oriented Programming）面向切面编程。在传统的面向对象编程中，比如我们在写一个网站的业务逻辑时，比如处理订单、用户登录等，我们经常还需要加上日志记录、权限校验、事务管理等功能。这些功能虽然必须有，但它们跟业务逻辑（比如下订单）并没有直接关系。</p><p>比如我有一个订单服务：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> &#123;    System.out.println(<span class="hljs-string">&quot;日志：开始执行 createOrder&quot;</span>);    <span class="hljs-comment">// 下单逻辑</span>    System.out.println(<span class="hljs-string">&quot;日志：createOrder 执行完毕&quot;</span>);&#125;</code></pre></div><p>Spring AOP 是 Spring 框架提供的一种实现 AOP 编程的方法，它通过代理对象把横切逻辑“织入”到业务逻辑中，不需要你改业务代码。Spring 根据配置创建一个代理对象，每当你调用业务方法（如 orderService.createOrder()）时，代理对象会先执行切面逻辑（如日志），再执行真正的业务逻辑。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> &#123;        System.out.println(<span class="hljs-string">&quot;执行创建订单逻辑...&quot;</span>);    &#125;&#125;<span class="hljs-comment">// 定义一个切面类（日志逻辑）</span><span class="hljs-meta">@Aspect</span><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> &#123;    <span class="hljs-comment">// 切入点表达式：拦截所有 OrderService 的方法</span>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.example.demo.OrderService.*(..))&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderMethods</span><span class="hljs-params">()</span> &#123;&#125;    <span class="hljs-comment">// 前置通知：方法执行前记录日志</span>    <span class="hljs-meta">@Before(&quot;orderMethods()&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logBefore</span><span class="hljs-params">(JoinPoint joinPoint)</span> &#123;        System.out.println(<span class="hljs-string">&quot;日志：开始执行方法 -&gt; &quot;</span> + joinPoint.getSignature().getName());    &#125;    <span class="hljs-comment">// 后置通知：方法执行后记录日志</span>    <span class="hljs-meta">@After(&quot;orderMethods()&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logAfter</span><span class="hljs-params">(JoinPoint joinPoint)</span> &#123;        System.out.println(<span class="hljs-string">&quot;日志：结束执行方法 -&gt; &quot;</span> + joinPoint.getSignature().getName());    &#125;&#125;<span class="hljs-comment">// 启动类开启 AOP 功能</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableAspectJAutoProxy</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        SpringApplication.run(DemoApplication.class, args);    &#125;&#125;</code></pre></div><p>这样，当我调用 orderService 的代码时，比如 <code>orderService.createOrder()</code>，控制台会打印：</p><div class="code-wrapper"><pre><code class="hljs clean">日志：开始执行方法 -&gt; createOrder执行创建订单逻辑...日志：结束执行方法 -&gt; createOrder</code></pre></div><h2 id="Spring的原理">Spring的原理</h2><h3 id="反射">反射</h3><p>反射是 Java 提供的一种机制，可以在程序运行时（不是写代码时），动态地获取类的信息（比如类的名字、方法、变量、构造函数等），甚至动态地调用对象的方法或访问它的属性。详细的反射介绍：<a href="https://thiefcat.github.io/2025/07/03/JAVA/reflection/">反射</a>。</p><h3 id="IoC原理">IoC原理</h3><p>回顾IoC主要是将对象的创建和依赖管理的责任从程序员手中“反转”给一个容器来管理，从而降低耦合度。在Spring启动时，会进行以下处理：</p><ol><li>当 Spring 启动时，会扫描指定的包或目录（通常通过 @ComponentScan 注解指定），查找类上标注的注解（如 @Component、@Service、@Repository、@Controller 等）</li><li>所有标注了这些注解的类会被注册为 Spring 容器中的 Bean。</li><li>在创建 Bean 时，如果该 Bean 有依赖的其他 Bean（如通过 @Autowired 注解标注），Spring 会自动注入这些依赖对象。</li></ol><h3 id="AOP原理">AOP原理</h3><h4 id="动态代理">动态代理</h4><p>实例化一个接口时：</p><p>静态代理：你写了一个类去实现接口，写死了逻辑，编译器在编译期生成字节码。<br>动态代理：<strong>你在运行时才“生成一个类”（不是写出来的源码，而是直接生成字节码并加载），这个类会去实现接口，并在方法调用时，把实际处理交给 InvocationHandler。</strong></p><p>如何让Java自动生成一个类来实现一个Interface？</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// newProxyInstance 是 Java 提供的 JDK 动态代理 的入口方法。</span><span class="hljs-comment">// 它能在运行时创建一个代理对象，这个代理对象会实现你指定的接口，</span><span class="hljs-comment">// 但它的方法调用实际会被转发给一个你自己定义的处理器对象（InvocationHandler）</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(</span><span class="hljs-params">    ClassLoader loader, // 类加载器</span><span class="hljs-params">    Class&lt;?&gt;[] interfaces, // 接口列表</span><span class="hljs-params">    InvocationHandler h)</span>;<span class="hljs-comment">// 调用示例：实现对UserCervice interface的动态代理</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUser</span><span class="hljs-params">(String username)</span>;    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(String username)</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;        <span class="hljs-comment">// 创建一个 InvocationHandler，用来处理所有方法的调用</span>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;                <span class="hljs-comment">// 打印日志</span>                System.out.println(<span class="hljs-string">&quot;[LOG] 调用方法：&quot;</span> + method.getName());                System.out.println(<span class="hljs-string">&quot;[LOG] 参数：&quot;</span> + args[<span class="hljs-number">0</span>]);                                <span class="hljs-comment">// 模拟方法执行</span>                <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;createUser&quot;</span>)) &#123;                    System.out.println(<span class="hljs-string">&quot;正在创建用户：&quot;</span> + args[<span class="hljs-number">0</span>]);                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (method.getName().equals(<span class="hljs-string">&quot;deleteUser&quot;</span>)) &#123;                    System.out.println(<span class="hljs-string">&quot;正在删除用户：&quot;</span> + args[<span class="hljs-number">0</span>]);                &#125;                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 接口方法返回 void，这里返回 null</span>            &#125;        &#125;;        <span class="hljs-comment">// 创建代理对象（实现了 UserService 接口）</span>        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserService) Proxy.newProxyInstance(            UserService.class.getClassLoader(),            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; UserService.class &#125;,            handler        );        <span class="hljs-comment">// 调用代理对象的方法，实际会被拦截并执行 handler.invoke(...)</span>        proxy.createUser(<span class="hljs-string">&quot;alice&quot;</span>);        proxy.deleteUser(<span class="hljs-string">&quot;bob&quot;</span>);    &#125;&#125;</code></pre></div><p>以上例子，使用了动态代理的方法，创建了一个对象，实现了 UserService 接口。</p><p>实际输出：</p><div class="code-wrapper"><pre><code class="hljs txt">[LOG] 调用方法：createUser[LOG] 参数：alice正在创建用户：alice[LOG] 调用方法：deleteUser[LOG] 参数：bob正在删除用户：bob</code></pre></div><p>AOP的实现使用了<strong>动态代理</strong>，其中代理对象在运行时动态地拦截方法调用并进行增强操作。</p><p>大体流程：<br>Spring启动时，会扫描标注了 @Aspect 的类，这些 @Aspect 类内部会定义切入点（@Pointcut）和通知（@Before、@After、@Around 等）。一旦 Spring 扫描到 @Aspect 注解的类，它就会在目标类上创建一个代理对象（<strong>根据注解动态生成代理对象</strong>）。Spring 会用代理对象替换原始目标对象，放入 Beans 来管理。代理对象的 invoke 方法会被 Spring 重写。在该方法中，Spring 会根据注解里的定义执行哪些横切逻辑。此后所有的方法调用都走代理逻辑，从而实现 AOP。</p><h3 id="解决循环依赖">解决循环依赖</h3><p>循环依赖是指 多个 Bean 之间的依赖形成了一个闭环，例如：A 依赖 B，B 依赖 A。如果 Spring 直接实例化 A，它发现 A 需要 B，于是去创建 B，但 B 又需要 A，形成了死锁，导致程序无法继续。为了解决循环依赖，Spring 在创建 Bean 时，使用了三级缓存机制：</p><ul><li>一级缓存：用来存放已经创建的对象，通常是完全初始化的 Bean 实例。</li><li>二级缓存：用来存放已经实例化但是还没完全初始化的Bean（还未进行注入操作）。</li><li>三级缓存：这个缓存用来存放 Bean 工厂，它是用来获取 Bean 的实例。</li></ul>]]></content>
    
    
    <categories>
      
      <category>开发基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发基础知识 - Maven</title>
    <link href="/2025/07/01/SWE-basis/Tools/maven/"/>
    <url>/2025/07/01/SWE-basis/Tools/maven/</url>
    
    <content type="html"><![CDATA[<h2 id="Background">Background</h2><p><a href="https://thiefcat.github.io/2025/07/09/JAVA/java-cli/">Java 编译，打包，运行</a></p><h2 id="Maven介绍">Maven介绍</h2><p>Maven 是一个项目管理和构建工具，主要用于 Java 项目。</p><h3 id="Why-we-need-maven">Why we need maven</h3><ul><li>我们写 Java 项目时经常需要用到第三方库，比如数据库驱动、日志工具等等，每个库有版本，可能还需要这些库的库。如果我们自己去找 JAR 文件、下载、放入项目、管理版本，很容易出错。</li><li>把一个项目从代码变成可以运行的程序，中间有很多步骤：编译、打包、运行测试、生成文档、部署等。每个步骤手动操作非常烦人而且容易出错。</li></ul><p>使用Maven后，只需要在 pom.xml 文件中写明需要的库，Maven 会自动从中央仓库下载正确的版本，并配置好路径。</p><h3 id="Maven的组成">Maven的组成</h3><ol><li>pom.xml<br>pom文件是项目的配置文件。pom文件包含以下信息：</li></ol><ul><li>项目的基本信息（名字、版本）</li><li>项目需要哪些依赖（比如 Spring、MySQL 驱动）</li><li>项目如何构建（比如插件、打包方式）</li><li>项目是否有子模块（如果是父模块）</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;[http://maven.apache.org/POM/4.0.0](http://maven.apache.org/POM/4.0.0)&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;[http://www.w3.org/2001/XMLSchema-instance](http://www.w3.org/2001/XMLSchema-instance)&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;[http://maven.apache.org/POM/4.0.0](http://maven.apache.org/POM/4.0.0)</span></span><span class="hljs-string"><span class="hljs-tag">                             [https://maven.apache.org/xsd/maven-4.0.0.xsd](https://maven.apache.org/xsd/maven-4.0.0.xsd)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>demo-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Demo Maven Project<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>A simple Maven project example<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p>以下三个标识定义一个资源</p><ul><li>groupId：谁开发的项目（通常是组织/公司/包名）</li><li>artifactId：项目的名字（模块名）</li><li>version：版本号</li></ul><ol start="2"><li>本地仓库<br>Maven 会把下载的依赖包保存在你电脑上的一个位置（通常在 <code>~/.m2/repository</code> 里），下次用同样的依赖就不需要重新下载。</li><li>中央仓库<br>如果本地没有你需要的库，Maven 会自动从网上的中央仓库去下载。</li><li>私有仓库<br>私有仓库用于公司内部不希望公开的jar包，只需要在本地的<code>~/.m2/settings.xml</code>配置好私有仓库的访问，就可以使用。</li><li>生命周期和插件<br>Maven定义了统一的构建流程，并且用命令自动化执行：</li></ol><ul><li>mvn clean：删除上一次构建的结果（.class和.jar文件），保证干净的开始</li><li>mvn compile：编译 <code>src/main/java</code> 源代码到 <code>/target</code> 目录下。但它不会打包成 jar，会生成 .class文件。</li><li>mvn test：编译并运行单元测试</li><li>mvn package：编译、测试并打包项目，生成<code>.jar</code>文件，默认打包的不是 fat jar。</li><li>mvn install：打包后安装到本地仓库(<code>~/.m2/repository/</code>)，供其他项目使用</li></ul><h3 id="How-maven-works">How maven works</h3><p>你声明一个依赖后，Maven 会自动下载它所依赖的所有库（传递依赖），一直递归下去，直到依赖链的最底层，全自动完成。</p><h2 id="Maven模块管理">Maven模块管理</h2><p>实际中，我们通常有很多服务（模块），文件结构：</p><div class="code-wrapper"><pre><code class="hljs text">my-mall/├── pom.xml                &lt;-- 父模块├── common-utils/          &lt;-- 子模块│   └── pom.xml├── user-service/          &lt;-- 子模块│   └── pom.xml└── order-service/         &lt;-- 子模块    └── pom.xml</code></pre></div><p>父模块 pom.xml</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-mall<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>common-utils<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>order-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p>子模块 pom.xml</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;[http://maven.apache.org/POM/4.0.0](http://maven.apache.org/POM/4.0.0)&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;[http://www.w3.org/2001/XMLSchema-instance](http://www.w3.org/2001/XMLSchema-instance)&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;[http://maven.apache.org/POM/4.0.0](http://maven.apache.org/POM/4.0.0)</span></span><span class="hljs-string"><span class="hljs-tag">                             [http://maven.apache.org/xsd/maven-4.0.0.xsd](http://maven.apache.org/xsd/maven-4.0.0.xsd)&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-mall<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common-utils<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Common Utils Module<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><ul><li>dependencies<br>使用<code>&lt;dependency&gt;</code>声明一个依赖后，Maven就会自动下载这个依赖包并把它放到classpath中。</li><li>dependencyManagement<br>在大型项目中，多个模块可能使用同一个库（如 Spring Boot），如果每个模块都自己写依赖版本，可能会产生冲突。dependencyManagement是Maven用来统一定义依赖版本的一个区域，子模块继承后，只写 groupId 和 artifactId 即可。</li><li>modules<br>在一个父项目中，<code>&lt;modules&gt;</code> 标签用来列出所有子模块名称。</li><li>profiles<br>profiles是Maven的一种机制，用来根据不同的环境或目标，启用不同的配置。</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">jdbc.url</span>&gt;</span>jdbc:mysql://localhost:3306/dev_db<span class="hljs-tag">&lt;/<span class="hljs-name">jdbc.url</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">jdbc.url</span>&gt;</span>jdbc:mysql://prod-db:3306/prod_db<span class="hljs-tag">&lt;/<span class="hljs-name">jdbc.url</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span></code></pre></div><p>以上例子在不同环境切换不同的数据库。运行时启用某个profile: <code>mvn clean package -Pprod</code>。</p><ul><li>build<br><code>&lt;build&gt;</code> 是Maven项目中用来控制如何生成<code>.jar</code>包的区域.</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>my-awesome-app<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.10.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>开发基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Backend Development</tag>
      
      <tag>Maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - Go OOP</title>
    <link href="/2025/05/30/CSE224/go-oop/"/>
    <url>/2025/05/30/CSE224/go-oop/</url>
    
    <content type="html"><![CDATA[<h2 id="Class">Class</h2><h3 id="Named-Type">Named Type</h3><p>I can create a new named type MyInt that is based on int, but is treated as a distinct type by the compiler.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span></code></pre></div><h3 id="struct-methods">struct + methods</h3><p>Go doesn’t have traditional classes, instead, it uses Custom types + attached methods. As a result, structs in go can hold both data and associated methods. Example:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Celsius <span class="hljs-type">float64</span><span class="hljs-comment">// This defines a method on the Celsius type.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Celsius)</span></span> ToFahrenheit() <span class="hljs-type">float64</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-type">float64</span>(c)*<span class="hljs-number">9</span>/<span class="hljs-number">5</span> + <span class="hljs-number">32</span>  <span class="hljs-comment">// need type convertion</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    temp := Celsius(<span class="hljs-number">25</span>)    fmt.Println(<span class="hljs-string">&quot;In Fahrenheit:&quot;</span>, temp.ToFahrenheit()) <span class="hljs-comment">// 77</span>&#125;</code></pre></div><p>Another example: User behaves just like a class</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;    Name <span class="hljs-type">string</span>    Age  <span class="hljs-type">int</span>&#125;<span class="hljs-comment">// This function is like a method defined in a class</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> Greet() <span class="hljs-type">string</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, &quot;</span> + u.Name&#125;</code></pre></div><h3 id="Constructors">Constructors</h3><p>Go does not have built-in constructors. We define a function by ourself as a constructor:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUser</span><span class="hljs-params">(name <span class="hljs-type">string</span>, age <span class="hljs-type">int</span>)</span></span> User &#123;    <span class="hljs-keyword">return</span> User&#123;Name: name, Age: age&#125;&#125;</code></pre></div><h3 id="Encapsulation">Encapsulation</h3><p>Go doesn’t use public or private keywords like Java or C++. Instead, it uses capitalization to control visibility.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Account <span class="hljs-keyword">struct</span> &#123;    Owner   <span class="hljs-type">string</span>  <span class="hljs-comment">// Exported, other packages can read/write it.</span>    balance <span class="hljs-type">float64</span> <span class="hljs-comment">// Unexported, only code inside this package can access it.</span>&#125;</code></pre></div><h2 id="Composition">Composition</h2><p>Composition over Inheritance: Go doesn’t have classes or inheritance, but it has composition using embedding.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Animal <span class="hljs-keyword">struct</span> &#123;    Name <span class="hljs-type">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a Animal)</span></span> Speak() &#123;    fmt.Println(a.Name, <span class="hljs-string">&quot;makes a sound&quot;</span>)&#125;<span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> &#123;    Animal <span class="hljs-comment">// embedded</span>    Breed <span class="hljs-type">string</span>&#125;<span class="hljs-comment">// Now Dog inherits the Speak() method from Animal.</span>d := Dog&#123;Animal: Animal&#123;Name: <span class="hljs-string">&quot;Buddy&quot;</span>&#125;, Breed: <span class="hljs-string">&quot;Labrador&quot;</span>&#125;d.Speak() <span class="hljs-comment">// Buddy makes a sound</span></code></pre></div><p>By composition, I can resue methods.</p><h3 id="Override">Override</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// Define a method with the same name on the outer struct, and it will shadow the embedded (override)</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Dog)</span></span> Speak() &#123;    fmt.Println(d.Name, <span class="hljs-string">&quot;barks!&quot;</span>)&#125;</code></pre></div><h2 id="Interface-Polymorphism-and-Abstraction">Interface (Polymorphism and Abstraction)</h2><p>An interface in Go is a set of method signatures. <strong>If a type has those methods, it automatically implements the interface</strong>.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Greeter <span class="hljs-keyword">interface</span> &#123;    Greet() <span class="hljs-type">string</span>&#125;<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Person has a Greet() method, so it automatically satisfies the Greeter interface.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Greet() <span class="hljs-type">string</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello!&quot;</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(g Greeter)</span></span> &#123;    <span class="hljs-comment">// any type that has Greet() can be passed as a parameter (Polymorphism)</span>    fmt.Println(g.Greet())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    p := Person&#123;&#125;    sayHello(p) <span class="hljs-comment">// Hello!</span>&#125;</code></pre></div><p>If the method is defined on a pointer receiver, only the pointer type implements the interface.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Greeter <span class="hljs-keyword">interface</span> &#123;    Greet()&#125;<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;    Name <span class="hljs-type">string</span>&#125;<span class="hljs-comment">// This means only *Person (pointer) has the method Greet()</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Person)</span></span> Greet() &#123;    fmt.Println(<span class="hljs-string">&quot;Hello, my name is&quot;</span>, p.Name)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    <span class="hljs-keyword">var</span> g Greeter    p := Person&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>&#125;    <span class="hljs-comment">// g = p         // ❌ error (p is a Person (value))</span>    g = &amp;p           <span class="hljs-comment">// ✅ &amp;p is a *Person</span>    g.Greet()&#125;</code></pre></div><p>In this example, <code>Person</code> doesn’t implement the interface, but <code>*Person</code> does, so assigning a <code>Person</code> to a <code>Greeter</code> causes an error. (<code>g = &amp;p</code> works)</p>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - HTTP server</title>
    <link href="/2025/05/21/CSE224/http-server/"/>
    <url>/2025/05/21/CSE224/http-server/</url>
    
    <content type="html"><![CDATA[<h2 id="Required-library-packages">Required library packages</h2><h3 id="Http-package">Http package</h3><p><code>net/http</code>: A standard library package in Go to create and handle web-based communication using the HTTP protocol.</p><ul><li><code>http.HandleFunc(path, handler)</code>: When someone visits path, run the handler function. e.g., <code>http.HandleFunc(&quot;/&quot;, homeHandler)</code></li><li><code>http.ListenAndServe(addr, nil)</code>: Starts the server and listens on a specific address/port. e.g., <code>http.ListenAndServe(&quot;:8080&quot;, nil)</code>, Listen for HTTP requests on port 8080.</li><li><code>func(w http.ResponseWriter, r *http.Request)</code>: This is what handler functions look like.</li></ul><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">greetHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;    name := r.URL.Query().Get(<span class="hljs-string">&quot;name&quot;</span>) <span class="hljs-comment">// Reads a query parameter from the URL</span>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&quot;&quot;</span> &#123;        name = <span class="hljs-string">&quot;Guest&quot;</span>    &#125;    fmt.Fprintf(w, <span class="hljs-string">&quot;Hello, %s!&quot;</span>, name)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, greetoHandler)    http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)&#125;</code></pre></div><p>Then visit <code>http://localhost:8080/?name=Alice</code>, and will output: Hello, Alice!</p><ul><li><code>r.URL.Query().Get(&quot;id&quot;)</code>: Reads a query parameter from the URL, like <code>/student?id=Alice</code></li><li><code>r.ParseForm()</code>: Used for reading form data submitted via POST.</li><li><code>name := r.FormValue(&quot;student_name&quot;)</code>: Access form values, gives you the first value for that key.</li><li><code>r.Form[&quot;key&quot;]</code>: gives you all values as a slice ([]string)</li><li><code>http.Redirect(...)</code>: Redirects the browser to another URL after a POST request.</li></ul><h3 id="html-template-package">html/template package</h3><p><code>html/template</code> is a Go standard library package that helps you create HTML pages with dynamic content.</p><ol><li>Define HTML Template</li></ol><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Student Name: &#123;&#123;.Name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Grade: &#123;&#123;.Grade&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></code></pre></div><ol start="2"><li>Define a go struct</li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GradeInfo <span class="hljs-keyword">struct</span> &#123; Name  <span class="hljs-type">string</span> Grade <span class="hljs-type">string</span>&#125;</code></pre></div><ol start="3"><li>Fill the template</li></ol><div class="code-wrapper"><pre><code class="hljs go">tmpl := template.Must(template.ParseFiles(<span class="hljs-string">&quot;gradeinfo.html&quot;</span>))student := GradeInfo&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>, Grade: <span class="hljs-string">&quot;A+&quot;</span>&#125;tmpl.Execute(w, student)</code></pre></div><p><code>tmpl.Execute(w, students)</code> use template for <code>index.html</code>, fill data from student, dynamically generate a HTML page, and finally write the page to w.</p>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - Go Concurrent Programming</title>
    <link href="/2025/05/10/CSE224/go-concurrent/"/>
    <url>/2025/05/10/CSE224/go-concurrent/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><h3 id="Go-Routines">Go Routines</h3><p>Traditionally, people used OS-level threads for concurrency, but threads are heavyweight. Go introduced <strong>goroutines</strong>, which are</p><ol><li>Very cheap in terms of memory</li><li>Managed by the Go runtime, not the OS</li><li>Can be created in large numbers</li></ol><p>Go uses an internal scheduler that maps many goroutines onto fewer OS threads using something called the M:N model (many goroutines on few threads). The scheduler runs in user space — no need to ask the operating system every time. As a result, go routines is like a user-level thread.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">go</span> sayHello() <span class="hljs-comment">// create a go routine</span></code></pre></div><h3 id="Channel">Channel</h3><p>A channel is a way for goroutines to communicate and synchronize with each other. It’s like a pipe.</p><div class="code-wrapper"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;    ch &lt;- <span class="hljs-string">&quot;hello&quot;</span>&#125;()msg := &lt;-chfmt.Println(msg) <span class="hljs-comment">// prints: hello</span></code></pre></div><p>Channels can be synchronous or buffered:</p><ol><li>Synchronous: No buffer. The sender waits until a receiver is ready.</li></ol><div class="code-wrapper"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;    fmt.Println(<span class="hljs-string">&quot;Sending...&quot;</span>)    ch &lt;- <span class="hljs-number">42</span>  <span class="hljs-comment">// block until some routine receive data</span>    fmt.Println(<span class="hljs-string">&quot;Sent&quot;</span>)&#125;()x := &lt;-ch  <span class="hljs-comment">// block until some data is available</span>fmt.Println(<span class="hljs-string">&quot;Received&quot;</span>, x)</code></pre></div><ol start="2"><li>Buffered: Has space to hold values. Sender doesn’t wait until buffer is full.</li></ol><div class="code-wrapper"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">2</span>)ch &lt;- <span class="hljs-number">1</span>ch &lt;- <span class="hljs-number">2</span><span class="hljs-comment">// Can send twice before it blocks</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - RPC</title>
    <link href="/2025/05/08/CSE224/rpc/"/>
    <url>/2025/05/08/CSE224/rpc/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Remote Procedure Call (RPC) is a way for a program to call a function defined on a different computer as if it were calling a local function.</p><p>Issues:</p><ol><li>A remote machine might use a different language, so it represent data types using different sizes.</li><li>Use a different byte ordering (endianness).</li><li>Have different data alignment requirements.</li><li>Represent floating point numbers differently.</li></ol><h3 id="Interface-Description-Language-IDL">Interface Description Language (IDL)</h3><p>Mechanism to pass procedure parameters and return values in a machine and language independent way.</p><h4 id="Protobuf">Protobuf</h4><p>Protocol Buffers (protobuf) is a language-neutral format for defining structured data by gPRC.</p><div class="code-wrapper"><pre><code class="hljs abnf"><span class="hljs-attribute">syntax</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;proto3&quot;</span><span class="hljs-comment">;</span>message NumberEntry &#123;    int64 ts <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-comment">;</span>    int32 number <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-comment">;</span>&#125;service NumberService &#123;    rpc SendNumber(NumberEntry) returns (Ack)<span class="hljs-comment">;</span>&#125;message Ack &#123;    string status <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-comment">;</span>&#125;</code></pre></div><p><code>.proto</code> file defines</p><ol><li>Service APIs (rpc methods)</li><li>Message formats</li></ol><p>Then run <code>protoc --go_out=. --go-grpc_out=. your_file.proto</code> will generate</p><ol><li>Client stub code (for calling SendNumber)</li><li>Server stub code (for implementing SendNumber)</li><li>Marshalling code (for turning NumberEntry into bytes and back)</li></ol><h3 id="Workflow">Workflow</h3><ol><li>Client calls stub function</li><li>Stub marshals parameters to a network message</li><li>OS sends a network message to the server</li><li>Server OS receives message, sends it up to stub</li><li>Server stub unmarshals params, calls server function</li><li>Server function runs, returns a value</li><li>Server stub marshals the return value, sends msg</li><li>Server OS sends the reply back across the network</li><li>Client OS receives the reply and passes up to stub</li><li>Client stub unmarshals return value, returns to client</li></ol><h2 id="Example">Example</h2><p>Building a Replicated KV Store:</p><ol><li>To run the system, run the code in each node machine.</li><li>Each node is both a server and a client, server is run by a go routine, client is also run by a go routine.</li><li>The server code listens to rpc calls from other nodes</li><li>The client code interprets commands, and handle the command by sending rpc</li></ol><h3 id="Define-the-proto-file">Define the proto file:</h3><div class="code-wrapper"><pre><code class="hljs proto">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<span class="hljs-keyword">package</span> rkvs;<span class="hljs-comment">// tells the protobuf compiler where to put the generated Go code</span><span class="hljs-keyword">option</span> go_package = <span class="hljs-string">&quot;/proto;pb&quot;</span>; <span class="hljs-comment">// here, the package will be called pb in the /proto directory</span><span class="hljs-comment">// service defines a set of remote procedures (functions) that can be called over the network.</span><span class="hljs-keyword">service </span><span class="hljs-title class_">RKVSService</span> &#123;    <span class="hljs-function"><span class="hljs-keyword">rpc</span> Replicate (ReplicateRequest) <span class="hljs-keyword">returns</span> (ReplicateResponse)</span>;    <span class="hljs-function"><span class="hljs-keyword">rpc</span> Stop (StopRequest) <span class="hljs-keyword">returns</span> (StopResponse)</span>;&#125;<span class="hljs-comment">// A message is what you send or what you receive in a network call.</span><span class="hljs-keyword">message </span><span class="hljs-title class_">ReplicateRequest</span> &#123;    <span class="hljs-type">string</span> key = <span class="hljs-number">1</span>;    <span class="hljs-type">string</span> value = <span class="hljs-number">2</span>;&#125;<span class="hljs-keyword">message </span><span class="hljs-title class_">ReplicateResponse</span>&#123;&#125;<span class="hljs-keyword">message </span><span class="hljs-title class_">StopRequest</span>&#123;&#125;<span class="hljs-keyword">message </span><span class="hljs-title class_">StopResponse</span>&#123;&#125;</code></pre></div><p>Then, <code>protoc --go_out=. --go-grpc_out=. rkvs.proto</code> will generate a pb package with:</p><ol><li>RKVSServiceServer interface for the server to implement</li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> RKVSServiceServer <span class="hljs-keyword">interface</span> &#123; Replicate(context.Context, *ReplicateRequest) (*ReplicateResponse, <span class="hljs-type">error</span>)  Stop(context.Context, *StopRequest) (*StopResponse, <span class="hljs-type">error</span>) mustEmbedUnimplementedRKVSServiceServer()&#125;</code></pre></div><ol start="2"><li>RKVSServiceClient for calling remote methods</li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> RKVSServiceClient <span class="hljs-keyword">interface</span> &#123;  Replicate(ctx context.Context, in *ReplicateRequest, opts ...grpc.CallOption) (*ReplicateResponse, <span class="hljs-type">error</span>)  Stop(ctx context.Context, in *StopRequest, opts ...grpc.CallOption) (*StopResponse, <span class="hljs-type">error</span>)&#125;</code></pre></div><h3 id="Implement-the-gRPC-Server-in-Go">Implement the gRPC Server in Go:</h3><p>After defining a service, we need to implement rpc functions.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// struct server implements the RPC methods from your .proto file: Replicate and Stop</span><span class="hljs-keyword">type</span> server <span class="hljs-keyword">struct</span> &#123;    pb.UnimplementedRKVSServiceServer <span class="hljs-comment">// This is part of the Go code auto-generated from your .proto file.</span>    state  <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>    peers  []<span class="hljs-type">string</span>    stopCh <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;&#125;<span class="hljs-comment">// Implementing the Replicate RPC</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *server)</span></span> Replicate(ctx context.Context, req *pb.ReplicateRequest) (*pb.ReplicateResponse, <span class="hljs-type">error</span>) &#123;    s.state[req.Key] = req.Value    <span class="hljs-keyword">return</span> &amp;pb.ReplicateResponse&#123;&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Implementing the Stop RPC</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *server)</span></span> Stop(ctx context.Context, req *pb.StopRequest) (*pb.StopResponse, <span class="hljs-type">error</span>) &#123;    s.stopCh &lt;- <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;    <span class="hljs-keyword">return</span> &amp;pb.StopResponse&#123;&#125;, <span class="hljs-literal">nil</span>&#125;</code></pre></div><p><code>pb.UnimplementedRKVSServiceServer</code>: It contains default (empty) implementations of all the methods declared in your .proto file. Since your server struct must implement all methods defined in the .proto file’s service section to satisfy the RKVSServiceServer interface. But often, you only want to implement some of them. So when you include <code>pb.UnimplementedRKVSServiceServer</code>, your struct now inherits those defaults, and you only need to override the ones you care about.</p><h3 id="Start-the-gRPC-Server">Start the gRPC Server</h3><div class="code-wrapper"><pre><code class="hljs go">grpcServer := grpc.NewServer()pb.RegisterRKVSServiceServer(grpcServer, s) <span class="hljs-comment">// s is an object that implements all the methods of RKVSServiceServer</span>lis, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, addr)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatalf(<span class="hljs-string">&quot;Failed to listen: %v&quot;</span>, err)&#125;log.Printf(<span class="hljs-string">&quot;Listening on %s&quot;</span>, addr)grpcServer.Serve(lis) <span class="hljs-comment">// Starts the main server loop</span></code></pre></div><h3 id="Make-gRPC-Requests-as-a-Client">Make gRPC Requests as a Client</h3><div class="code-wrapper"><pre><code class="hljs go">conn, err := grpc.NewClient(peerAddr, grpc.WithTransportCredentials(insecure.NewCredentials())) <span class="hljs-comment">// create a connection to server</span><span class="hljs-keyword">defer</span> conn.Close()client := pb.NewRKVSServiceClient(conn) <span class="hljs-comment">// create a client stub</span>_, err = client.Replicate(context.Background(), &amp;pb.ReplicateRequest&#123;Key: <span class="hljs-string">&quot;foo&quot;</span>, Value: <span class="hljs-string">&quot;bar&quot;</span>&#125;)</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>RPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - Go I/O</title>
    <link href="/2025/04/29/CSE224/go-io/"/>
    <url>/2025/04/29/CSE224/go-io/</url>
    
    <content type="html"><![CDATA[<h2 id="Read-and-Write-binary-files">Read and Write binary files</h2><p>Go follows the Reader/Writer interface model:</p><ol><li>io.Reader:  Can read data (Read([]byte) (int, error))</li><li>io.Writer:  Can write data (Write([]byte) (int, error))</li></ol><p>Most I/O types (files, TCP connections, buffers) implement these interfaces.</p><h3 id="I-O-types">I/O types</h3><div class="code-wrapper"><pre><code class="hljs go">file, _ := os.Open(<span class="hljs-string">&quot;hello.txt&quot;</span>) <span class="hljs-comment">// *os.File, used when read/write to files.</span>conn, _ := net.Dial(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;example.com:80&quot;</span>)  <span class="hljs-comment">// net.Conn, </span>r := strings.NewReader(<span class="hljs-string">&quot;hello world&quot;</span>) <span class="hljs-comment">// *strings.Reader</span>r := bufio.NewReader(strings.NewReader(<span class="hljs-string">&quot;hello\nworld&quot;</span>)) <span class="hljs-comment">// bufio.Reader, wraps any io.Reader to add buffering and helper methods like ReadLine(), ReadString(&#x27;\n&#x27;), etc.</span></code></pre></div><p>All above implements both io.Reader and io.Writer.</p><h3 id="Read-a-binary-file">Read a binary file</h3><p>Open a file:</p><div class="code-wrapper"><pre><code class="hljs go">file, err := os.Open(<span class="hljs-string">&quot;file.bin&quot;</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;<span class="hljs-keyword">defer</span> file.Close()</code></pre></div><p>Read specific number of bytes</p><div class="code-wrapper"><pre><code class="hljs go">buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">8</span>) <span class="hljs-comment">// read 8 bytes</span>_, err := file.Read(buf)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;</code></pre></div><ul><li><code>n, err := file.Read(buf)</code>: Read to a slice of bytes, returns actual number of bytes read, may read less than you ask for, even though there’s more data available later. <strong>It blocks until at least some bytes are ready to be read.</strong></li><li><code>n, err := io.ReadFull(reader, buf)</code>: Reads exactly len(buf) bytes, blocking until buffer is full or EOF.</li><li><code>data, err := io.ReadAll(reader)</code>: Reads entire stream until EOF into memory (until I receive EOF).</li><li><code>data, err := os.ReadFile(filePath)</code>: os.ReadFile is a convenience function that: Opens a file, Reads all of its contents into memory, Closes the file, Returns the file contents as a []byte.</li></ul><p>Read and convert</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> num <span class="hljs-type">int32</span>err := binary.Read(file, binary.LittleEndian, &amp;num)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;fmt.Println(<span class="hljs-string">&quot;Read int32:&quot;</span>, num)</code></pre></div><ul><li><code>err := binary.Read()</code>: A high-level function from encoding/binary, read and then convert</li></ul><h3 id="Write-a-binary-file">Write a binary file</h3><p>Create a binary file</p><div class="code-wrapper"><pre><code class="hljs go">file, err := os.Create(<span class="hljs-string">&quot;data.bin&quot;</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;<span class="hljs-keyword">defer</span> file.Close()</code></pre></div><div class="code-wrapper"><pre><code class="hljs go">data := []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hello, binary world!\n&quot;</span>)n, err := file.Write(data)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;</code></pre></div><ul><li><code>n, err := writer.Write(data)</code>: Writes len(data) bytes, returns how many were actually written (should be all, or an error).</li><li><code>error := os.WriteFile(name string, data []byte, perm fs.FileMode)</code>: writes data to a file in one shot</li></ul><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> number <span class="hljs-type">uint32</span> = <span class="hljs-number">123456</span>err = binary.Write(file, binary.LittleEndian, number)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    log.Fatal(err)&#125;</code></pre></div><h3 id="Communicate-via-network">Communicate via network</h3><p>When you call <code>conn.Write(data)</code> in Go (e.g., using a TCP connection), you’re not directly writing data onto the network wire. Instead, your data is copied into the OS’s send buffer. The OS then takes care of delivering that data over the network asynchronously.</p><p>When you call <code>conn.Read(buffer)</code>, you’re trying to read data from the OS’s receive buffer. If no data is available yet, <code>Read()</code> will block (wait) until some data is available.</p><h2 id="Client-and-Server">Client and Server</h2><p>Server:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (  <span class="hljs-string">&quot;fmt&quot;</span>  <span class="hljs-string">&quot;net&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123; <span class="hljs-comment">// Start listening on TCP port 9000</span> listener, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;127.0.0.1:9000&quot;</span>)  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Error starting server:&quot;</span>, err)   <span class="hljs-keyword">return</span>  &#125;  <span class="hljs-keyword">defer</span> listener.Close()  fmt.Println(<span class="hljs-string">&quot;Server is listening on 127.0.0.1:9000&quot;</span>) <span class="hljs-keyword">for</span> &#123;    conn, err := listener.Accept()    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;      fmt.Println(<span class="hljs-string">&quot;Failed to accept connection:&quot;</span>, err)     <span class="hljs-keyword">continue</span>    &#125;    <span class="hljs-keyword">go</span> handleConnection(conn) <span class="hljs-comment">// Handle each connection concurrently</span>  &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleConnection</span><span class="hljs-params">(conn net.Conn)</span></span> &#123; <span class="hljs-keyword">defer</span> conn.Close()  buffer := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1024</span>) <span class="hljs-comment">// Create a buffer to hold incoming data</span>  n, err := conn.Read(buffer) <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Failed to read data:&quot;</span>, err)   <span class="hljs-keyword">return</span>  &#125;  message := <span class="hljs-type">string</span>(buffer[:n])  fmt.Printf(<span class="hljs-string">&quot;Received message: %s\n&quot;</span>, message)  <span class="hljs-comment">// Send a response back</span> response := <span class="hljs-string">&quot;Hello Client! I got your message: &quot;</span> + message conn.Write([]<span class="hljs-type">byte</span>(response))&#125;</code></pre></div><p>Client:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (  <span class="hljs-string">&quot;fmt&quot;</span>  <span class="hljs-string">&quot;net&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123; <span class="hljs-comment">// Connect to the server</span>  conn, err := net.Dial(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;127.0.0.1:9000&quot;</span>)  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Error connecting to server:&quot;</span>, err)    <span class="hljs-keyword">return</span>  &#125;  <span class="hljs-keyword">defer</span> conn.Close()  <span class="hljs-comment">// Send a message</span> message := <span class="hljs-string">&quot;Hello Server!&quot;</span> _, err = conn.Write([]<span class="hljs-type">byte</span>(message)) <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Failed to send message:&quot;</span>, err)    <span class="hljs-keyword">return</span>  &#125;  <span class="hljs-comment">// Read the response</span>  buffer := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1024</span>) n, err := conn.Read(buffer) <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Failed to read response:&quot;</span>, err)   <span class="hljs-keyword">return</span>  &#125;  response := <span class="hljs-type">string</span>(buffer[:n]) fmt.Printf(<span class="hljs-string">&quot;Server replied: %s\n&quot;</span>, response)&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSE224 - Go Basis</title>
    <link href="/2025/04/03/CSE224/go-basis/"/>
    <url>/2025/04/03/CSE224/go-basis/</url>
    
    <content type="html"><![CDATA[<h2 id="How-to-create-a-go-project">How to create a go project</h2><ol><li><p><code>mkdir myapp</code>, <code>cd myapp</code></p></li><li><p>create a module: <code>go mod init github.com/yourname/myapp</code>, then go will generate a <code>go.mod</code> file inside.</p></li><li><p>create <code>main.go</code>:</p></li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    fmt.Println(<span class="hljs-string">&quot;Hello, Module!&quot;</span>)&#125;</code></pre></div><p>execute <code>go run main.go</code> to run it.</p><ol start="4"><li>add dependencies:</li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;[github.com/google/uuid](https://github.com/google/uuid)&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    id := uuid.New()    fmt.Println(<span class="hljs-string">&quot;Generated UUID:&quot;</span>, id)&#125;</code></pre></div><p>after I execute <code>go run main.go</code>, go will download <code>github.com/google/uuid</code> and add <code>require github.com/google/uuid v1.3.1</code> to <code>go.mod</code> config file.</p><h3 id="Packages">Packages</h3><div class="code-wrapper"><pre><code class="hljs xl">myproject/│├── <span class="hljs-function"><span class="hljs-title">go</span>.<span class="hljs-built_in">mod</span>              -&gt;</span> <span class="hljs-built_in">mod</span> file├── <span class="hljs-function"><span class="hljs-title">main</span>.go             -&gt;</span> package main├── utils/│   └── <span class="hljs-function"><span class="hljs-title">math</span>.go         -&gt;</span> package utils├── service/│   └── <span class="hljs-function"><span class="hljs-title">handler</span>.go      -&gt;</span> package service</code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// main.go</span><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;myapp/utils&quot;</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    <span class="hljs-built_in">println</span>(utils.SayHi())&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// utils/helper.go</span><span class="hljs-keyword">package</span> utils<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SayHi</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hi&quot;</span>&#125;</code></pre></div><ol><li>Each <code>.go</code> file must have <code>package xxx</code></li><li>A module usually have many packages.</li><li>Each folder must have one package.</li><li>Can import between packages.</li><li><strong>Functions can freely call each other as long as they’re defined in the same package (even if they are in different files)</strong>.</li><li>In a Go project, the entry point is always the main package, specifically the main() function inside it. When I run <code>go build</code>, Go will look for <code>package main</code> and <code>func main()</code>, and then compiles all dependencies recursively together into a single executable.</li><li>A module can have multiple main packages, each in a different subdirectory. Each main.go here is its own entry point, and Go builds them into separate executables.</li></ol><div class="code-wrapper"><pre><code class="hljs stylus">mytool/              ← module├── go<span class="hljs-selector-class">.mod</span>├── cmd/│   ├── server/│   │   └── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span>   ← package <span class="hljs-selector-tag">main</span> (binary <span class="hljs-number">1</span>)│   └── cli/│       └── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span>   ← package <span class="hljs-selector-tag">main</span> (binary <span class="hljs-number">2</span>)├── internal/│   └── logic<span class="hljs-selector-class">.go</span>      ← package internal (shared code)</code></pre></div><h2 id="Value-Type">Value Type</h2><p>Assigning it to a new variable, or passing it to a function, creates a copy of the value.</p><ol><li>Basic types:  int, float64, bool, string</li><li>Arrays: [3]int, [5]byte</li><li>Structs:  type Point struct {x, y int}</li><li>Custom types: type MyInt int</li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Point <span class="hljs-keyword">struct</span> &#123;    X, Y <span class="hljs-type">int</span>&#125;p1 := Point&#123;X: <span class="hljs-number">1</span>, Y: <span class="hljs-number">2</span>&#125;p2 := p1 <span class="hljs-comment">// Copy of p1</span>p2.X = <span class="hljs-number">100</span>fmt.Println(p1.X) <span class="hljs-comment">// 1 — unchanged</span>fmt.Println(p2.X) <span class="hljs-comment">// 100 — only p2 changed</span></code></pre></div><h2 id="Pointer-Type">Pointer Type</h2><p>The following are pointer types:</p><ol><li>slice</li></ol><div class="code-wrapper"><pre><code class="hljs go">a := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;b := ab[<span class="hljs-number">0</span>] = <span class="hljs-number">99</span>fmt.Println(a[<span class="hljs-number">0</span>]) <span class="hljs-comment">// 99</span></code></pre></div><ol start="2"><li>map</li><li>channel</li><li>function</li><li>interface</li></ol><h2 id="Basic-Syntax">Basic Syntax</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> x <span class="hljs-type">int</span> = <span class="hljs-number">42</span>z := <span class="hljs-number">3.14</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a <span class="hljs-type">int</span>, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123;    <span class="hljs-keyword">return</span> a + b&#125;<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;    Name <span class="hljs-type">string</span>    Age  <span class="hljs-type">int</span>&#125;p := Person&#123;Name: <span class="hljs-string">&quot;Alice&quot;</span>, Age: <span class="hljs-number">30</span>&#125;fmt.Println(p.Name)</code></pre></div><h2 id="Array-and-Slices">Array and Slices</h2><h3 id="Array">Array:</h3><p>Arrays are value types, so <code>[3]int</code> is not compatible with <code>[4]int</code>.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> arr [<span class="hljs-number">3</span>]<span class="hljs-type">int</span> <span class="hljs-comment">// array of 3 integers, all initialized to 0</span>b := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;         <span class="hljs-comment">// initialized with values</span>c := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;    <span class="hljs-comment">// size inferred to be 4</span>a[<span class="hljs-number">0</span>] = <span class="hljs-number">42</span>  <span class="hljs-comment">// mutation</span></code></pre></div><h3 id="Slices">Slices</h3><p>A slice is a flexible, powerful view into an underlying array. It lets you work with sequences that can grow, shrink, or share memory</p><p>A slice is a struct with three fields:</p><ol><li>A pointer to the underlying array</li><li>A length (number of visible elements)</li><li>A capacity (maximum number of elements before reallocation) (cap(t) = number of elements from (start of the slice) to end of the backing array.)</li></ol><h4 id="Slice-creation">Slice creation:</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 1. From an array</span>arr := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;s := arr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>] <span class="hljs-comment">// slice of [2, 3, 4]</span><span class="hljs-comment">// 2. Using a literal</span>s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>&#125;<span class="hljs-comment">// 3. Using make</span>s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">3</span>)         <span class="hljs-comment">// length 3, capacity 3</span>s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>)      <span class="hljs-comment">// length 2, capacity 5</span></code></pre></div><h4 id="Slice-internals">Slice internals:</h4><div class="code-wrapper"><pre><code class="hljs go">s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;t := s[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>] <span class="hljs-comment">// t = [2, 3, 4], length = 3, capacity = 4</span></code></pre></div><h4 id="Modification">Modification</h4><div class="code-wrapper"><pre><code class="hljs go">s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;t := s[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>] <span class="hljs-comment">// [2 3 4]</span>fmt.Println(<span class="hljs-built_in">len</span>(t)) <span class="hljs-comment">// 3</span>fmt.Println(<span class="hljs-built_in">cap</span>(t)) <span class="hljs-comment">// 4</span><span class="hljs-comment">// t and s points to the same array</span>t = <span class="hljs-built_in">append</span>(t, <span class="hljs-number">99</span>)   <span class="hljs-comment">// still fits in capacity, modifies s[4]!</span>fmt.Println(s)      <span class="hljs-comment">// [1 2 3 4 99]</span></code></pre></div><p>Append:<br>If there’s enough capacity, append extends the existing array. Otherwise, it allocates a new backing array.</p><div class="code-wrapper"><pre><code class="hljs go">s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>) <span class="hljs-comment">// s = [1, 2, 3, 4]</span></code></pre></div><h2 id="Pointers">Pointers</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> x <span class="hljs-type">int</span> = <span class="hljs-number">10</span><span class="hljs-keyword">var</span> px *<span class="hljs-type">int</span> = &amp;x <span class="hljs-comment">// px holds the address of x</span>*px = <span class="hljs-number">20</span> <span class="hljs-comment">// sets x to 20 through the pointer</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modify</span><span class="hljs-params">(n *<span class="hljs-type">int</span>)</span></span> &#123;    *n = <span class="hljs-number">42</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    a := <span class="hljs-number">10</span>    modify(&amp;a)         <span class="hljs-comment">// pass address of a</span>    fmt.Println(a)     <span class="hljs-comment">// 42</span>&#125;</code></pre></div><h2 id="Loop">Loop</h2><p>There is no <code>while</code> keyword in Go.</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;    fmt.Println(i)&#125;i := <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i &lt; <span class="hljs-number">5</span> &#123;    fmt.Println(i)    i++&#125;<span class="hljs-comment">// Infinite loop</span><span class="hljs-keyword">for</span> &#123;    fmt.Println(<span class="hljs-string">&quot;This will run forever unless you break it&quot;</span>)&#125;<span class="hljs-comment">// Looping over collections </span><span class="hljs-comment">// range returns two stuffs: index and value. index and value are declared and initialized automatically by the Go compiler as part of the loop syntax.</span>nums := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>&#125;<span class="hljs-keyword">for</span> index, value := <span class="hljs-keyword">range</span> nums &#123;    fmt.Println(<span class="hljs-string">&quot;Index:&quot;</span>, index, <span class="hljs-string">&quot;Value:&quot;</span>, value)&#125;<span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> nums &#123;    fmt.Println(Value:<span class="hljs-string">&quot;, value)</span><span class="hljs-string">&#125;</span></code></pre></div><h2 id="Map">Map</h2><p>Create a map:</p><div class="code-wrapper"><pre><code class="hljs go">ages := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;    <span class="hljs-string">&quot;Alice&quot;</span>: <span class="hljs-number">25</span>,    <span class="hljs-string">&quot;Bob&quot;</span>:   <span class="hljs-number">30</span>,&#125;colors := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)colors[<span class="hljs-string">&quot;red&quot;</span>] = <span class="hljs-string">&quot;#FF0000&quot;</span>colors[<span class="hljs-string">&quot;green&quot;</span>] = <span class="hljs-string">&quot;#00FF00&quot;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// Iterate a map:</span><span class="hljs-keyword">for</span> name, age := <span class="hljs-keyword">range</span> ages &#123;  fmt.Printf(<span class="hljs-string">&quot;%s %d\n&quot;</span>, name, age)&#125;<span class="hljs-comment">// Check if exists:</span><span class="hljs-comment">// ok is a boolean indicating whether the key exists in the map</span>age, ok := ages[<span class="hljs-string">&quot;Alice&quot;</span>]<span class="hljs-keyword">if</span> ok &#123;    fmt.Println(<span class="hljs-string">&quot;Found:&quot;</span>, age)&#125; <span class="hljs-keyword">else</span> &#123;    fmt.Println(<span class="hljs-string">&quot;Not found&quot;</span>)&#125;<span class="hljs-comment">// delete a key</span><span class="hljs-built_in">delete</span>(ages, <span class="hljs-string">&quot;Bob&quot;</span>)</code></pre></div><h2 id="Function-as-parameters">Function as parameters</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">apply</span><span class="hljs-params">(fn <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>, val <span class="hljs-type">int</span>) <span class="hljs-type">int</span> &#123; <span class="hljs-keyword">return</span> fn(val)&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CSE224</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - Express.js</title>
    <link href="/2024/11/26/CS142/expressjs/"/>
    <url>/2024/11/26/CS142/expressjs/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<span class="hljs-keyword">let</span> expressApp = <span class="hljs-title function_">express</span>();</code></pre></div><p>The instance <code>expressAPP</code> provides all the methods to:</p><ol><li>Route HTTP requests (map different URLs to different logic)</li><li>Render HTML</li><li>Configure middleware (Middleware are functions that process requests before they reach routes)</li></ol><h3 id="Express-Routing">Express Routing</h3><p>Routing allows you to define actions for specific HTTP methods:</p><div class="code-wrapper"><pre><code class="hljs javascript">expressApp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/path&#x27;</span>, callback);expressApp.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/path&#x27;</span>, callback);expressApp.<span class="hljs-title function_">put</span>(<span class="hljs-string">&#x27;/path&#x27;</span>, callback);expressApp.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;/path&#x27;</span>, callback);expressApp.<span class="hljs-title function_">all</span>(<span class="hljs-string">&#x27;/path&#x27;</span>, callback); <span class="hljs-comment">// Handles requests for all HTTP methods (e.g., GET, POST, etc.) on a specific path.</span>expressApp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/:user_id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`User ID is <span class="hljs-subst">$&#123;req.params.user_id&#125;</span>`</span>);&#125;);</code></pre></div><p>The order of execution in Express routes is determined by the order in which they are defined in your code. Here’s the principle:</p><ul><li>When a request is received, Express evaluates routes from top to bottom in the order they are defined in the code.</li><li>It stops at the first match it finds (this is called short-circuiting).</li></ul><h4 id="httpRequest-Object">httpRequest Object</h4><p>It represents the HTTP request sent by the client.</p><ul><li><code>request.params</code>: Access route parameters</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">expressApp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/:user_id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">user_id</span>); <span class="hljs-comment">// Logs the user_id</span>&#125;);</code></pre></div><ul><li><code>request.query</code>: Contains query string parameters from the URL</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">expressApp.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/search&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>); <span class="hljs-comment">// &#123; foo: &#x27;9&#x27; &#125; ?foo=9 becomes &#123;foo: &#x27;9&#x27;&#125;</span>&#125;);</code></pre></div><ul><li><code>request.body</code>: Contains the body of POST or PUT requests</li></ul><h4 id="httpResponse-Object">httpResponse Object</h4><p>Represents the response sent back to the client.</p><ul><li><code>response.send(content)</code>: Sends a response to the client (automatically ends the response). e.g., <code>res.send('Hello, world!');</code>.</li><li><code>response.status(code)</code>: Sets the HTTP status code of the response. e.g., <code>res.status(404).send('Not Found');</code>.</li><li><code>response.set(field, value)</code>: Sets a custom HTTP response header.</li><li><code>response.end()</code>: Ends the response process.</li><li>channing: e.g., <code>res.status(200).send('OK');</code></li></ul><p>Example Usage:</p><div class="code-wrapper"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;  <span class="hljs-keyword">let</span> id = request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;  <span class="hljs-keyword">let</span> user = cs142models.<span class="hljs-title function_">userModel</span>(id);  <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;User with _id:&#x27;</span> + id + <span class="hljs-string">&#x27; not found.&#x27;</span>);    response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Not found&#x27;</span>);    <span class="hljs-keyword">return</span>;  &#125;  response.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">send</span>(user);  <span class="hljs-keyword">return</span>;&#125;);</code></pre></div><h3 id="Middleware">Middleware</h3><p>Middleware are functions that can:</p><ol><li>Intercept HTTP requests.</li><li>Perform operations on the request/response objects.</li><li>Either terminate the request-response cycle or pass control to the next middleware in the stack using next().</li></ol><div class="code-wrapper"><pre><code class="hljs javascript">app.<span class="hljs-title function_">all</span>(<span class="hljs-string">&#x27;/specific-route&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Middleware for /specific-route&#x27;</span>);  <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// Pass control to the next handler or middleware</span>&#125;);</code></pre></div><ul><li><code>app.all()</code>: Matches all HTTP methods for the route.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Global Middleware&#x27;</span>);  <span class="hljs-title function_">next</span>();&#125;);</code></pre></div><ul><li><code>app.use()</code>: Registers middleware for all routes.</li></ul><p>e.g., <code>app.use(express.json());</code>, Use built-in middleware for parsing JSON.</p>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - Node.js</title>
    <link href="/2024/10/30/CS142/nodejs/"/>
    <url>/2024/10/30/CS142/nodejs/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Node.js is an open-source, cross-platform JavaScript runtime environment that executes JavaScript code outside of a web browser.</p><ul><li>Single-Threaded Event Loop: Node.js uses a single-threaded event loop. The Event Loop continuously checks the event queue to see if there are any events to be handled.</li><li>Non-blocking I/O: Node.js performs I/O operations (like reading from a database or reading from a file) asynchronously. Instead of waiting for the operation to complete, Node.js registers a callback and moves on to handle the next event. This non-blocking behavior ensures that Node.js can handle many I/O operations concurrently without getting bogged down by slow operations</li></ul><h2 id="Module-System">Module System</h2><ul><li><p><code>require</code> is a function in Node.js used to load modules. We use <code>Express</code> and <code>Mongoose</code> for web development.</p><ul><li>System modules: Built-in Node.js modules like fs, http, path, etc.</li><li>File modules: Like <code>require(&quot;./myModule.js&quot;)</code></li><li>Directory modules: Like <code>require(&quot;./myModule&quot;)</code>, look for <code>myModule/index.js</code></li></ul></li><li><p>In Node.js, every module (or file) has its own scope, module.exports allows us to make functions or variables available to other files.</p></li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> notGlobal;<span class="hljs-keyword">function</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params"></span>) &#123;&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">func2</span>(<span class="hljs-params"></span>) &#123;&#125;<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<span class="hljs-attr">func1</span>: func1, <span class="hljs-attr">func2</span>: func2&#125;;</code></pre></div><h2 id="Non-blocking">Non-blocking</h2><div class="code-wrapper"><pre><code class="hljs javascript">r1 = <span class="hljs-title function_">step1</span>();<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step1 done&#x27;</span>, r1);r2 = <span class="hljs-title function_">step2</span>(r1);<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step2 done&#x27;</span>, r2);r3 = <span class="hljs-title function_">step3</span>(r2);<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step3 done&#x27;</span>, r3);<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;All Done!&#x27;</span>);</code></pre></div><p>If <code>step()</code> function doesn’t block, then it’s ok.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">step1</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">r1</span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step1 done&#x27;</span>, r1);    <span class="hljs-title function_">step2</span>(r1, <span class="hljs-keyword">function</span> (<span class="hljs-params">r2</span>) &#123;        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step2 done&#x27;</span>, r2);        <span class="hljs-title function_">step3</span>(r2, <span class="hljs-keyword">function</span> (<span class="hljs-params">r3</span>) &#123;            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;step3 done&#x27;</span>, r3);            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;All Done!&#x27;</span>);  <span class="hljs-comment">// Correct</span>        &#125;);    &#125;);&#125;);<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;All Done!&#x27;</span>); <span class="hljs-comment">// Wrong!</span></code></pre></div><p>If the function is blocking, use callbacks.</p><h2 id="Listener-and-Emitter">Listener and Emitter</h2><div class="code-wrapper"><pre><code class="hljs javascript">myEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">param1, param2</span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;myEvent occurred with &#x27;</span> + param1 + <span class="hljs-string">&#x27; and &#x27;</span> + param2 + <span class="hljs-string">&#x27;!&#x27;</span>);&#125;);myEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, <span class="hljs-string">&#x27;arg1&#x27;</span>, <span class="hljs-string">&#x27;arg2&#x27;</span>);</code></pre></div><p>On emit call listeners are called synchronously and in the order the listeners were registered.</p><p>Have multiple different events for different state or actions:</p><div class="code-wrapper"><pre><code class="hljs javascript">myEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;conditionA&#x27;</span>, doConditionA);myEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;conditionB&#x27;</span>, doConditionB);myEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;conditionC&#x27;</span>, doConditionC);myEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, handleErrorCondition);</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MaterialUI</title>
    <link href="/2024/10/09/CS142/material-ui/"/>
    <url>/2024/10/09/CS142/material-ui/</url>
    
    <content type="html"><![CDATA[<h2 id="Layout">Layout</h2><h3 id="Grid">Grid</h3><p><a href="https://mui.com/material-ui/react-grid2/">Official Documentation</a></p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">container</span> <span class="hljs-attr">spacing</span>=<span class="hljs-string">&#123;2&#125;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span> <span class="hljs-attr">xs</span>=<span class="hljs-string">&#123;12&#125;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">TopBar</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;cs142-main-topbar-buffer&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span> <span class="hljs-attr">sm</span>=<span class="hljs-string">&#123;3&#125;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">Paper</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;cs142-main-grid-item&quot;</span>&gt;</span>      ...    <span class="hljs-tag">&lt;/<span class="hljs-name">Paper</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span> <span class="hljs-attr">sm</span>=<span class="hljs-string">&#123;9&#125;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">Paper</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;cs142-main-grid-item&quot;</span>&gt;</span>      ...    <span class="hljs-tag">&lt;/<span class="hljs-name">Paper</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span></code></pre></div><ul><li>When my screen size is smaller than any specified screen size, components will take all 12 columns by default. In this case, when the screen size is xs, since no <code>xs={}</code> is specified and smallest, the Grid item will default to taking up all 12 columns. So the two <code>paper</code> components will stack on one another.</li><li>If a specific size (like md, lg, or xl) is not specified, the grid system will use the settings from the closest smaller breakpoint that is defined.</li></ul><h2 id="theme">theme</h2><p><a href="https://mui.com/material-ui/customization/default-theme/">The default Theme Parameters</a></p><h2 id="Miscellaneous">Miscellaneous</h2><h3 id="Template-Literals">Template Literals</h3><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ListItemText</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">&#123;</span>` $&#123;<span class="hljs-attr">user.first_name</span>&#125; $&#123;<span class="hljs-attr">user.last_name</span>&#125; `&#125; /&gt;</span></code></pre></div><ul><li>In JavaScript, strings can be created using single quotes (<code>'</code>), double quotes (<code>&quot;</code>), or backticks (<code>   </code> `). Backticks are used to create template literals, which is useful for formatting a string.</li><li><code>${}</code> allows you to interpolate JavaScript expressions or variables directly into the string, as shown in the example</li></ul><h3 id="Component-Prop">Component Prop</h3><p>Example:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Link&#125;</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;</span>`/$&#123;<span class="hljs-attr">user._id</span>&#125;`&#125; <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;list-item&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">ListItemText</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">&#123;</span>` $&#123;<span class="hljs-attr">user.first_name</span>&#125; $&#123;<span class="hljs-attr">user.last_name</span>&#125; `&#125; /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ListItem</span>&gt;</span></code></pre></div><ul><li>MUI components are built on top of standard HTML elements like div, button, a, etc.</li><li>The component prop allows you to specify which element or component should be rendered in place of the default one. For example, if you have an MUI <code>&lt;ListItem /&gt;</code>, its default rendering might be a <code>li</code> tag. However, you can replace that li tag with something else, like a Link (from react-router-dom or any other component), by passing the component={Link} prop.</li><li>In the example, I’m using the component={Link} prop to turn the ListItem into a Link component from react-router-dom. Since Link expects a <code>to={}</code> prop (which defines the route path for navigation), I’m able to pass <code>to={/${user._id}}</code> as a prop to the ListItem, because the ListItem is now acting as a Link component.</li></ul><h3 id="Overriding-Styles">Overriding Styles</h3><p>Every Material UI component accepts a className prop, which allows you to apply custom CSS classes to the component. For example,</p><div class="code-wrapper"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">Button</span> className=&quot;my-custom-<span class="hljs-selector-tag">button</span>&quot;&gt;Click Me&lt;/<span class="hljs-selector-tag">Button</span>&gt;<span class="hljs-selector-class">.my-custom-button</span> &#123;  <span class="hljs-attribute">background-color</span>: green;  <span class="hljs-attribute">color</span>: white;&#125;</code></pre></div><p>However, some Material UI components are composed of multiple nested elements. To target these specific parts, you need to use the global class names provided by Material UI. These class names follow a pattern like .MuiComponentName-elementName.</p><p>CSS pseudo-classes like <code>:hover</code>, <code>:focus</code>, and <code>:disabled</code> have higher specificity. Material UI mimics this behavior by applying state classes with higher specificity. Therefore, to override these styles, you need to match or exceed this specificity in your CSS. For example,</p><div class="code-wrapper"><pre><code class="hljs css">&lt;MenuItem selected className=&quot;my-<span class="hljs-selector-tag">menu</span>-item&quot;&gt;<span class="hljs-selector-tag">Option</span> <span class="hljs-number">1</span>&lt;/MenuItem&gt;<span class="hljs-selector-class">.my-menu-item</span> &#123;  <span class="hljs-attribute">color</span>: black;&#125;<span class="hljs-comment">/* Increase specificity for the selected state */</span><span class="hljs-selector-class">.my-menu-item</span><span class="hljs-selector-class">.Mui-selected</span> &#123;  <span class="hljs-attribute">color</span>: blue;&#125;</code></pre></div><ul><li><strong>When you add the selected prop to the MenuItem, Material UI automatically applies a special class called Mui-selected to the component.</strong> As a result, the <code>&lt;MenuItem selected className=&quot;my-menu-item&quot;&gt;Option 1&lt;/MenuItem&gt;</code> will have color blue instead of black.</li></ul><h4 id="Using-the-sx-prop">Using the sx prop</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">container</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span>&gt;</span>    ...  <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">item</span>&gt;</span>    ...  <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span></code></pre></div><p>The above html becomes the following in the browser, which are modified by materialUI by injecting some new classes:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MuiGrid-root MuiGrid-container&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MuiGrid-root MuiGrid-item&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MuiGrid-root MuiGrid-item&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Grid</span> <span class="hljs-attr">container</span> <span class="hljs-attr">spacing</span>=<span class="hljs-string">&#123;3&#125;</span> <span class="hljs-attr">sx</span>=<span class="hljs-string">&#123;&#123;</span></span><span class="hljs-tag">  <span class="hljs-attr">maxHeight:</span> &#x27;<span class="hljs-attr">80vh</span>&#x27;,</span><span class="hljs-tag">  <span class="hljs-attr">overflowY:</span> &#x27;<span class="hljs-attr">auto</span>&#x27;,</span><span class="hljs-tag">  &#x27;&amp; <span class="hljs-attr">.MuiGrid-root</span>&#x27;<span class="hljs-attr">:</span> &#123;</span><span class="hljs-tag">    <span class="hljs-attr">paddingLeft:</span> &#x27;<span class="hljs-attr">10px</span>&#x27;,</span><span class="hljs-tag">    <span class="hljs-attr">paddingTop:</span> &#x27;<span class="hljs-attr">10px</span>&#x27;,</span><span class="hljs-tag">    <span class="hljs-attr">paddingBottom:</span> &#x27;<span class="hljs-attr">10px</span>&#x27;</span><span class="hljs-tag">  &#125;,</span><span class="hljs-tag">&#125;&#125; &gt;</span></code></pre></div><ul><li>The <code>&amp;</code> represents the current component in the context of the sx prop. In this case, &amp; refers to the Grid container component.</li><li><code>'&amp; .MuiGrid-root'</code> targets all elements with the class <code>.MuiGrid-root</code> that are descendants of the Grid container.</li><li>As a result, the <code>'&amp; .MuiGrid-root'</code> applies the specified padding styles to all Grid items within the container.</li><li><a href="https://mui.com/material-ui/customization/how-to-customize/">Refer to this</a> for how to use this in more detail</li></ul>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - Server Communication</title>
    <link href="/2024/10/08/CS142/server-communication/"/>
    <url>/2024/10/08/CS142/server-communication/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>In software engineering, server comminicates with browser. Controller fetches the model for the View. There are a lot of tools that enable this functionality.</p><h3 id="AJAX">AJAX</h3><p>AJAX stands for Asynchronous JavaScript and XML. It is a set of web development techniques that allows a web page to communicate with a server asynchronously, meaning that the web page can update parts of itself (such as data in a table or form) without needing to reload the entire page. AJAX uses JavaScript to make HTTP requests to a server, fetch data, and then update parts of the web page.</p><h3 id="XMLHttpRequest">XMLHttpRequest</h3><p>One of the early methods for enabling browser-server communication was the XMLHttpRequest (XHR) object. It allows browsers to send asynchronous HTTP requests without refreshing the entire page.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> xhr;xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();xhr.<span class="hljs-property">onreadystatechange</span> = xhrHandler; <span class="hljs-comment">// Event handler for state change</span>xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url); <span class="hljs-comment">// Open a connection (GET request in this case)</span>xhr.<span class="hljs-title function_">send</span>(); <span class="hljs-comment">// Send the request</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">xhrHandler</span>(<span class="hljs-params">event</span>) &#123;    <span class="hljs-comment">// this === xhr (the XMLHttpRequest object)</span>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyState</span> != <span class="hljs-number">4</span>) &#123;        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> != <span class="hljs-number">200</span>) &#123;        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">let</span> text = <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseText</span>;    <span class="hljs-comment">// You can now use &#x27;text&#x27; as needed (e.g., display it, process it, etc.)</span>&#125;</code></pre></div><ul><li><p>Create an XMLHttpRequest object, open a connection to the server (GET/POST/other methods), and send the request.</p></li><li><p><strong>The onreadystatechange event handler is called every time the readyState of the XMLHttpRequest object changes</strong>. The <strong>readyState</strong> property of the XMLHttpRequest object represents the current state of the request:</p></li><li><p>0: UNSENT – The request has not been initialized yet.</p></li><li><p>1: OPENED – The request has been opened but not sent yet.</p></li><li><p>2: HEADERS_RECEIVED – The request has been sent, and headers have been received.</p></li><li><p>3: LOADING – The request is in progress, and some response data has been received (but not fully).</p></li><li><p>4: DONE – The request is complete, and the full response is available.</p></li><li><p>In this example, the handler only cares about the final state (i.e., readyState == 4) when the request has been completed:</p></li><li><p><code>this.readyState != 4</code>: This condition checks whether the request has completed or not. If the state is not 4 (DONE), it returns early and doesn’t proceed.</p></li><li><p><code>this.status != 200</code>: Once the request is complete, this condition checks whether the HTTP status code is 200 (OK). If the status is not 200, it returns early, meaning it only proceeds if the request was successful.</p></li><li><p><code>this.responseText</code>: After confirming the request has completed successfully, it retrieves the response text (the raw data returned from the server) and stores it in text. You can then use this text as needed.</p></li><li><p>Nowadays, <code>fetch()</code> api is more widely used. The response is usually JSON object nowadays.</p></li></ul><h3 id="REST-API">REST API</h3><p>REST API (Representational State Transfer Application Programming Interface) is a set of rules that allows systems to communicate with each other over the internet using HTTP methods.</p><ul><li>Resource: A resource in REST is any data or object that can be accessed and manipulated via the API, such as user profiles, blog posts, comments, products, etc.</li><li>URI: Uniform Resource Identifier, typically a URL, e.g., <code>/books</code> might represent the collection of books.</li><li>HTTP methods: GET, POST, DELETE, PUT.</li><li>e.g., <code>GET /photo/78237489</code>, <code>POST /photo/</code>.</li><li>Clients (web apps, mobile apps) send HTTP requests to specific endpoints, and the server responds with data (often in JSON format)</li><li>REST APIs are platform-independent and can be accessed by any client that can send HTTP requests (e.g., web browsers, mobile apps, or servers). With a REST API, the frontend and backend can be developed independently.</li><li>RESTful APIs are stateless, meaning that the server does not store any information about the client between requests.</li></ul><p>In conclusion, RESt API provides Standardization (otherwise, we need to customize how browser interacts with the server), Decoupling of frontend and backend, and Scalability.</p><h3 id="Axios">Axios</h3><p>Axios is a JavaScript library that simplifies making HTTP requests. Axios is also promise-based and is widely used for communicating with RESTful APIs. It is a wrapper around XMLHttpRequest but provides a cleaner, more intuitive API, automatic JSON parsing, and better error handling. Axios can be used for making AJAX requests, just like fetch() or XMLHttpRequest. Here is an example usage:</p><div class="code-wrapper"><pre><code class="hljs javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/user/123&#x27;</span>)  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">data</span>)) <span class="hljs-comment">// Process the JSON response</span>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error:&#x27;</span>, error));</code></pre></div><h2 id="Promises">Promises</h2><p>For how to use promises, please refer to <a href="https://thiefcat.github.io/2024/07/14/MIT-Weblab/Async-Control/">MIT Weblab笔记 - Asynchronous Control</a>.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Document on promises</a></p>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - Single Page Application</title>
    <link href="/2024/08/13/CS142/spa/"/>
    <url>/2024/08/13/CS142/spa/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>In a traditional web app, changing the URL usually means sending a request to the server for a new HTML document.</p><p>In contrast, SPAs generally involve a single HTML file that serves as the structure for the entire app. Once loaded, this file stays in place, and JavaScript handles any further changes to the page’s content. SPAs dynamically rewrite the current page using JavaScript, allowing for a smoother, faster user experience.</p><h2 id="React-Router">React Router</h2><h3 id="HashRouter">HashRouter</h3><p>We can use the URL to control which components are rendered by React. The URL becomes the single source of truth for what should be displayed on the screen.</p><p>The primary role of a router in a Single Page Application (SPA) is to manage page navigation without triggering a full page reload.</p><ul><li>The router listens for changes in the browser’s URL. The router intercepts the change and decides which part of the application to render. For example, if the URL changes from <code>/home</code> to <code>/about</code>, the router will swap out the current component for a different one.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">&lt;<span class="hljs-title class_">HashRouter</span>&gt;  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">    ...</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/states&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;States&#125;</span> /&gt;</span></span><span class="language-xml">    ...</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/states&quot;</span>&gt;</span>States<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><span class="language-xml">    ...</span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>&lt;/<span class="hljs-title class_">HashRouter</span>&gt;</code></pre></div><ul><li><code>&lt;HashRouter&gt;</code>: With HashRouter, the URL will contain a <code>#</code> symbol, followed by the client-side route. For example: <code>http://localhost:3000/#/users/123</code>. In this case, the URL before the hash (<a href="http://localhost:3000/">http://localhost:3000/</a>) is what the server handles, and everything after the <code>#</code> (/users/123) is used by the client-side routing mechanism to render the appropriate view in the React app.</li><li><code>&lt;Route /&gt;</code>: Define a route in application. When the URL matches the path, React Router renders the component specified in the component prop. <strong>If the URL starts with the defined path, the route is considered a match.</strong></li><li><code>&lt;Link /&gt;</code>: Generates a hyperlink with href=“#/states” and the text “States”.</li><li>In conclusion, when clicking the link with text “States”, the url will be updated to <code>http://localhost:3000/p5.html#/states</code>, where <code>http://localhost:3000/p5.html</code> is the current path, and the component <code>States</code> will be rendered by <code>&lt;Route path=&quot;/states&quot; component={States} /&gt;</code>. In a URL, the part after the # is called the fragment identifier or hash. The primary purpose of the hash in URLs is to provide a way to navigate to a specific section or state of a page without causing a full page reload.</li><li>When you load a URL with a hash (e.g., <code>http://localhost:3000/#/users/123</code>), the browser doesn’t send anything after the <code>#</code> to the server. It only requests the base URL (in this case, <code>http://localhost:3000/</code>). Then, hashRouter looks at the fragment (#/users/123) and maps it to the appropriate route defined in your React app (e.g., <code>/users/:userId</code>).</li></ul><p>We can also pass parameters with React Router</p><div class="code-wrapper"><pre><code class="hljs javascript">&lt;<span class="hljs-title class_">Route</span>  path=<span class="hljs-string">&quot;/Book/:book/ch/:chapter&quot;</span>  component=&#123;<span class="hljs-title class_">BookChapterComponent</span>&#125;/&gt;<span class="hljs-keyword">function</span> <span class="hljs-title function_">BookChapterComponent</span>(<span class="hljs-params">&#123; match &#125;</span>) &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Book: &#123;match.params.book&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Chapter: &#123;match.params.chapter&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;&lt;<span class="hljs-title class_">Link</span> to=<span class="hljs-string">&quot;/Book/Moby/ch/1&quot;</span>&gt;<span class="hljs-title class_">Moby</span>&lt;/<span class="hljs-title class_">Link</span>&gt;</code></pre></div><ul><li><code>:book</code> and <code>:chapter</code> are placeholders in the URL that will be dynamically replaced by actual values when the route is matched.</li><li><code>match</code> is an object that contains information about how the URL matches the route.</li><li>When this link is clicked, the React Router will navigate to this URL, and the BookChapterComponent will render with <code>match.params.book</code> set to “Moby” and <code>match.params.chapter</code> set to “1”.</li><li>this.props.match is passed automatically to any component that is rendered by a <code>Route</code>.</li><li>If your component is supposed to receive props from React Router (like match, location, and history), it must be rendered inside a Route</li></ul><div class="code-wrapper"><pre><code class="hljs html">import &#123; Route &#125; from &#x27;react-router-dom&#x27;;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/users/:userId&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;YourComponent&#125;</span> /&gt;</span></code></pre></div><ul><li>Deep linking: Deep linking refers to the ability to link directly to a specific page or view within a web application. URLs that map directly to certain views (like <code>/photos/57231f1a30e4351f4e9f4bd8</code>) can be shared with others, who can then access the same page or state.</li></ul><p>React Router provides two main ways to render components when a route matches: the <code>component</code> prop and the <code>render</code> prop.</p><ul><li>component: This is used when you want to simply render a component without needing to pass additional props or logic.</li><li>render: This is used when you want to pass custom props or add additional logic before rendering the component. With render, you can control what props are passed to the component and include any dynamic data. <code>render</code> should be a function that returns the component.</li></ul><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/users/:userId&quot;</span> <span class="hljs-attr">render</span>=<span class="hljs-string">&#123;props</span> =&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">UserDetail</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">extraProp</span>=<span class="hljs-string">&#123;extraProp&#125;</span> <span class="hljs-attr">handler</span>=<span class="hljs-string">&#123;this.handleUserNameChange&#125;</span> /&gt;</span>&#125; /&gt;</code></pre></div><h3 id="Switch">Switch</h3><p>Switch is responsible for rendering the <strong>first child</strong> <code>&lt;Route&gt;</code> that matches the current URL. It ensures that only one route is displayed at a time.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> routes = (  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">About</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/:user&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">User</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NoMatch</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Switch</span>&gt;</span></span>);</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - How React Works</title>
    <link href="/2024/08/12/CS142/how-react-works/"/>
    <url>/2024/08/12/CS142/how-react-works/</url>
    
    <content type="html"><![CDATA[<p>For how to use React to create a Web Application, including how to create component, props, and states, please refer to <a href="https://thiefcat.github.io/2024/07/03/MIT-Weblab/React/">MIT Weblab笔记 - React Introduction</a> and <a href="https://thiefcat.github.io/2024/07/04/MIT-Weblab/React-Advanced/">MIT Weblab笔记 - React Advanced</a>.</p><h2 id="Takeaway">Takeaway</h2><ul><li>To create a React application, we first define a React.js Web Application Page, then define a root React component (like <code>&lt;APP /&gt;</code>), and then render the root React component into browser DOM.</li><li>JSX maps to calls to <code>React.createElement</code>.</li><li>A React component can be defined as a function, and the states are managed by hooks.</li><li>When I first type a url and hit enter, I send a http request to the server. Since this is the initial connect, the server responds a <code>index.html</code> file, which is the entry of the web application, as well as a <code>bundle.js</code> file, which is generated by Webpack (According to a configuration file <code>webpack.config.js</code>). Webpack takes all my project’s JavaScript, along with other assets (like CSS, images, or even other files), and bundles them into one or more output files that can be served to the browser. Then browser executes <code>bundle.js</code>. This is where the app’s frontend logic starts running.</li></ul><h2 id="Create-a-React-Application">Create a React Application</h2><h3 id="React-js-Web-Application-Page">React.js Web Application Page</h3><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CS142 Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;reactapp&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./webpackOutput/reactApp.bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><ul><li>the <code>div</code> element with the ID “reactapp”: serves as the “root” of the React application, where the entire React component tree will be rendered. Essentially, when the application runs, React will take control of this div and dynamically update the content within it based on the application’s state and logic.</li><li>bundle.js: The script tag is used to include the JavaScript file that contains the bundled React code. The file bundles all the React components, JavaScript, and other assets into a single file (or multiple files) for efficient loading and execution in the browser.</li><li>When the script is loaded, it uses the DOM API to render and update the view inside the <code>div</code> with ID reactapp.</li></ul><h3 id="Render-elements-into-browser-DOM">Render elements into browser DOM</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactAppView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/ReactAppView&#x27;</span>;<span class="hljs-keyword">let</span> viewTree = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">ReactAppView</span>, <span class="hljs-literal">null</span>);<span class="hljs-keyword">let</span> where = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;reactapp&#x27;</span>);<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(viewTree, where);</code></pre></div><ul><li>viewTree: creates an instance of the ReactAppView React component</li><li>where: the DOM element with the ID “reactapp”</li><li>ReactDOM.render: This is the key function that tells React to render the viewTree (which contains the ReactAppView component) into the where element, which is the div with the ID reactapp define in the previous React.js Web Application Page. This effectively “mounts” the React component into the browser’s DOM.</li></ul><h3 id="Define-ReactAppView-component">Define <code>ReactAppView</code> component</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactAppView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;    <span class="hljs-variable language_">super</span>(props);    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-attr">yourName</span>: <span class="hljs-string">&quot;&quot;</span> &#125;;    <span class="hljs-comment">// Binding handleChange method in the constructor</span>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleChange</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleChange</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);  &#125;  <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">event</span>) &#123;    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">yourName</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &#125;);  &#125;  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-keyword">let</span> label = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;label&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&#x27;Name: &#x27;</span>);    <span class="hljs-keyword">let</span> input = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;input&#x27;</span>, &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">yourName</span>, <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleChange</span>(event) &#125;);    <span class="hljs-keyword">let</span> h1 = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;h1&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&#x27;Hello &#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">yourName</span>, <span class="hljs-string">&#x27;!&#x27;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>, <span class="hljs-literal">null</span>, label, input, h1);  &#125;&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ReactAppView</span>;</code></pre></div><ul><li><p>constructor: initialize the component’s state or bind methods. In this case, this.state is an object that contains key-value pairs representing the component’s state.</p></li><li><p><code>render()</code>: The <code>render()</code> method is required for any React component. It defines what the component should output to the DOM. This method returns a React element or a tree of elements.</p></li><li><p><code>react.createElement()</code>: const element = createElement(type, props, …children).</p></li><li><p>type: HTML tag or React Component</p></li><li><p>props: attributes</p></li><li><p>children: can be String or numbers, React element, or an array of the above</p></li><li><p><code>this.setState</code> is a method provided by React’s Component class to change the state.</p></li><li><p>The above code renders the following HTML Structure:</p></li></ul><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Name: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">...</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello &#123;this.state.yourName&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>We can use JSX to concisely define the component output to the DOM instead of using <code>react.createElement()</code>:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;  <span class="hljs-variable language_">super</span>(props);  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-attr">yourName</span>: <span class="hljs-string">&quot;&quot;</span> &#125;;  <span class="hljs-comment">// Binding handleChange method in the constructor</span>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleChange</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleChange</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);&#125;<span class="hljs-title function_">handleChange</span>(<span class="hljs-params">event</span>) &#123;  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">yourName</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &#125;);&#125;<span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Name: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state.yourName&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;this.handleChange&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello &#123;this.state.yourName&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;</code></pre></div><ul><li>JSX maps to calls to <code>React.createElement</code>.</li><li>Writing in JavaScript HTML-like syntax that is converted to JavaScript function calls.</li><li>when <code>this.handleChange</code> is called from the event, the “this” keyword inside <code>handleChange</code> function might not refer to the component instance (ReactAppView), so “this” in <code>this.setState({ yourName: event.target.value })</code> of <code>handleChange</code> function might cause errors. As a result, we use <code>this.handleChange = this.handleChange.bind(this)</code>: binding the “this” context of handleChange to the component instance.</li></ul><p>We can use arrow functions (Arrow functions inherently bind this to the surrounding context at the time of their definition):</p><div class="code-wrapper"><pre><code class="hljs javascript">handleChange = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">yourName</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &#125;);&#125;</code></pre></div><ul><li>In this case, we can avoid bindding “this” in the constructor.</li><li>Everytime handleChange is called, the “this” keyword inside this function refers to the object of the class.</li></ul><p>A more concise component definition:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactAppView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;    <span class="hljs-variable language_">super</span>(props);    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-attr">yourName</span>: <span class="hljs-string">&quot;&quot;</span> &#125;;  &#125;  handleChange = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">yourName</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &#125;);  &#125;  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-keyword">return</span> (      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Name: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state.yourName&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;this.handleChange&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello &#123;this.state.yourName&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>    );  &#125;&#125;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ReactAppView</span>;</code></pre></div><h3 id="Stateless-Components-and-React-Hooks">Stateless Components and React Hooks</h3><p>A React component can be defined as a function if it only depends on props. Previously, we define React component by defining a class that extends <code>React.Component</code>.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params">props</span>) &#123;    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>My name is &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;&#125;</code></pre></div><p>Before hooks, functional components were “stateless.” With hooks like <code>useState</code>, we can now add state to these components.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">function</span> <span class="hljs-title function_">Example</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span><span class="language-xml">        Click me</span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;</code></pre></div><h2 id="React-js-Tool-Chain">React.js Tool Chain</h2><div style="text-align: center;"><img src="tool-chain.png" style="width: 80%; height: auto;" alt="Sample Image"></div><ul><li>Each React component is passed through Babel, a popular JavaScript compiler, which transpiles JSX and ES6+ into a version of JavaScript that is compatible with all browsers.</li><li>The transpiled components are then bundled together by Webpack.</li><li><code>bundle.js</code>: <strong>This bundled file is what actually gets loaded in the browser, and it contains everything your React application needs to run.</strong></li></ul><p>Webpack can bundle all of your project’s files (JavaScript, CSS, images, etc.) into a single file. It enables us to do like following:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// app.js</span><span class="hljs-keyword">import</span> &#123; add &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./math&#x27;</span>;<span class="hljs-keyword">import</span> &#123; logResult &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);<span class="hljs-title function_">logResult</span>(result);</code></pre></div><p>Now we only need to include one script in the HTML, otherwise, we need to manually include all script files.</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - DOM</title>
    <link href="/2024/08/06/CS142/dom/"/>
    <url>/2024/08/06/CS142/dom/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>The Document Object Model (DOM) is a programming interface provided by web browsers. It represents the structure of an HTML document in a way that JavaScript can interact with it. JavaScript can query or modify the HTML document. We can refer to the DOM by <code>document</code> variable.</p><h3 id="DOM-Hierarchy">DOM Hierarchy</h3><ul><li><p>When a web page is loaded, the browser parses the HTML document and creates a tree-like structure called the DOM tree. Each element in the HTML document becomes a node in this tree. For instance, a <code>&lt;div&gt;</code> tag, a piece of text, or an attribute like class are all nodes in the DOM.</p></li><li><p>DOM rooted at window.document</p></li><li><p>The DOM exposes these nodes as JavaScript objects, and each object provides methods and properties to interact with that part. This means that every part of the document can be accessed and manipulated using JavaScript.</p></li></ul><p>An example DOM:</p><div style="text-align: center;">  <img src="dom.png" style="width: 500px; height: auto;" alt="Sample Image"></div><h3 id="DOM-Node-Properties-and-Methods">DOM Node Properties and Methods</h3><p>The DOM provides a variety of methods (functions) and properties (attributes) to interact with the nodes: <a href="https://www.w3schools.com/jsref/dom_obj_document.asp">DOM tutorial</a></p><p>Example methods and properties:</p><ul><li><code>document.getElementById(&quot;myDiv&quot;)</code>: Finds an element with the specified ID.</li><li><code>element = document.createElement(&quot;P&quot;)</code>: Create a new element.</li><li><code>element.innerHTML = &quot;Hello, World!</code>: Changes the content inside an element.</li><li><code>element.setAttribute(&quot;class&quot;, &quot;newClass&quot;)</code>: Sets a new attribute or changes an existing one.</li><li><code>element.appendChild(newElement)</code>: Add a new child to element.</li></ul><p>Example:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>My Page<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDiv&quot;</span>&gt;</span>Hello, World!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><span class="language-javascript">        <span class="hljs-comment">// JavaScript to interact with the DOM</span></span><span class="language-javascript">        <span class="hljs-keyword">var</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;myDiv&quot;</span>);</span><span class="language-javascript">        element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;Hello, DOM!&quot;</span>;</span><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stanford CS142 笔记 - JavaScript</title>
    <link href="/2024/08/02/CS142/javascript/"/>
    <url>/2024/08/02/CS142/javascript/</url>
    
    <content type="html"><![CDATA[<h2 id="Functions">Functions</h2><h3 id="Arrow-Functions-and-Traditional-Functions">Arrow Functions and Traditional Functions</h3><h4 id="Traditional-Functions">Traditional Functions</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) &#123;    <span class="hljs-keyword">return</span> a + b;&#125;</code></pre></div><ul><li>hoisting<br>JavaScript moves the function declarations to the top of their scope before execution.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// Works fine, even though add is defined later</span><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) &#123;    <span class="hljs-keyword">return</span> a + b;&#125;</code></pre></div><ul><li>“this” keyword<br><strong>The value of “this” inside a traditional function depends on how the function is called</strong>.</li></ul><h4 id="Arrow-Functions">Arrow Functions</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b</span>) =&gt; &#123;    <span class="hljs-keyword">return</span> a + b;&#125;;</code></pre></div><ul><li>No hoisting</li><li>“this” keyword<br><strong>Arrow functions do not have their own “this” context. Instead, they inherit “this” from the surrounding scope where the arrow function is defined</strong>.</li></ul><h3 id="First-Class-Functions">First Class Functions</h3><ul><li>Functions are treated like variables in JavaScript</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;<span class="hljs-attr">count</span>: <span class="hljs-number">0</span>&#125;; obj.<span class="hljs-property">increment</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">amount</span>) &#123;     <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += amount;     <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>; &#125;obj.<span class="hljs-title function_">increment</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// returns 1 </span>obj.<span class="hljs-title function_">increment</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// returns 4</span></code></pre></div><p><code>this</code> refers to the object that the method was called on. In this case, it refers to <code>obj</code>.</p><ul><li>Functions can have properties</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">plus1</span>(<span class="hljs-params">value</span>) &#123;     <span class="hljs-keyword">if</span> (plus1.<span class="hljs-property">invocations</span> == <span class="hljs-literal">undefined</span>) &#123;         plus1.<span class="hljs-property">invocations</span> = <span class="hljs-number">0</span>;     &#125;     plus1.<span class="hljs-property">invocations</span>++;     <span class="hljs-keyword">return</span> value + <span class="hljs-number">1</span>; &#125;</code></pre></div><p><code>plus1.invocations</code> will be the number times function is called.</p><h3 id="Closures">Closures</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> globalVar = <span class="hljs-number">1</span>; <span class="hljs-keyword">function</span> <span class="hljs-title function_">localFunc</span>(<span class="hljs-params">argVar</span>) &#123;     <span class="hljs-keyword">let</span> localVar = <span class="hljs-number">0</span>;     <span class="hljs-keyword">function</span> <span class="hljs-title function_">embedFunc</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-keyword">return</span> ++localVar + argVar + globalVar;&#125;     <span class="hljs-keyword">return</span> embedFunc; &#125;<span class="hljs-keyword">let</span> myFunc = <span class="hljs-title function_">localFunc</span>(<span class="hljs-number">10</span>);</code></pre></div><ul><li>The <code>localFunc</code> returns the <code>embedFunc</code> function.</li><li><code>let myFunc = localFunc(10)</code>: This creates a new function <code>myFunc</code> by calling localFunc with 10 as the argument. <code>myFunc</code> now holds the reference to the <code>embedFunc</code> closure, with <code>localVar</code> initialized to 0 and <code>argVar</code> set to 10.</li><li>Each call <code>console.log(myFunc())</code> increases localVar by 1 and returns the updated sum.</li><li>Closures are an advanced programming concept in JavaScript that allow functions to retain access to variables from their lexical scope even after the outer function has finished executing. The <code>embedFunc</code> closure retains access to localVar, argVar, and globalVar even after <code>localFunc</code> has finished executing.</li><li>Using closures to encapsulate the state:</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> myModule = (<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  <span class="hljs-comment">// Private variables and functions</span>  <span class="hljs-keyword">var</span> privateVariable = <span class="hljs-string">&#x27;I am private&#x27;</span>;  <span class="hljs-keyword">function</span> <span class="hljs-title function_">privateFunction</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(privateVariable);  &#125;  <span class="hljs-comment">// Public API</span>  <span class="hljs-keyword">return</span> &#123;    <span class="hljs-attr">publicMethod</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;        <span class="hljs-title function_">privateFunction</span>();    &#125;,    <span class="hljs-attr">publicProperty</span>: <span class="hljs-string">&#x27;I am public&#x27;</span>  &#125;;&#125;)();myModule.<span class="hljs-title function_">publicMethod</span>();</code></pre></div><ul><li>The function is defined and immediately invoked, creating a new scope. <code>var myModule = (function () {do something})();</code></li><li>myModule is not a function, but the return value of the function, which is an object.</li><li>An IIFE (Immediately Invoked Function Expression) is a function that is executed right after it is defined. <code>myModule</code> is the return value of IIFE.</li></ul><h2 id="“this”-keyword">“this” keyword</h2><p>In JavaScript, <code>this</code> is a keyword that refers to an object. <strong>However, the exact object that this refers to depends on how a function is called.</strong></p><ul><li>Global Context</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// outside of any function</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// In a browser, this will log the window object</span></code></pre></div><p>In browsers, the global object is <code>window</code>.</p><ul><li>Function Context</li></ul><p>When a function is called as a method of an object, this refers to the object that the method is called on.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> obj = &#123;  <span class="hljs-attr">value</span>: <span class="hljs-number">42</span>,  <span class="hljs-attr">getValue</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;  &#125;&#125;;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-title function_">getValue</span>()); <span class="hljs-comment">// 42</span></code></pre></div><ul><li>Constructor Functions</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;&#125;<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// Alice</span></code></pre></div><p><code>this</code> inside <code>Person</code> refers to the new object being created.<br>The <code>new</code> Keyword creates a new object, sets <code>this</code> to that object inside the constructor function, and returns the object.</p><h3 id="Binding">Binding</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);&#125;</code></pre></div><p>The value of <code>this</code> inside the function is not determined at the time the function is defined. Instead, it is determined at the time the function is called.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> person = &#123;  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>,  <span class="hljs-attr">greet</span>: greet&#125;;person.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// `this` refers to `person`, so it logs `Hello, Alice`</span></code></pre></div><ul><li>We can explicitly set <code>this</code>:</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);&#125;<span class="hljs-keyword">const</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span> &#125;;greet.<span class="hljs-title function_">call</span>(person); <span class="hljs-comment">// Hello, Alice</span><span class="hljs-keyword">const</span> greetPerson = greet.<span class="hljs-title function_">bind</span>(person);<span class="hljs-title function_">greetPerson</span>(); <span class="hljs-comment">// Hello, Alice</span></code></pre></div><ul><li><code>.call()</code>: Calls a function with a given <code>this</code> value.</li><li><code>.bind()</code>: Creates a new function that, when called, has its <code>this</code> keyword set to the provided value.</li></ul>]]></content>
    
    
    <categories>
      
      <category>CS142</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - React State Management</title>
    <link href="/2024/07/29/MIT_Weblab/React-State-Management/"/>
    <url>/2024/07/29/MIT_Weblab/React-State-Management/</url>
    
    <content type="html"><![CDATA[<h2 id="React-Context">React Context</h2><p>Previously, we pass state and setState as props through components to allow child component to update states of parent. If the component that needs the state is deep in the tree, this is a problem called “prop drilling”, where props are passed through many intermediate components.</p><p>The <code>useState</code> hook is commonly used to manage local component state. By combining it with Context, we can create a shared state accessible by any component in the tree. It’s particularly useful for global states, such as user authentication status, themes, or other application-wide settings.</p><ol><li>Create a Context</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; createContext, useState, useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title function_">createContext</span>();</code></pre></div><ol start="2"><li>Create a Provider: Can use context MyContext in any descendant of <code>MyContext.Provider</code>.</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyProvider</span> = (<span class="hljs-params">&#123; children &#125;</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialState);  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">setState</span> &#125;&#125;&gt;</span></span><span class="language-xml">      &#123;children&#125;</span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span>  );&#125;;</code></pre></div><ol start="3"><li>Wrap Your Application: Make <code>MyComponent</code> a descendent of <code>MyProvider</code>, so <code>MyComponent</code> can use the context.</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyProvider</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">MyProvider</span>&gt;</span></span>  );&#125;;</code></pre></div><ol start="4"><li>Consume the Context: use <code>const { state, setState } = useContext(MyContext)</code> to extract the value provided by <code>MyContext.Provider</code>.</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">const</span> &#123; state, setState &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params"></span>) =&gt; &#123;    <span class="hljs-title function_">setState</span>(newState);  &#125;;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;state.someValue&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleChange&#125;</span>&gt;</span>Change State<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;</code></pre></div><h2 id="Reducers">Reducers</h2><p>Reducers provide a structured way to manage state transitions, especially for complex state logic or multiple state updates based on different actions.</p><ul><li><code>const [state, dispatch] = useReducer(reducer, initialState)</code></li><li>Redcer: A function that specifies how the state should be updated based on the action. <code>Reducer: f(state, action) -&gt; newState</code>. The reducer function takes the current state and an action as arguments and returns a new state. The reducer returns a new state object.</li><li>Dispatch: Use the <code>dispatch</code> function to trigger state transitions based on actions.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">const</span> initialState = &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;;<span class="hljs-keyword">function</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">state, action</span>) &#123;  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;increment&#x27;</span>:      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;;    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;decrement&#x27;</span>:      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> &#125;;    <span class="hljs-attr">default</span>:      <span class="hljs-keyword">return</span> state;  &#125;&#125;<span class="hljs-keyword">const</span> <span class="hljs-title function_">Counter</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState);  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: &#123;state.count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;increment&#x27; &#125;)&#125;&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;decrement&#x27; &#125;)&#125;&gt;Decrement<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Counter</span>;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - Typescript</title>
    <link href="/2024/07/24/MIT_Weblab/typescript/"/>
    <url>/2024/07/24/MIT_Weblab/typescript/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>TypeScript is a popular programming language that extends JavaScript by adding static types. Typescript catches errors at compile time rather than at runtime, making the code more reliable and easier to debug.</p><h2 id="Syntax">Syntax</h2><h3 id="Primitive-Data-Types">Primitive Data Types</h3><ul><li>number</li><li>boolean</li><li>string</li><li>object</li><li>undefined</li><li>null</li></ul><h3 id="Declare-a-Type-For-a-Variable">Declare a Type For a Variable</h3><p>Define types of a variable using <code>:</code>.</p><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">&quot;John&quot;</span>;<span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">30</span>;<span class="hljs-keyword">let</span> <span class="hljs-attr">isStudent</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;<span class="hljs-keyword">let</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>];<span class="hljs-keyword">let</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>];</code></pre></div><h3 id="Define-a-Type">Define a Type</h3><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Color</span> = <span class="hljs-string">&quot;Red&quot;</span> | <span class="hljs-string">&quot;Green&quot;</span> | <span class="hljs-string">&quot;Blue&quot;</span>;<span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-string">&quot;Red&quot;</span>; <span class="hljs-comment">// can only be one of three colors</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> myType = &#123;    <span class="hljs-attr">myProperty</span>: <span class="hljs-built_in">string</span>;&#125;;<span class="hljs-keyword">const</span> <span class="hljs-attr">newVariable</span>: myType = &#123;<span class="hljs-attr">myProperty</span>: <span class="hljs-string">&quot;xxx&quot;</span>&#125;;</code></pre></div><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = &#123;    <span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>;    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;    <span class="hljs-attr">is_admin</span>?: <span class="hljs-built_in">boolean</span>;&#125;;<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = &#123;    <span class="hljs-attr">_id</span>: <span class="hljs-string">&quot;555&quot;</span>;    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Eric&quot;</span>;&#125;;<span class="hljs-keyword">export</span> &#123;<span class="hljs-title class_">User</span>&#125;</code></pre></div><ul><li>Denote optional params with ?</li></ul><h3 id="Typed-Functions">Typed Functions</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getComments</span> = (<span class="hljs-params">id</span>) =&gt; &#123;    <span class="hljs-keyword">return</span> [];&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> getComments = (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Comment</span>[] =&gt; &#123;    <span class="hljs-keyword">return</span> [];&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-comment">// add type for a function</span><span class="hljs-keyword">type</span> <span class="hljs-title class_">CommentProps</span> = &#123;    <span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>;    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;    <span class="hljs-attr">handleAdd</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>Typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - Sockets</title>
    <link href="/2024/07/21/MIT_Weblab/socket/"/>
    <url>/2024/07/21/MIT_Weblab/socket/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Steps for a http request:</p><ul><li>Client sends request to Server</li><li>Server responds to client</li></ul><p>If we want to achieve a live chat function, where</p><ul><li>A user sends a message</li><li>All users can see the updates message immediately without refreshing the page</li></ul><p>However, server cannot send a message without a request. Sockets can solve this!</p><h2 id="Sockets">Sockets</h2><h3 id="Syntax">Syntax</h3><ul><li>Broadcast a message from server to everyone connected:</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">socketManager.<span class="hljs-property">getIo</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;event_name&quot;</span>, data); <span class="hljs-comment">// shout</span></code></pre></div><ul><li>Broadcast a message to a specific client:</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">socketManager.<span class="hljs-title function_">getSocketFromUserID</span>(userID).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;eventName&quot;</span>, data); <span class="hljs-comment">// whisper</span></code></pre></div><ul><li>Listen for messages on client:</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;event_name&quot;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;    <span class="hljs-comment">// do something with data</span>&#125;);</code></pre></div><ul><li>The <code>socketManager</code> class is defined for demonstration, in real life, please define by yourself.</li></ul><h3 id="Usage">Usage</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Frontend:</span><span class="hljs-keyword">const</span> <span class="hljs-title function_">Chatbook</span> = (<span class="hljs-params">props</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> [activeChat, setActiveChat] = <span class="hljs-title function_">useState</span>(&#123;    <span class="hljs-attr">recipient</span>: <span class="hljs-variable constant_">ALL_CHAT</span>,    <span class="hljs-attr">messages</span>: [],  &#125;);  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addMessages</span> = (<span class="hljs-params">data</span>) =&gt; &#123;    <span class="hljs-title function_">setActiveChat</span>(<span class="hljs-function"><span class="hljs-params">prevActiveChat</span> =&gt;</span> (&#123;      <span class="hljs-attr">recipient</span>: prevActiveChat.<span class="hljs-property">recipient</span>,      <span class="hljs-attr">messages</span>: prevActiveChat.<span class="hljs-property">messages</span>.<span class="hljs-title function_">concat</span>(data),    &#125;));  &#125;;  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;    socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;message&quot;</span>, addMessages);    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;      socket.<span class="hljs-title function_">off</span>(<span class="hljs-string">&quot;message&quot;</span>, addMessages);    &#125;;  &#125;, []);&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Backend:</span>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/message&quot;</span>, auth.<span class="hljs-property">ensureLoggedIn</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Received a chat message from <span class="hljs-subst">$&#123;req.user.name&#125;</span>: <span class="hljs-subst">$&#123;req.body.content&#125;</span>`</span>);  <span class="hljs-comment">// insert this message into the database</span>  <span class="hljs-keyword">const</span> message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(&#123;    <span class="hljs-attr">recipient</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">recipient</span>,    <span class="hljs-attr">sender</span>: &#123;      <span class="hljs-attr">_id</span>: req.<span class="hljs-property">user</span>.<span class="hljs-property">_id</span>,      <span class="hljs-attr">name</span>: req.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>,    &#125;,    <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">content</span>,  &#125;);  message.<span class="hljs-title function_">save</span>();  socketManager.<span class="hljs-title function_">getIo</span>().<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;message&quot;</span>, message);&#125;);</code></pre></div><p>What happens in the code:</p><ol><li>When the Chatbook component mounts, it sets up a socket listener for the “message” event using <code>useEffect</code>. <code>socket.on(&quot;message&quot;, addMessages)</code> adds <strong>a listener that calls addMessages whenever a new message is received</strong>. When the component unmounts, it calls the return statemnet: <code>socket.off(&quot;message&quot;, addMessages)</code>, which cleans up the event listener.</li><li>A user sends a POST request to the <code>/message</code> endpoint with the chat message content and recipient information.</li><li>The backend creates a new message and saves it to the database.</li><li><code>socketManager.getIo().emit(&quot;message&quot;, message)</code>: The message is emitted to all connected clients using <a href="http://Socket.io">Socket.io</a>, with data “message”.</li><li><code>socket.on(&quot;message&quot;, addMessages)</code> listener calls the addMessages function with “message” as parameter, updating the existing messages.</li></ol><ul><li>setActiveChat here can also accept a function as an argument. This function receives the previous state <code>prevActiveChat</code> as its argument.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>sockets</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - Authentication</title>
    <link href="/2024/07/18/MIT_Weblab/account/"/>
    <url>/2024/07/18/MIT_Weblab/account/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>Setting up account and authentication involves achieving two goals:</p><ul><li>Initial login</li><li>Staying login when making requests or refreshing pages</li></ul><h3 id="Initial-Login">Initial Login</h3><p>User send username and password to the server, however, it’s not safe to directly pass them as JSON. Using Google Authentication can help us manage the account.</p><h3 id="Session">Session</h3><ul><li>When a user logs in, the server creates a session and assigns a unique session ID to the user.</li><li>The session ID is stored on the client-side in a cookie, while the actual session data corresponding to the session ID is stored on the server</li><li>On each subsequent request, the server uses the session ID from the cookie to retrieve the session data and identify the user.</li></ul><h3 id="JWT-Json-Web-Token">JWT (Json Web Token)</h3><p>JWTs do not require server-side storage of session data.</p><ul><li>When a user logs in, the server generates a JWT containing the user’s information and sends it to the client.</li><li>Browser puts JWT in local storage. The client includes the JWT for subsequent requests.</li><li>The server verifies the token’s signature to authenticate the user.</li></ul><h2 id="How-to-Manage-Login">How to Manage Login?</h2><div style="text-align: center;">  <img src="workflow.png" style="width: 500px; height: auto;" alt="Login Workflow"></div><h3 id="Login-Frontend">Login (Frontend)</h3><p>At Frontend:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">GoogleLogin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-google-login&quot;</span>;<span class="hljs-comment">// This identifies your web application to Google&#x27;s authentication service</span><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">GOOGLE_CLIENT_ID</span> = <span class="hljs-string">&quot;your-google-client-id&quot;</span>;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">GoogleLogin</span></span></span><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">clientId</span>=<span class="hljs-string">&#123;GOOGLE_CLIENT_ID&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">buttonText</span>=<span class="hljs-string">&quot;Login&quot;</span></span></span><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">onSuccess</span>=<span class="hljs-string">&#123;handleLogin&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">onFailure</span>=<span class="hljs-string">&#123;(err)</span> =&gt;</span> console.log(err)&#125;</span><span class="language-xml">  className=&quot;NavBar-link NavBar-login&quot;</span><span class="language-xml">/&gt;</span><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = (<span class="hljs-params">res</span>) =&gt; &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);  <span class="hljs-title function_">setLoggedIn</span>(<span class="hljs-literal">true</span>);  <span class="hljs-keyword">const</span> userToken = res.<span class="hljs-property">tokenObj</span>.<span class="hljs-property">id_token</span>;  <span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123; <span class="hljs-attr">token</span>: userToken &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user);  &#125;);&#125;;</code></pre></div><ul><li>When user clicks the login button, it triggers google login process. (GoogleLogin component from the react-google-login package).</li><li><code>onSuccess={handleLogin}</code>: Triggers handleLogin function when loggin in successgully, passing response from google as the parameter.</li></ul><div style="text-align: center;"><img src="response.png" style="width: 600px; height: auto;" alt="Google Response Object"></div><ul><li>Inside <code>handleLogin</code>, It extracts the id_token from the response by <code>userToken = res.tokenObj.id_token</code> and sends it to the server via a POST request to the <code>/api/login</code> endpoint.</li></ul><h3 id="Login-Backend">Login (Backend)</h3><p>Define user schema for MongoDB:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// User.js</span><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,  <span class="hljs-attr">googleid</span>: <span class="hljs-title class_">String</span>,&#125;);<span class="hljs-comment">// compile model from schema</span><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-title class_">UserSchema</span>);</code></pre></div><p>The frontend passes the userToken to backend through post request.<br>Handling <code>/api/login</code> Post request by calling <code>login</code> function in the following:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">OAuth2Client</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;google-auth-library&quot;</span>);<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./models/user&quot;</span>); <span class="hljs-comment">// Import User model</span><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CLIENT_ID</span> = <span class="hljs-string">&quot;your-google-client-id&quot;</span>;<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OAuth2Client</span>(<span class="hljs-variable constant_">CLIENT_ID</span>);<span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">req, res</span>) &#123;  <span class="hljs-title function_">verify</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">token</span>)    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">getOrCreateUser</span>(user))    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> &#123;      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Logged in as <span class="hljs-subst">$&#123;user.name&#125;</span>`</span>);      <span class="hljs-comment">// persist user in the session</span>      req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span> = user;      res.<span class="hljs-title function_">send</span>(user);    &#125;)    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Failed to log in: <span class="hljs-subst">$&#123;err&#125;</span>`</span>);      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">send</span>(&#123; err &#125;);    &#125;);&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">token</span>) &#123;  <span class="hljs-keyword">return</span> client    .<span class="hljs-title function_">verifyIdToken</span>(&#123;      <span class="hljs-attr">idToken</span>: token,      <span class="hljs-attr">audience</span>: <span class="hljs-variable constant_">CLIENT_ID</span>,    &#125;)    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">ticket</span>) =&gt;</span> ticket.<span class="hljs-title function_">getPayload</span>());&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">getOrCreateUser</span>(<span class="hljs-params">user</span>) &#123;  <span class="hljs-comment">// the &quot;sub&quot; field means &quot;subject&quot;, which is a unique identifier for each user</span>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>(&#123; <span class="hljs-attr">googleid</span>: user.<span class="hljs-property">sub</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">existingUser</span>) =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (existingUser) <span class="hljs-keyword">return</span> existingUser;    <span class="hljs-keyword">const</span> newUser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123;      <span class="hljs-attr">name</span>: user.<span class="hljs-property">name</span>,      <span class="hljs-attr">googleid</span>: user.<span class="hljs-property">sub</span>,    &#125;);    <span class="hljs-keyword">return</span> newUser.<span class="hljs-title function_">save</span>();  &#125;);&#125;</code></pre></div><ul><li>The <code>login</code> function calls the <code>verify</code> function to validate the token with Google.</li><li>The <code>login</code> function then calls <code>getOrCreateUser</code>. This function checks if the user already exists in the database using the googleid. If the user exists, it returns the existing user; if not, it creates a new user in the database.</li><li>Then, the login function stores the user information in the session by <code>req.session.user = user</code>.</li><li>sends the user data back to the client.</li></ul><h3 id="req-session-and-authenticating-following-requests">req.session and authenticating following requests</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// In server.js</span><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-session&quot;</span>);app.<span class="hljs-title function_">use</span>(  <span class="hljs-title function_">session</span>(&#123;    <span class="hljs-attr">secret</span>: <span class="hljs-string">&quot;session-secret&quot;</span>,    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,  &#125;));<span class="hljs-keyword">const</span> auth = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./auth&#x27;</span>);app.<span class="hljs-title function_">use</span>(auth.<span class="hljs-property">populateCurrentUser</span>);<span class="hljs-comment">// In auth.js</span><span class="hljs-keyword">function</span> <span class="hljs-title function_">populateCurrentUser</span>(<span class="hljs-params">req, res, next</span>) &#123;  req.<span class="hljs-property">user</span> = req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>;  <span class="hljs-title function_">next</span>();&#125;</code></pre></div><ul><li><p><code>app.use(session({...}))</code>:</p></li><li><p>This middleware sets up and manages sessions in an Express application.</p></li><li><p>It uses a server-side storage mechanism to store session data.</p></li><li><p>It creates a session ID, which is stored in a cookie on the client side.</p></li><li><p>Previously, we do <code>req.session.user = user</code>, the following happens:</p></li><li><p>The <code>express-session</code> middleware stores the user object in the session data associated with the current session on server side.</p></li><li><p>The session middleware ensures that a cookie containing the <code>session ID</code> is sent to the client’s browser.</p></li><li><p>For every subsequent request, the browser automatically includes the session ID cookie in the request headers. <strong>The session middleware parses the session ID from the client’s cookie, retrieves the session data, and attaches it to req.session</strong>. As a result, req.session is automatically filled by the <code>user</code> document that we previously stored in session.</p></li><li><p><code>populateCurrentUser</code> middleware: The populateCurrentUser middleware sets req.user to the user data from req.session.user for each following request.</p></li></ul><h3 id="Stay-Logged-In-At-Frontend">Stay Logged In At Frontend</h3><p>Now, since the session ID is in my browser’s cookie, everytime I make a request, <strong>as long as the cookies exist, my <code>req.user</code> will be set as the user that I previously logged in</strong>.<br>To let frontend know that I am currently logged in, we can send a get request to backend, then backend checks <code>req.user</code> and sends back.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// At Frontend:</span><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;    <span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/whoami&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> &#123;      <span class="hljs-keyword">if</span> (user.<span class="hljs-property">_id</span>) &#123;        <span class="hljs-title function_">setLoggedIn</span>(<span class="hljs-literal">true</span>);      &#125;    &#125;)&#125;, []);<span class="hljs-comment">// At Backend:</span>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/whoami&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">user</span>) &#123;    res.<span class="hljs-title function_">send</span>(req.<span class="hljs-property">user</span>);  &#125; <span class="hljs-keyword">else</span> &#123;    res.<span class="hljs-title function_">send</span>(&#123;&#125;);  &#125;&#125;);</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>JWT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dynamic Programming</title>
    <link href="/2024/07/15/Leetcode/dp/"/>
    <url>/2024/07/15/Leetcode/dp/</url>
    
    <content type="html"><![CDATA[<h2 id="DP-and-Backtracking">DP and Backtracking</h2><p>Many DP problems can be also solved by backtracking algorithm.</p><h3 id="LC-416">LC 416</h3><p>Given an integer array nums, return true if you can partition the array into two subsets such that the sum of the elements in both subsets is equal or false otherwise.</p><ul><li>Solution using backtracking (recursion):</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canPartition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> backtrack(nums, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);        <span class="hljs-keyword">return</span> result;    &#125;    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">backtrack</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> index, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> &#123;        <span class="hljs-keyword">if</span> (index == nums.length &amp;&amp; left == right) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (index == nums.length) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;        <span class="hljs-type">boolean</span> <span class="hljs-variable">includeLeft</span> <span class="hljs-operator">=</span> backtrack(nums, index+<span class="hljs-number">1</span>, left+nums[index], right);        <span class="hljs-type">boolean</span> <span class="hljs-variable">includeRight</span> <span class="hljs-operator">=</span> backtrack(nums, index+<span class="hljs-number">1</span>, left, right+nums[index]);        <span class="hljs-keyword">return</span> includeLeft || includeRight;    &#125;&#125;</code></pre></div><ul><li>Idea: Our goal is to partition the array into two subsets, naming them “left” and “right” respectively. For each number in the array, it is either in the “left” subset or “right” subset. We explore all possibilities using recursion.</li><li>Complexity: <code>O(2^n)</code>. Thinking about a tree, each node is a backtrack function. The tree is of depth <code>n</code>, each node takes <code>O(1)</code> time.</li><li>Solution using dynamic programming:</li></ul><p>Transform the solution to knapsack problem: achieve <code>sum/2</code> using elements in an array.</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canPartition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;            sum += num;        &#125;        <span class="hljs-keyword">if</span> (sum % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> sum / <span class="hljs-number">2</span>;        <span class="hljs-type">boolean</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[target+<span class="hljs-number">1</span>];        dp[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;        <span class="hljs-keyword">if</span> (nums[<span class="hljs-number">0</span>] &lt; target) &#123;            dp[nums[<span class="hljs-number">0</span>]] = <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; nums.length; i++) &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> target; j &gt;= nums[i]; j--) &#123;                dp[j] = dp[j] || dp[j-nums[i]];            &#125;        &#125;        <span class="hljs-keyword">return</span> dp[target];    &#125;&#125;</code></pre></div><ul><li><code>dp[i][j]</code> is boolean, representing whether summation j can be achieved using indexes 0, 1, …, i.</li><li>If <code>nums[i]</code> is used to achieve the summation j, then <code>dp[i-1][j-nums[i]]</code> must be true. If <code>nums[i]</code> is not used to achieve the summation, then <code>dp[i-1][j]</code> must be true.</li><li>Complexity: <code>O(nW)</code>, where n is array size, W is array summation.</li></ul><h2 id="Optimize-Space-Complexity">Optimize Space Complexity</h2><h3 id="Knapsack-Problem">Knapsack Problem</h3><p>Given bag space N, what is the most valuable way to put items in the bag? One Item can be used only once.</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 2D array</span><span class="hljs-comment">// DP[i][j]: most valuable combination of items for space j using items 0-i.</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">solve</span><span class="hljs-params">(<span class="hljs-type">int</span> M, <span class="hljs-type">int</span> N, <span class="hljs-type">int</span>[] spaces, <span class="hljs-type">int</span>[] values)</span> &#123;    <span class="hljs-type">int</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[M+<span class="hljs-number">1</span>][N+<span class="hljs-number">1</span>];    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> spaces[<span class="hljs-number">0</span>]; j &lt;= N; j++) &#123;        dp[<span class="hljs-number">0</span>][j] = values[<span class="hljs-number">0</span>];    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= M; i++) &#123;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= N; j++) &#123;            <span class="hljs-keyword">if</span> (j &gt;= spaces[i-<span class="hljs-number">1</span>]) &#123;                dp[i][j] = Math.max(dp[i-<span class="hljs-number">1</span>][j], dp[i-<span class="hljs-number">1</span>][j-spaces[i-<span class="hljs-number">1</span>]] + values[i-<span class="hljs-number">1</span>]);            &#125; <span class="hljs-keyword">else</span> &#123;                dp[i][j] = dp[i-<span class="hljs-number">1</span>][j];            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> dp[M][N];&#125;</code></pre></div><p>Use 1D array to solve this:</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">solve</span><span class="hljs-params">(<span class="hljs-type">int</span> M, <span class="hljs-type">int</span> N, <span class="hljs-type">int</span>[] spaces, <span class="hljs-type">int</span>[] values)</span> &#123;    <span class="hljs-type">int</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N+<span class="hljs-number">1</span>];            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> spaces[<span class="hljs-number">0</span>]; i &lt; N+<span class="hljs-number">1</span>; i++) &#123;        dp[i] = values[<span class="hljs-number">0</span>];    &#125;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; M; i++) &#123;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> N; j &gt;= <span class="hljs-number">1</span>; j--) &#123; <span class="hljs-comment">// iterate from N to 1!</span>            <span class="hljs-keyword">if</span> (j &gt;= spaces[i]) &#123;                <span class="hljs-type">int</span> <span class="hljs-variable">takei</span> <span class="hljs-operator">=</span> dp[j-spaces[i]] + values[i];                <span class="hljs-type">int</span> <span class="hljs-variable">dtakei</span> <span class="hljs-operator">=</span> dp[j];                dp[j] = Math.max(takei, dtakei);            &#125; <span class="hljs-keyword">else</span> &#123;                dp[j] = dp[j];            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> dp[N];&#125;</code></pre></div><ul><li>In 2D case, each row depends on the values from previous row.</li><li><code>dp[i][j]</code> depends on <code>dp[i-1][j]</code> and <code>dp[i-1][j-spaces[i-1]]</code>, i.e., one top value, one top-left value.</li><li>As a result, in 1D case, update the <code>dp</code> array from right to left.</li></ul><h3 id="When-to-update-from-left-to-right-LC-518">When to update from left to right? (LC 518)</h3><p>You are given an integer array coins representing coins of different denominations and an integer amount representing a total amount of money.</p><p>Return the number of combinations that make up that amount. If that amount of money cannot be made up by any combination of the coins, return 0.</p><p>You may assume that you have an infinite number of each kind of coin.</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">change</span><span class="hljs-params">(<span class="hljs-type">int</span> amount, <span class="hljs-type">int</span>[] coins)</span> &#123;        <span class="hljs-type">int</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[coins.length][amount+<span class="hljs-number">1</span>];        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; coins.length; i++)&#123;            dp[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> coins[<span class="hljs-number">0</span>]; j &lt;= amount; j++)&#123;            dp[<span class="hljs-number">0</span>][j] += dp[<span class="hljs-number">0</span>][j-coins[<span class="hljs-number">0</span>]];        &#125;                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; coins.length; i++)&#123;            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= amount; j++)&#123;                <span class="hljs-keyword">if</span>(j &lt; coins[i]) dp[i][j] = dp[i-<span class="hljs-number">1</span>][j];                <span class="hljs-keyword">else</span> dp[i][j] = dp[i][j-coins[i]] + dp[i-<span class="hljs-number">1</span>][j];            &#125;        &#125;        <span class="hljs-keyword">return</span> dp[coins.length-<span class="hljs-number">1</span>][amount];    &#125;&#125;</code></pre></div><ul><li>Updation: <code>dp[i][j] = dp[i][j-coins[i]] + dp[i-1][j]</code>, which depends on both <code>previous row</code> and <code>current row but previous column</code>.</li></ul><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// solution using 1D array</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">change</span><span class="hljs-params">(<span class="hljs-type">int</span> amount, <span class="hljs-type">int</span>[] coins)</span> &#123;        <span class="hljs-type">int</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[amount+<span class="hljs-number">1</span>];        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; amount+<span class="hljs-number">1</span>; i++) &#123;            <span class="hljs-keyword">if</span> (i % coins[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>) dp[i] = <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; coins.length; i++) &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> coins[i]; j &lt;= amount; j++) &#123;                dp[j] += dp[j-coins[i]];            &#125;        &#125;        <span class="hljs-keyword">return</span> dp[amount];    &#125;&#125;</code></pre></div><ul><li>At iteration i, dp[j] is the number of combinations that make up amount j, using coins with indexes 0-i.</li><li>Because solution using 2D array uses <code>dp[i][j] = dp[i][j-coins[i]] + dp[i-1][j]</code>, so in 1D array, we update from left to right so that <code>dp[j]</code> uses the <code>dp[j-coins[i]]</code> from the same row.</li></ul>]]></content>
    
    
    <categories>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
      <tag>Dynamic Programming</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - MongoDB</title>
    <link href="/2024/07/15/MIT_Weblab/mongodb/"/>
    <url>/2024/07/15/MIT_Weblab/mongodb/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><h3 id="Why-Use-Databse-in-Web-Development">Why Use Databse in Web Development?</h3><ol><li>Store data persistently</li><li>Fast read and write speed</li><li>Concurrency issues</li><li>Data security</li></ol><h3 id="Relational-Database-SQL-and-Document-Database-NoSQL">Relational Database (SQL) and Document Database (NoSQL)</h3><p>Databases are generally categorized into two types: Relational Databases (SQL) and Document Databases (NoSQL).</p><ul><li>Relational Database: Store data in tables. e.g., MySQL, PostgreSQL.</li><li>Document Database: Store data as documents (like JSON objects). e.g. MongoDB</li></ul><h3 id="Interact-with-Database">Interact with Database</h3><ul><li><p>Get</p>  <div style="text-align: left;">    <img src="relation1.png" style="width: 500px; height: auto;" alt="Get Request Diagram">  </div></li><li><p>Post</p>  <div style="text-align: left;">    <img src="relation2.png" style="width: 500px; height: auto;" alt="Post Request Diagram">  </div></li></ul><h2 id="MongoDB">MongoDB</h2><h3 id="Core-Concepts">Core Concepts</h3><ul><li>Database: A container for collections.</li><li>Collection: A group of MongoDB documents, akin to a table in SQL.</li><li>Document: A record in a collection, stored in Binary JSON format, allowing nested structures and arrays, like a row in a table.</li><li>Field: A key-value pair within a document.</li><li>ObjectId: The default primary key for a MongoDB document (_id field), automatically generated.</li></ul><h3 id="Connect-to-MongoDB">Connect to MongoDB</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// server.js</span><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>); <span class="hljs-comment">// import mongoose</span><span class="hljs-keyword">const</span> mongoConnectionURL = <span class="hljs-string">&quot;mongodb+srv://USERNAME:PASSWORD@DB.mongodb.net/test?retryWrites=true&quot;</span>;<span class="hljs-keyword">const</span> databaseName = <span class="hljs-string">&quot;someDatabaseName&quot;</span>;<span class="hljs-keyword">const</span> options = &#123;  <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span>,  <span class="hljs-attr">useUnifiedTopology</span>: <span class="hljs-literal">true</span>,  <span class="hljs-attr">dbName</span>: databaseName,&#125;;mongoose.<span class="hljs-title function_">connect</span>(mongoConnectionURL, options)  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Connected.&quot;</span>))  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Error connecting to MongoDB: <span class="hljs-subst">$&#123;error&#125;</span>`</span>));</code></pre></div><ul><li>mongoose: A NodeJS library that allows MongoDB integration</li></ul><h3 id="Schemas-and-Models">Schemas and Models</h3><ul><li>Schemas define the structure of your documents</li><li>Define the keys and types of the values corresponding to the keys</li><li>Schema Types: String, Number, Date, Buffer, Boolean, Mixed, ObjectId, Array</li><li>Models is responsible for creating and reading documents from the database</li></ul><p>Example:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);<span class="hljs-keyword">const</span> <span class="hljs-title class_">StudentSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>,  <span class="hljs-attr">classes</span>: [<span class="hljs-title class_">String</span>], <span class="hljs-comment">// the type of the elements inside an array should also be specified</span>&#125;);<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&quot;ModelName&quot;</span>, <span class="hljs-title class_">StudentSchema</span>);</code></pre></div><ul><li>Usually Define one Schema and Model per file, and export the model</li></ul><h3 id="Find-Document">Find Document</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// In backend:</span><span class="hljs-keyword">const</span> <span class="hljs-title class_">Story</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./models/story&quot;</span>); <span class="hljs-comment">// import the model</span><span class="hljs-keyword">const</span> emptyQuery = &#123;&#125;; <span class="hljs-comment">// empty query: return all documents</span><span class="hljs-keyword">const</span> query = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Tim&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span> &#125;; <span class="hljs-comment">// return all documents with name Tim and age 21</span>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/stories&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-title class_">Story</span>.<span class="hljs-title function_">find</span>(emptyQuery).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">allStories</span>) =&gt;</span> &#123;    <span class="hljs-comment">// return an array of documents</span>    res.<span class="hljs-title function_">send</span>(allStories);  &#125;)&#125;);router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/comment&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-title class_">Comment</span>.<span class="hljs-title function_">find</span>(&#123; <span class="hljs-attr">parent</span>: req.<span class="hljs-property">query</span>.<span class="hljs-property">parent</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">comments</span>) =&gt;</span> &#123;    res.<span class="hljs-title function_">send</span>(comments);  &#125;);&#125;);</code></pre></div><ul><li><code>find(query)</code> returns an array.</li><li><code>findOne(query)</code>: returns only one document that matches the query.</li><li><code>someModel.find()</code> retuens a promise, which is the finding result, and we can use <code>.then()</code> to handle it.</li></ul><h3 id="Save-Document">Save Document</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// In backend:</span><span class="hljs-keyword">const</span> <span class="hljs-title class_">Comment</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./models/comment&quot;</span>);router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/comment&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-keyword">const</span> newComment = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comment</span>(&#123;    <span class="hljs-attr">creator_name</span>: myName,    <span class="hljs-attr">parent</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">parent</span>,    <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">content</span>,  &#125;);  newComment.<span class="hljs-title function_">save</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">comment</span>) =&gt;</span> res.<span class="hljs-title function_">send</span>(comment));&#125;);</code></pre></div><ul><li>We can create a new document by <code>const newDocument = new ModelName({parameters})</code>.</li><li><code>newDocument.save()</code> returns a promise. This promise resolves to the document that was saved to the database.</li><li>Every document is automatically assigned a unique identifier, the identifier is assigned under the “_id” field. How to utilize “_id”?</li><li>At Frontend, get document get queries.</li><li>Backend calls <code>find()</code> and send the result to frontend.</li><li>Frontend retrieves and passes the “_id” of one object (one document in database) by</li></ul><div class="code-wrapper"><pre><code class="hljs javascript">&lt;<span class="hljs-title class_">Card</span>  key=&#123;<span class="hljs-string">`Card_<span class="hljs-subst">$&#123;storyObj._id&#125;</span>`</span>&#125;   <span class="hljs-comment">// retrieve the _id from obj, which is the _id generated by MongoDB</span>  _id=&#123;storyObj.<span class="hljs-property">_id</span>&#125;   creator_name=&#123;storyObj.<span class="hljs-property">creator_name</span>&#125;  content=&#123;storyObj.<span class="hljs-property">content</span>&#125;  /&gt;</code></pre></div><ul><li>Pass the “_id” to the get query to retrieve related objects</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/comment&quot;</span>, &#123; <span class="hljs-attr">parent</span>: props.<span class="hljs-property">_id</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">comments</span>) =&gt;</span> &#123;    <span class="hljs-title function_">setComments</span>(comments);  &#125;);</code></pre></div><h3 id="Delete-Document">Delete Document</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Student</span>.<span class="hljs-title function_">deleteOne</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;)  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Deleted&quot;</span>))  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Error: <span class="hljs-subst">$&#123;error&#125;</span>`</span>));<span class="hljs-title class_">Student</span>.<span class="hljs-title function_">deleteMany</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;)   .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">student</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Deleted many documents&quot;</span>));  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Error: <span class="hljs-subst">$&#123;error&#125;</span>`</span>));</code></pre></div><h3 id="Update">Update</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Student</span>.<span class="hljs-title function_">findOne</span>(query)   .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">student</span>) =&gt;</span> &#123;     student.<span class="hljs-property">fieldToUpdate</span> = newValue;     student.<span class="hljs-title function_">save</span>()   &#125;);</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - Asynchronous Control</title>
    <link href="/2024/07/15/MIT_Weblab/async-control/"/>
    <url>/2024/07/15/MIT_Weblab/async-control/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><ul><li>Synchronous: Happening consecutively, one after another.</li><li>Asynchronous: Multiple processes can run at the same time.</li></ul><h2 id="Node-js">Node.js</h2><p>Node.js is an open-source, cross-platform JavaScript runtime environment that executes JavaScript code outside of a web browser.</p><ul><li>Single-Threaded Event Loop: Unlike traditional multi-threaded servers that spawn a new thread for each client, Node.js uses a single-threaded event loop to manage all client connections. The Event Loop continuously checks the event queue to see if there are any events to be handled.</li><li>Non-blocking I/O: Node.js performs I/O operations (like reading from a database) asynchronously. Instead of waiting for the operation to complete, Node.js registers a callback and moves on to handle the next event. This non-blocking behavior ensures that Node.js can handle many I/O operations concurrently without getting bogged down by slow operations</li></ul><h2 id="then">.then()</h2><h3 id="syntax">syntax</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> myStories = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/stories&#x27;</span>);<span class="hljs-title function_">setStories</span>(myStories);</code></pre></div><ul><li>the <code>get()</code> function returns a promise.</li><li><code>myStories</code> is a promise object immediately after this line runs. The promise represents an operation that hasn’t completed yet. JavaScript continues executing subsequent code without waiting for the promise to resolve.</li><li>setstories is called immediately with the promise <code>myStories</code>, not with the actual data that the promise will resolve to.</li></ul><p>Correct handling:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/stories&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">stories</span>) =&gt;</span> &#123;  <span class="hljs-title function_">setStories</span>(stories);&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error.<span class="hljs-property">message</span>);&#125;);</code></pre></div><p><code>.then((stories) =&gt; { ... })</code> sets up a handler that waits for the promise to resolve.</p><ul><li>If promise fulfilled, execute .then().</li><li>If promise rejected, execute .catch().</li></ul><h3 id="Async-of-promises">Async of promises</h3><p>Promises let us keep running other code:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;  <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/stories&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">stories</span>) =&gt;</span> &#123;    <span class="hljs-title function_">setStories</span>(stories);  &#125;)  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;do thing 1&quot;</span>);  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;do thing 2&quot;</span>);  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;do thing 3&quot;</span>);&#125;, []);</code></pre></div><ul><li>These <code>console.log</code> statements execute synchronously, meaning they run immediately after the API request is initiated but before the promise resolves.</li><li>When the <code>get</code> function is called, it returns a promise and initiates the asynchronous operation to fetch data. JavaScript does not wait for this operation to complete. Instead, it continues executing the subsequent lines of code immediately. This is known as non-blocking behavior.</li></ul><h3 id="Handling-multiple-promises">Handling multiple promises</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/comments&#x27;</span>, &#123; <span class="hljs-attr">parent</span>: parentId1 &#125;);<span class="hljs-keyword">const</span> promise2 = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/comments&#x27;</span>, &#123; <span class="hljs-attr">parent</span>: parentId2 &#125;);<span class="hljs-keyword">const</span> promise3 = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/comments&#x27;</span>, &#123; <span class="hljs-attr">parent</span>: parentId3 &#125;);<span class="hljs-keyword">const</span> promise4 = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/comments&#x27;</span>, &#123; <span class="hljs-attr">parent</span>: parentId4 &#125;);<span class="hljs-keyword">const</span> promise5 = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/comments&#x27;</span>, &#123; <span class="hljs-attr">parent</span>: parentId5 &#125;);<span class="hljs-keyword">const</span> promises = [promise1, promise2, promise3, promise4, promise5];<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">allResults</span>) =&gt;</span> &#123;  <span class="hljs-comment">// allResults represent a list with the result of each promise</span>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;  <span class="hljs-comment">// Catch and report any error</span>&#125;);</code></pre></div><ul><li>Returns a promise that resolves to array of results of input promises</li><li><strong>allResults</strong> represent a <strong>list</strong> with the result of each promise</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>(promises).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">firstResult</span>) =&gt;</span> &#123;  <span class="hljs-comment">// Do something with the first result</span>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;  <span class="hljs-comment">// Catch and report any error</span>&#125;);</code></pre></div><ul><li>Return a single Promise</li><li>This returned promise settles as soon as any of the promises in the iterable (list in this example) settles (either fulfills or rejects).</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>(promises).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">anyResult</span>) =&gt;</span> &#123;  <span class="hljs-comment">// Do something with the first fullfilled promise</span>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;  <span class="hljs-comment">// Catch and report any error</span>&#125;);</code></pre></div><ul><li>Return a sinfle Promise</li><li>This returned promise fulfills as soon as any of the promises in the iterable fulfills</li></ul><h2 id="await-and-async-keywords">await and async keywords</h2><ul><li>async function: declare a function to return a Promise.</li><li><strong>Only asynchronous functions can use await</strong>. Asynchronous function is defined by <code>async</code> keyword. Asynchronous functions return control back to the caller before computation is done.</li><li>await waits for the promise to resolve and uses that value</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">myFunction</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Start&#x27;</span>);  <span class="hljs-keyword">const</span> data1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&#x27;url1&#x27;</span>);  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Data 1:&#x27;</span>, data1);  <span class="hljs-keyword">const</span> data2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&#x27;url2&#x27;</span>);  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Data 2:&#x27;</span>, data2);  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;End&#x27;</span>);&#125;<span class="hljs-title function_">myFunction</span>();<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;After myFunction call&#x27;</span>);</code></pre></div><ul><li>When await is used, <strong>it pauses the execution of the async function</strong> until the awaited promise is resolved or rejected. This means that the lines of code following the await will not execute until the promise is settled. <strong>This “pause” is local to the async function where await is used.</strong></li><li>While the async function is paused, the rest of the JavaScript (outside the specific function) code can continue to run, i.e., <code>console.log('After myFunction call');</code>. This means other tasks, events, and functions can continue to execute, keeping the overall program responsive.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - Advanced CSS</title>
    <link href="/2024/07/14/MIT_Weblab/css/"/>
    <url>/2024/07/14/MIT_Weblab/css/</url>
    
    <content type="html"><![CDATA[<h2 id="CSS-Combinators">CSS Combinators</h2><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;child&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;c1&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>child 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;child&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;c2&quot;</span>&gt;</span>child 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;child&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;c3&quot;</span>&gt;</span>child 3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;child&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;c4&quot;</span>&gt;</span>child 4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h3 id="Descendent-Selector">Descendent Selector</h3><p>Selects all elements that are descendants (children, grandchildren, etc.) of a specified element:<br>All <code>&lt;div&gt;</code> inside class container, which are child 1, 2, 3, 4</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> <span class="hljs-selector-tag">div</span> &#123;    <span class="hljs-attribute">color</span>: blue; &#125;</code></pre></div><h3 id="Child-Selector">Child Selector</h3><p>Only direct <code>&lt;div&gt;</code> children of class container, which are child 2, 3, 4</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> &#123;    <span class="hljs-attribute">color</span>: blue; &#125;</code></pre></div><h3 id="Adjacent-Sibling-Selector">Adjacent Sibling Selector</h3><p>First div sibling after id c1, which are child 2</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-id">#c1</span> + <span class="hljs-selector-tag">div</span> &#123;    <span class="hljs-attribute">color</span>: blue; &#125;</code></pre></div><h3 id="General-Sibling-Selector">General Sibling Selector</h3><p>All div elements that are siblings of an id c1, which are child 2, 3, 4</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-id">#c1</span> ~ <span class="hljs-selector-tag">div</span> &#123;    <span class="hljs-attribute">color</span>: blue;&#125;</code></pre></div><h2 id="Display-Types">Display Types</h2><h3 id="Block">Block</h3><p>Block makes an element behave as a block-level element. Some elements have <code>display: block</code> by default: <code>&lt;div&gt;</code>, <code>&lt;p&gt;</code>, <code>&lt;h1&gt;</code> to <code>&lt;h6&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;section&gt;</code>, <code>&lt;nav&gt;</code></p><h3 id="Inline">Inline</h3><p>Inline elements do not start on a new line; they only take up as much width as necessary and can sit next to each other horizontally. <code>&lt;span&gt;</code>, <code>&lt;a&gt;</code>, <code>&lt;img&gt;</code> are inline by default.</p><h3 id="Flex">Flex</h3><p>Flex is a flexible box. It can control direction, sizing, distribution. All direct children of a flexible container becomes flexible items. <a href="https://www.w3schools.com/css/css3_flexbox_items.asp">See this demo</a>.</p><h3 id="Grid">Grid</h3><p>Grid containers consist of grid items, placed inside columns and rows. <a href="https://www.w3schools.com/css/css_grid_container.asp">See this demo</a>.</p><h3 id="None">None</h3><p>Tells the browser to remove an element from the document. Different from <code>visibility: hidden</code>, which hides the element but still takes up space in the layout.</p><h2 id="Content-Overflow">Content Overflow</h2><p>The overflow property specifies whether to <strong>clip the content</strong> or to <strong>add scrollbars</strong> when the content of an element is too big to fit in the specified area. <a href="https://www.w3schools.com/css/css_overflow.asp">see the demo</a>.</p><h2 id="Animations">Animations</h2><p>Syntax: use percentages to specify intermediate steps</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-keyword">@keyframes</span> animation-name &#123;  <span class="hljs-number">0%</span> &#123;    <span class="hljs-comment">/* initial styles */</span>  &#125;  <span class="hljs-number">50%</span> &#123;    <span class="hljs-comment">/* intermediate styles */</span>  &#125;  <span class="hljs-number">100%</span> &#123;    <span class="hljs-comment">/* final styles */</span>  &#125;&#125;</code></pre></div><p>Example:</p><div class="code-wrapper"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">div</span> class=&quot;<span class="hljs-attribute">container</span>&quot;&gt;  &lt;<span class="hljs-selector-tag">p</span>&gt; balabala &lt;/<span class="hljs-selector-tag">p</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;<span class="hljs-selector-class">.container</span> &#123;  <span class="hljs-attribute">animation</span>: fadeIn;  <span class="hljs-attribute">animation-duration</span>: <span class="hljs-number">5s</span>;  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-number">2s</span>;&#125;<span class="hljs-keyword">@keyframes</span> fadeIn &#123;  <span class="hljs-number">0%</span> &#123;    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;  &#125;  <span class="hljs-number">100%</span> &#123;    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;  &#125;&#125;</code></pre></div><ul><li>opacity changes from 0 to 1 in 5s, after 2s.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KMP Algorithm</title>
    <link href="/2024/07/07/MIT_Weblab/kmp/"/>
    <url>/2024/07/07/MIT_Weblab/kmp/</url>
    
    <content type="html"><![CDATA[<p>Leetcode 28:</p><p>Given two strings <code>needle</code> and <code>haystack</code>, return the index of the first occurrence of needle in <code>haystack</code>, or -1 if <code>needle</code> is not part of <code>haystack</code>.</p><h2 id="Introduction">Introduction</h2><p>Suppose text is <code>abbbbbbbbbbc</code>, and pattern is <code>abbbc</code>, to find the index of the first match, we start matching on index 0, 1, 2, …. The time complexity if <code>O(mn)</code>, where m is the length of text and n is the length of pattern.</p><div style="text-align: center;">  <img src="demo1.png" style="width: 300px; height: auto;" alt="Brute Force Approach"></div><h3 id="Why-KMP">Why KMP</h3><p>Observation: When there is a mismatch at index 4, and all characters match for previous indexes, where do we start the next match?</p><ul><li>In the pattern string, the first character <code>a</code> is not contained in index 1 ~ 3.</li><li>We have checked that index 0 ~ 3 is matched (same) for text and pattern string.</li><li>As a result, <code>a</code> will not appear in the index 1 ~ 3 at the text string, and we don’t need to re-match at index 1.</li></ul><p>Bad next match:</p><div style="text-align: center;">  <img src="demo3.png" style="width: 300px; height: auto;" alt="Bad Next Match"></div><p>We can re-match at the index 4, because there is no <code>a</code> for index 1 ~ 3 at text string.</p><div style="text-align: center;">  <img src="demo2.png" style="width: 300px; height: auto;" alt="Correct Next Match"></div><h3 id="Another-Example">Another Example</h3><p>Let’s see another example:</p><div style="text-align: center;">  <img src="ano1.png" style="width: 300px; height: auto;" alt="Another Example Start"></div><p>There is a mismatch at index 9:</p><div style="text-align: center;">  <img src="ano.png" style="width: 300px; height: auto;" alt="Mismatch at Index 9"></div><ul><li>The previous pattern: <code>abcxxab</code> matches the text, and mismatches occurs at index 9.</li><li>For the string before the mismatch index: <code>abcxxab</code>, there is a repeated pattern <code>ab</code>: <code>ab</code> occurs at the first two index and the last 2 index.</li><li>If we rematch at the index of the mismatch, we might lose a chance to get a full-match because the first two indexes of the pattern string, <code>ab</code>, also matches the <code>ab</code> at index 7 and 8 in the text string.</li><li>We rematch at the index 2 of the pattern string.</li></ul><div style="text-align: center;">  <img src="ano3.png" style="width: 300px; height: auto;" alt="Rematch Strategy"></div><h3 id="How-do-we-know-where-to-start-re-match">How do we know where to start re-match?</h3><p>Observe the previous example, we find that:</p><div style="text-align: center;">  <img src="exp.png" style="width: 300px; height: auto;" alt="Explanation"></div><ul><li><code>pattern[0:7]</code> matches <code>text[2:9]</code>, the index 9 does not match.</li><li>In pattern shring, <code>ab</code> is repeated in <code>abcxxab</code>.</li><li>As a result, <code>pattern[0:1]</code> matches <code>pattern[-2:0]</code>, which also matches <code>text[7:8]</code>.</li><li>We rematch for <code>pattern[2]</code> and <code>text[9]</code>.</li></ul><h2 id="Construct-“next”-Array">Construct “next” Array</h2><p>We need an array to indicate where to start re-matching if a mismatch occurs.</p><div style="text-align: center;">  <img src="next.png" style="width: 300px; height: auto;" alt="Next Array"></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] getNext(<span class="hljs-type">char</span>[] strArr) &#123;    <span class="hljs-type">int</span>[] next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[strArr.length];    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;    <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span> (j &lt; strArr.length) &#123;        <span class="hljs-keyword">if</span> (strArr[i] == strArr[j]) &#123;            next[j] = i+<span class="hljs-number">1</span>;            i++;            j++;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) &#123;                next[j] = i;                j++;            &#125; <span class="hljs-keyword">else</span> &#123;                i = next[i-<span class="hljs-number">1</span>];            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> next;&#125;</code></pre></div><h2 id="Match">Match</h2><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">strStr</span><span class="hljs-params">(String haystack, String needle)</span> &#123;    <span class="hljs-type">char</span>[] haystackArr = haystack.toCharArray();    <span class="hljs-type">char</span>[] needleArr = needle.toCharArray();    <span class="hljs-type">int</span>[] next = getNext(needleArr);    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;    <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> (haystack.length() &lt; needle.length()) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span> (i &lt; haystack.length()) &#123;        <span class="hljs-keyword">if</span> (haystackArr[i] == needleArr[j]) &#123;            <span class="hljs-keyword">if</span> (j == needle.length()-<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> i - j;            i++;            j++;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">if</span> (j == <span class="hljs-number">0</span>) &#123;                i++;            &#125; <span class="hljs-keyword">else</span> &#123;                j = next[j-<span class="hljs-number">1</span>];            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
      <tag>KMP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - APIs and Promises Introduction</title>
    <link href="/2024/07/05/MIT_Weblab/apis-promises/"/>
    <url>/2024/07/05/MIT_Weblab/apis-promises/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><ul><li>Client sends request to server, and server responds with result.</li><li>A server binds to a port on a computer. A computer can run multiple servers simultaneously, each server binds to a unique port.</li><li>Domain of my own computer: localhost. (<a href="http://localhost:3000">http://localhost:3000</a>)</li></ul><h2 id="APIs">APIs</h2><ul><li>API (Application Programming Interface). Interface can be thought of as a contract of service between two applications. This contract defines how the two communicate with each other using requests and responses.</li><li>Frontend makes http requests to the endpoints defined on the backend.</li></ul><h3 id="HTTP-S-Methods">HTTP(S) Methods</h3><ul><li>GET: Retrieves data from the server.</li><li>POST: Sends data to the server, often causing a change or creation of new data.</li><li>PUT: Replaces data on the server.</li><li>DELETE: Deletes data on the server.</li></ul><h4 id="HTTP-Request">HTTP Request</h4><ul><li>Request Target (URL) + Params: The endpoint and any parameters.</li><li>HTTP Method: The type of action (GET, POST, etc.).</li><li>Headers: Additional metadata for the request.</li><li>Body: The data sent with the request (for POST and PUT).</li></ul><h4 id="HTTP-Response">HTTP Response</h4><ul><li>Status Code: Indicates the result of the request.<ul><li>2xx: Success</li><li>4xx: Client errors</li><li>5xx: Server errors</li></ul></li><li>Headers: Metadata about the response.</li><li>Body: The data returned by the server.</li></ul><h3 id="Make-HTTP-Requests">Make HTTP Requests</h3><p>The <code>fetch()</code> function in JavaScript is used to make network requests.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url, options)</code></pre></div><ul><li><p>url: he URL to which the request is sent.</p></li><li><p>absolute url: e.g. <code>http://example.com/api/data</code></p></li><li><p>relative url: e.g. ‘api/data’ (relative to current page), ‘…/api/data’, ‘/api/data’ (relative to root)</p></li><li><p>options: the option object including properties like method, headers, body, mode</p></li></ul><h4 id="Get-Request">Get Request</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Helper code to make a get request. Default parameter of empty JSON Object for params.</span><span class="hljs-comment">// Returns a Promise to a JSON Object.</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">endpoint, params = &#123;&#125;</span>) &#123;  <span class="hljs-keyword">const</span> fullPath = endpoint + <span class="hljs-string">&quot;?&quot;</span> + <span class="hljs-title function_">formatParams</span>(params);  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(fullPath)    .<span class="hljs-title function_">then</span>(convertToJSON)    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;      <span class="hljs-comment">// give a useful error message</span>      <span class="hljs-keyword">throw</span> <span class="hljs-string">`GET request to <span class="hljs-subst">$&#123;fullPath&#125;</span> failed with error:\n<span class="hljs-subst">$&#123;error&#125;</span>`</span>;    &#125;);&#125;<span class="hljs-comment">// In front-end:</span><span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/comment&quot;</span>, &#123; <span class="hljs-attr">parent</span>: props.<span class="hljs-property">_id</span> &#125;) <span class="hljs-comment">// send the request</span></code></pre></div><ul><li>Parameters are passed as part of the URL in the query string for get request</li></ul><h4 id="Post-Request">Post Request</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Helper code to make a post request. Default parameter of empty JSON Object for params.</span><span class="hljs-comment">// Returns a Promise to a JSON Object.</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">endpoint, params = &#123;&#125;</span>) &#123;  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(endpoint, &#123;    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,    <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&quot;Content-type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span> &#125;,    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params),  &#125;)    .<span class="hljs-title function_">then</span>(convertToJSON) <span class="hljs-comment">// convert result to JSON object</span>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;      <span class="hljs-comment">// give a useful error message</span>      <span class="hljs-keyword">throw</span> <span class="hljs-string">`POST request to <span class="hljs-subst">$&#123;endpoint&#125;</span> failed with error:\n<span class="hljs-subst">$&#123;error&#125;</span>`</span>;    &#125;);&#125;<span class="hljs-comment">// In front-end:</span><span class="hljs-keyword">const</span> body = &#123; <span class="hljs-attr">content</span>: value &#125;;<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;api/story&quot;</span>, body)  <span class="hljs-comment">// send the request</span></code></pre></div><ul><li>Parameters are included in the request body as key-value pairs. The body can be in various formats (e.g., JSON, XML, form data), but JSON is common.</li><li><code>body</code>: The actual data sent with the request. <code>JSON.stringify(params)</code> converts the JavaScript object params into a JSON string.</li></ul><h3 id="Define-API-Endpoints">Define API Endpoints</h3><p>The following uses Express.js</p><p>When the backend receives a request to an API endpoint, it executes the corresponding route handler function to process the request, interact with the database, and send back a response.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<span class="hljs-comment">// get</span>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/stories&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  res.<span class="hljs-title function_">send</span>(data.<span class="hljs-property">stories</span>);&#125;);<span class="hljs-comment">// post</span>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/story&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-keyword">const</span> newStory = &#123;    <span class="hljs-attr">_id</span>: data.<span class="hljs-property">stories</span>.<span class="hljs-property">length</span>,    <span class="hljs-attr">creator_name</span>: myName,    <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">content</span>,  &#125;;  data.<span class="hljs-property">stories</span>.<span class="hljs-title function_">push</span>(newStory);  res.<span class="hljs-title function_">send</span>(newStory);&#125;);</code></pre></div><ul><li><p>req: The req object represents the HTTP request and contains information about the request that was made by the client. It can be used to access information about the incoming request.</p></li><li><p><strong>req.query</strong>: Extract the query parameters (for get request) from the query string in the URL</p></li><li><p><strong>req.body</strong>: Data sent in the body of the request (typically with POST, PUT, or DELETE requests).</p></li><li><p>res: The res object represents the HTTP response that an Express application sends when it receives a request.</p></li><li><p>res.send(): The parameter can be of different types, such as a string, Buffer, JSON object, array, etc.</p></li><li><p>res.status(404).send(‘Page not found’): First set status code and then send.</p></li><li><p>res.sendFile(path.join(reactPath, “index.html”)): send a file back</p></li></ul><h3 id="Middleware">Middleware</h3><p>Middleware: Run code in between receiving a request and running endpoint code. Middlewares are called in order of definition. Register middleware by calling app.use().</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();app.<span class="hljs-title function_">use</span>(path, middlewareFunction);</code></pre></div><ul><li>path (optinoal): Specifies the base path for the middleware function. If omitted, the middleware will be executed for every request to the app.</li><li>A function to execute for the given path.</li></ul><h4 id="Using-Middleware-to-route">Using Middleware to route</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// api.js</span><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/test&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;API Test Endpoint&#x27;</span>);&#125;);<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;</code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// server.js</span><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<span class="hljs-keyword">const</span> apiRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./api&#x27;</span>);app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>()); <span class="hljs-comment">// Middleware to parse JSON bodies</span>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api&#x27;</span>, apiRouter); <span class="hljs-comment">// Middleware to route /api paths to api.js</span>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server is running on port 3000&#x27;</span>);&#125;);</code></pre></div><p>When <code>http://localhost:3000/api/test</code> request is sent to the server, the following sequence happens:</p><ol><li>The JSON parsing middleware <code>express.json()</code> processes the request.</li><li>The request path <code>/api/test</code> is checked against the <code>apiRouter</code>, matches, and then the request is forwarded to <code>apiRouter</code>.</li><li>The router checks its defined routes and finds a match for GET <code>/test</code>, and the handler for <code>/test</code> is executed.</li></ol><h2 id="Promises">Promises</h2><h3 id="Async-Handling">Async Handling</h3><p>Get or Post returns a promise. <strong>Promises allow for asynchronous processing</strong>.</p><p>A bad example:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> myStories = <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/stories&#x27;</span>);<span class="hljs-title function_">setStories</span>(myStories);</code></pre></div><p>In this example, <code>get('/api/stories')</code> returns a promise, but setStories(myStories) is called immediately, before the promise has resolved. As a result, the immediately returned promise: myStories, will not contain any data.</p><p>Correct way to handle this:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/stories&#x27;</span>)  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;    <span class="hljs-title function_">setStories</span>(data); <span class="hljs-comment">// Set the stories with the fetched data</span>  &#125;)  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error fetching stories:&#x27;</span>, error); <span class="hljs-comment">// Handle any errors</span>  &#125;);</code></pre></div><ul><li><code>.then()</code> block waits for the promise to resolve. Once the data is fetched, the parsed <code>data</code> is then passed to <code>setStories(data)</code>. This also returns a promise.</li><li>The <code>.catch()</code> block handles any errors. Once the promise is rejected, do stuff (call a callback function). Returns a promise.</li><li>If the fetch is accepted, <code>.catch()</code> will not be executed. If the fetch is rejected, any <code>.then()</code> will not be executed.</li></ul><h2 id="Put-Together">Put Together</h2><p>Get request example:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// In frontend:</span><span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/comment&quot;</span>, &#123; <span class="hljs-attr">parent</span>: props.<span class="hljs-property">_id</span> &#125;)  <span class="hljs-comment">// send a get request to backend</span>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">comments</span>) =&gt;</span> &#123;      <span class="hljs-title function_">setComments</span>(comments);  &#125;); <span class="hljs-comment">// In backend:</span>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/comment&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-comment">// define the logic to handle the get request from url &quot;/api/comment&quot;</span>  <span class="hljs-keyword">const</span> filteredComments = data.<span class="hljs-property">comments</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">comment</span>) =&gt;</span> comment.<span class="hljs-property">parent</span> == req.<span class="hljs-property">query</span>.<span class="hljs-property">parent</span>);  res.<span class="hljs-title function_">send</span>(filteredComments); <span class="hljs-comment">// send responses back to the client</span>&#125;);</code></pre></div><p>The following happens sequentially:</p><ol><li>The <code>get</code> function sends a GET request to the backend at the endpoint “/api/comment” with a query parameter parent set to props._id.</li><li>The backend’s <code>router.get(&quot;/comment&quot;, (req, res) =&gt; { ... })</code> function is triggered by the incoming GET request to “/comment”.</li><li>The backend extracts the parent parameter from the query string using <code>req.query.parent</code>.</li><li>The backend constructs and sends the <code>filteredComments</code> array back to the frontend using <code>res.send(filteredComments)</code>.</li><li>The frontend’s promise, returned by the <code>get</code> function, resolves with the <code>filteredComments</code> array received from the backend.</li><li>The <code>.then((comments) =&gt; { ... })</code> method is called with <code>comments</code> as the argument, which is the <code>filteredComments</code> array.</li><li>setComments(comments) is called, triggering a re-render of the component with the new comments.</li></ol><p>Put request example:</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// In frontend:</span><span class="hljs-keyword">const</span> body = &#123; <span class="hljs-attr">parent</span>: props.<span class="hljs-property">storyId</span>, <span class="hljs-attr">content</span>: value &#125;;<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/comment&quot;</span>, body)  <span class="hljs-comment">// send a get request to backend</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">comment</span>) =&gt;</span> &#123;  props.<span class="hljs-title function_">addNewComment</span>(comment);&#125;);<span class="hljs-comment">// In backend:</span>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/comment&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;  <span class="hljs-keyword">const</span> newComment = &#123;    <span class="hljs-attr">_id</span>: data.<span class="hljs-property">comments</span>.<span class="hljs-property">length</span>,    <span class="hljs-attr">creator_name</span>: myName,    <span class="hljs-attr">parent</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">parent</span>,    <span class="hljs-attr">content</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">content</span>,  &#125;;  data.<span class="hljs-property">comments</span>.<span class="hljs-title function_">push</span>(newComment);  res.<span class="hljs-title function_">send</span>(newComment);&#125;);</code></pre></div><ul><li>The parameter of post request can be extracted by <code>req.body.xxx</code> in the backend.</li><li>The backend sends back the newComment to the client.</li><li><code>.then()</code> waits for the promise to resolve. The callback function defined in <code>.then()</code> takes the response as the parameter and makes changes.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - React Advanced</title>
    <link href="/2024/07/04/MIT_Weblab/react-advanced/"/>
    <url>/2024/07/04/MIT_Weblab/react-advanced/</url>
    
    <content type="html"><![CDATA[<h2 id="React-Lifecycle">React Lifecycle</h2><ol><li><strong>Trigger</strong>: First time component is called or State Change</li><li><strong>Render</strong>: React runs the Javascript code in component and calls subcomponents</li><li><strong>Commit</strong>: React puts returned JSX into HTML DOM to be served to viewer</li><li><strong>Unmounting</strong>: React Removes the component from DOM</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Steak</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">const</span> [doneness, setDoneness] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// Everything below are called again during re-render</span>  <span class="hljs-keyword">const</span> &#123; name, imgSrc &#125; = steakLookup[doneness];  <span class="hljs-keyword">const</span> sentence = <span class="hljs-string">`Here is your <span class="hljs-subst">$&#123;name&#125;</span> steak!`</span>;  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendToKitchen</span> = (<span class="hljs-params"></span>) =&gt; &#123;    <span class="hljs-title function_">setDoneness</span>(doneness + <span class="hljs-number">1</span>);  &#125;;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;sentence&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;imgSrc&#125;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">maxWidth:</span> &quot;<span class="hljs-attr">500px</span>&quot; &#125;&#125; /&gt;</span></span><span class="language-xml">      &#123;doneness &lt; 4 &amp;&amp; (</span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">fontSize:</span> &quot;<span class="hljs-attr">24px</span>&quot; &#125;&#125; <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;sendToKitchen&#125;</span>&gt;</span></span><span class="language-xml">          Send Back To Kitchen</span><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">      )&#125;</span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;</code></pre></div><p>When a state is updated, the javascript code in component is executed again, except the state definition lines (Non-state variables don’t persist!)</p><h2 id="React-Hooks">React Hooks</h2><h3 id="useEffect">useEffect()</h3><h4 id="Syntax">Syntax</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">useEffect</span>(  <span class="hljs-function">() =&gt;</span> &#123;    <span class="hljs-comment">/*</span><span class="hljs-comment">    Do something here,</span><span class="hljs-comment">    e.g. interacting with an external service</span><span class="hljs-comment">    */</span>    <span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/api/stories&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">storyObjs</span>) =&gt;</span> &#123;      <span class="hljs-title function_">setStories</span>(storyObjs);    &#125;);    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;&#125;;  &#125;,[<span class="hljs-comment">/* dependencies */</span>]);</code></pre></div><ul><li>Setting state (defined by <code>useState()</code> hook) is async</li><li><code>useEffect()</code> is used to run function every time a variable in dependency array changes</li><li>Commonly used to load external data into state</li><li>The return is a callback function that runs when the component dismounts, like cleanup function</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">myFunction</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-comment">// Do something</span>&#125;;<span class="hljs-title function_">useEffect</span>(myFunction, [var1, var2]); <span class="hljs-comment">// Calls myFunction every time var1 or var2 changes</span><span class="hljs-title function_">useEffect</span>(myFunction, []); <span class="hljs-comment">// Calls myFunction only once when the component is rendered for the first time (on mount)</span><span class="hljs-title function_">useEffect</span>(myFunction); <span class="hljs-comment">// Calls myFunction at every render (first component call + every time any state changes)</span></code></pre></div><h2 id="Router-Reach-Router">Router (Reach Router)</h2><p>Routers select a child to render based on the child’s path. The children are just other components that could be rendered on their own outside of a Router. We usually define the <code>&lt;Router&gt;</code> part in the <code>&lt;App&gt;</code> component.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span><span class="hljs-keyword">import</span> &#123; render &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Link</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reach/router&quot;</span><span class="hljs-keyword">let</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-keyword">let</span> <span class="hljs-title function_">Dash</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Dash<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-keyword">let</span> <span class="hljs-title function_">Team</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Team<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-title function_">render</span>(  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> /&gt;</span>  // root</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Dash</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;dashboard&quot;</span> /&gt;</span> // append &quot;dashboard&quot; to the end of the current url</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Team</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/team&quot;</span> /&gt;</span> // root + &quot;/team&quot;</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">NotFound</span> <span class="hljs-attr">default</span> /&gt;</span> // display the NotFound component if the URL is undefined</span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>)</code></pre></div><ul><li>The path <code>/</code> represents the homepage or the main entry point of the application.</li><li>This path starts with a <code>/</code> indicates it is an absolute path from the root of the application.</li></ul><h2 id="Link">Link</h2><p>We can add links to nav bars.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"></span>) =&gt; (  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;dashboard&quot;</span>&gt;</span>Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)<span class="hljs-keyword">let</span> <span class="hljs-title function_">Dash</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Dash<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-title function_">render</span>(  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> /&gt;</span> // root path</span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Dash</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;dashboard&quot;</span> /&gt;</span> // relative path</span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>)</code></pre></div><h2 id="Control-Flow">Control Flow</h2><p>How to dynamically render different JSX based on conditions? For example, I want a component looks different depending on the state value.</p><p>In JSX, we cannot directly use control flow statements like <code>if</code>, <code>for</code>, or <code>while</code> within the curly braces (<code>{}</code>). This is because these JavaScript control flow statements do not return a value. They are considered statements rather than expressions in JavaScript. The following ways can help us control what the component renders (What is inside JSX):</p><h3 id="Assign-JSX-fragements-to-JavaScript-variables">Assign JSX fragements to JavaScript variables</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outOfBandJSX</span>(<span class="hljs-params">option</span>) &#123;  <span class="hljs-keyword">var</span> optionJSX;  <span class="hljs-keyword">if</span> (option) &#123;    optionJSX = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Option was True<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;  &#125; <span class="hljs-keyword">else</span> &#123;    optionJSX  = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Option was False<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;  &#125;  <span class="hljs-keyword">var</span> listItems = [];  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;    listItems[i] = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;i&#125;</span>&gt;</span>List Item &#123;i&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;  &#125;  <span class="hljs-keyword">var</span> retVal =    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      &#123;optionJSX&#125;</span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><span class="language-xml">        &#123;listItems&#125;</span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;  <span class="hljs-keyword">return</span> retVal;&#125;</code></pre></div><ul><li>The function combines the conditional JSX fragment and the list of items into a single return value. The retVal variable is a JSX fragment that includes both the conditionally rendered optionJSX and the dynamically generated listItems. This JSX is returned by the function and can be rendered in the component.</li><li>Then we can include <code>{this.outOfBandJSX(true)}</code> or <code>{this.outOfBandJSX(false)}</code> in the JSX to effectively control what we want.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> greeting; <span class="hljs-keyword">const</span> en = <span class="hljs-string">&quot;Hello&quot;</span>; <span class="hljs-keyword">const</span> sp = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Hola<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span>; <span class="hljs-keyword">let</span> &#123;useSpanish&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span>; <span class="hljs-keyword">if</span> (useSpanish) &#123;greeting = sp&#125; <span class="hljs-keyword">else</span> &#123;greeting = en&#125;; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;greeting&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></code></pre></div><h3 id="Embedding-the-operations-inside-of-curly-braces">Embedding the operations inside of curly braces</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">return</span> (  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;loading ? &quot;Loading...&quot; : &quot;Actual page content&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>);</code></pre></div><ul><li>Although arbitrary JavaScript can appear inside braces, it must return a string or JSX expression to work. The <code>?:</code> operator always return a value.</li><li>If loading is true, it displays the text “Loading…”.</li><li>If loading is false, it displays “Actual page content”.</li></ul><h3 id="Short-circuit-boolean-operations">Short-circuit boolean operations</h3><div class="code-wrapper"><pre><code class="hljs jsx">&lt;div&gt;  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>A paragraph will appear between this paragraph<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>  &#123;    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">inputValue</span> &amp;&amp; (      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This text will appear when this.state.inputValue is truthy.</span><span class="language-xml">        this.state.inputValue === &#123;this.state.inputValue&#125;</span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>    )  &#125;  &lt;p&gt;... and <span class="hljs-variable language_">this</span> one when some characters are typed into the input box below.&lt;/p&gt;&lt;/div&gt;</code></pre></div><ul><li>If <code>this.state.inputValue</code> is true, the right-hand-side of <code>&amp;&amp;</code> will be executed, a new <code>&lt;p&gt;</code> element will be rendered. Else, nothing will be rendered.</li></ul><h2 id="Rendering-an-Array-of-Data">Rendering an Array of Data</h2><h3 id="Key">Key</h3><div class="code-wrapper"><pre><code class="hljs javascript">storiesList = stories.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">storyObj</span>) =&gt;</span> (  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span></span></span><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">Card_</span>$&#123;<span class="hljs-attr">storyObj._id</span>&#125;`&#125;</span></span><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">_id</span>=<span class="hljs-string">&#123;storyObj._id&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">creator_name</span>=<span class="hljs-string">&#123;storyObj.creator_name&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">content</span>=<span class="hljs-string">&#123;storyObj.content&#125;</span></span></span><span class="hljs-tag"><span class="language-xml">  /&gt;</span></span>));</code></pre></div><ul><li>the “key” prop is a special attribute you need to include when creating lists of elements. Keys help React identify which items have changed, are added, or are removed, improving efficiency of rendering</li><li>In this case, the key is a unique string that combines the word “Card_” with the unique identifier <code>_id</code> from the storyObj</li></ul><p>Return an array of html elements</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> data = [  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;My favorite food is doritos&quot;</span> &#125;,  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;I like nachos because they look like doritos&quot;</span> &#125;,];<span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span>&#123;item.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;&#125;);</code></pre></div><p>Return an array of components</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> data = [  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;My favorite food is doritos&quot;</span> &#125;,  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;I like nachos because they look like doritos&quot;</span> &#125;,];<span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ItemComponent</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span>&#123;item.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">ItemComponent</span>&gt;</span></span>);</code></pre></div><ul><li>Reasons for Using <code>key</code> in React Lists: This allows React to determine which elements have changed, added, or removed and to update only the necessary parts of the DOM. Without keys, React would need to re-render the entire list, which can be inefficient.</li></ul><h2 id="Input-using-DOM-like-handlers">Input using DOM-like handlers</h2><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;    <span class="hljs-variable language_">super</span>(props);    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;      <span class="hljs-attr">inputValue</span>: <span class="hljs-string">&#x27;&#x27;</span>    &#125;;  &#125;  handleChange = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">inputValue</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &#125;);  &#125;  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-keyword">return</span> (      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state.inputValue&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;this.handleChange&#125;</span> /&gt;</span></span>    );  &#125;&#125;</code></pre></div><ul><li><code>type=&quot;text&quot;</code>: This specifies that the input field is for text input.</li><li><code>value={this.state.inputValue}</code>: This binds the value of the input field to the <code>inputValue</code> property in the component’s state.</li><li>The <code>onChange</code> event is triggered every time the user types something in the input field.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - React Introduction</title>
    <link href="/2024/07/03/MIT_Weblab/react/"/>
    <url>/2024/07/03/MIT_Weblab/react/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>React is a JavaScript library for building user interfaces, particularly single-page applications.</p><p>React uses a virtual DOM to efficiently update the user interface. The Virtual DOM is an in-memory representation of the real DOM elements generated by React components. React updates the Virtual DOM whenever the state of a component changes and then determines the most efficient way to update the real DOM to match the Virtual DOM.</p><p>The React code is executed in the user’s browser, enabling the creation of more interactive and responsive applications. The applications can update the user interface quickly without needing to refresh the entire page or make frequent server requests.</p><h2 id="React-Key-Ideas">React Key Ideas</h2><h3 id="Components">Components</h3><ol><li>Divide the app into components, and put one in each file</li><li>Each component is a function that takes props as input and returns JSX (HTML-like code).</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// App.js</span><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> /&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Intro</span> /&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Photos</span> /&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Post</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;</code></pre></div><p>This code defines a React component named App (parent component) using an arrow function. The component returns a JSX structure that includes other components: NavBar, Intro, Photos, and Post (children components).</p><h3 id="Props">Props</h3><ol start="3"><li>We pass props from parent component to child component:</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// App.js</span>&lt;<span class="hljs-title class_">Post</span> name=<span class="hljs-string">&quot;Kenneth&quot;</span> text=<span class="hljs-string">&quot;Welcome to web lab!&quot;</span> /&gt; <span class="hljs-comment">// inside parent component</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Post.js</span><span class="hljs-keyword">const</span> <span class="hljs-title function_">Post</span> = (<span class="hljs-params">props</span>) =&gt; &#123;  <span class="hljs-comment">// child component</span>  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>&quot;Like&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;</code></pre></div><ul><li>React uses className instead of class for CSS style.</li><li><strong>What the component function returns is what to be rendered.</strong></li><li>What inside <code>return()</code> uses JSX syntax (HTML-like code).</li></ul><h3 id="JSX-Syntax">JSX Syntax</h3><ul><li>We can write HTML in JSX environment.</li><li>Parentheses <code>()</code> allow us to enter a JSX environment.</li><li><strong>Inside the JSX environment, curly braces <code>{}</code> allow us to create a mini JavaScript environment.</strong></li></ul><h3 id="State">State</h3><ol start="4"><li>State is data maintained by a component and is mutable. State can be kept in parent components so that it can be passed into reusable child components as props.</li></ol><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Post.js</span><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<span class="hljs-keyword">const</span> <span class="hljs-title function_">Post</span> = (<span class="hljs-params">props</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> [isLiked, setIsLiked] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// declare state variable in the Post component</span>  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><span class="language-xml">          setIsLiked(!isLiked);</span><span class="language-xml">        &#125;&#125;</span><span class="language-xml">      &gt;</span><span class="language-xml">        &#123;isLiked ? &quot;Liked&quot; : &quot;Like&quot;&#125;</span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;</code></pre></div><ul><li>When clicking on the <code>Like</code> button, the state variable <code>isLiked</code> will be changed to <code>true</code>, and “Liked” will be displayed.</li><li><code>useState(false)</code> returns two values. isLiked: The initial state value, set to false. setIsLiked: A function that lets you update the isLiked state.</li><li>Calling <code>setIsLiked(true)</code> will set isLiked to true and trigger a <strong>re-render</strong>.</li><li>**State variable can only be modified through the set function, i.e., we can’t do <code>isLiked = false</code>, we should do <code>setIsLiked(false)**</code>. Another example is that if a state is an array, and to add a new element to the array, we should do <code>setXXX(XXX.concat(data))</code> because <code>.concat()</code> will create a new array without directly modifying the original array.</li></ul><h3 id="Put-Together">Put Together</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// App.js</span><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">NavBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./NavBar&quot;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">Intro</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Intro&quot;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">Photos</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Photos&quot;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">Post</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Post&quot;</span>;<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> /&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Intro</span> /&gt;</span></span><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Photos</span></span></span><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">links</span>=<span class="hljs-string">&#123;[</span></span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic1.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic2.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic3.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic4.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic5.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic6.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">            &quot;<span class="hljs-attr">pic7.jpg</span>&quot;,</span></span><span class="hljs-tag"><span class="language-xml">          ]&#125;</span></span><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Post</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Songlin Zhao&quot;</span> <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;Welcome to my space!&quot;</span> /&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;</code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Photos.js</span><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<span class="hljs-keyword">const</span> <span class="hljs-title function_">Photos</span> = (<span class="hljs-params">props</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> myImageTags = props.<span class="hljs-property">links</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">photoLink</span>) =&gt;</span> &#123; <span class="hljs-comment">// map an array of string to an array of html contents</span>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;photoLink&#125;</span> /&gt;</span></span>;  &#125;);  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Photos<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">      &#123;myImageTags&#125;</span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Photos</span>;</code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Post.js</span><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<span class="hljs-keyword">const</span> <span class="hljs-title function_">Post</span> = (<span class="hljs-params">props</span>) =&gt; &#123;  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><span class="language-xml">          setIsLiked(!isLiked);</span><span class="language-xml">        &#125;&#125;</span><span class="language-xml">      &gt;</span><span class="language-xml">        &#123;isLiked ? &quot;Liked&quot; : &quot;Like&quot;&#125;</span><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  );&#125;;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Post</span>;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - JavaScript Basis</title>
    <link href="/2024/06/27/MIT_Weblab/javascript/"/>
    <url>/2024/06/27/MIT_Weblab/javascript/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><ul><li>Adding a Javascript file to HTML: <code>&lt;script src=&quot;snake.js&quot;&gt;&lt;/script&gt;</code> inside <code>&lt;head&gt;</code> section.</li><li>Any code that is not inside a function will run as soon as the script is loaded.</li><li>Any functions that are called in the global code will be executed <strong>in the order they appear</strong>.</li><li>When both files are included in the HTML with <code>&lt;script&gt;</code> tags, they share the same global scope. This allows functions and variables defined in one file to be accessible in the other.</li></ul><h3 id="Run-Javascript">Run Javascript</h3><div class="code-wrapper"><pre><code class="hljs bash">node code.js</code></pre></div><h3 id="Triggering-Javascript">Triggering Javascript</h3><h4 id="Inline-Event-Handlers">Inline Event Handlers</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;buttonClicked()&quot;</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">buttonClicked</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Button clicked!&quot;</span>);&#125;</code></pre></div><p>or</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;alert(&#x27;Button clicked!&#x27;)&quot;</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre></div><p>The onclick attribute in the <code>&lt;button&gt;</code> tag specifies JavaScript code to run when the button is clicked.</p><h4 id="Event-Listeners">Event Listeners</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myButton&quot;</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><span class="language-javascript">  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;myButton&quot;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><span class="language-javascript">    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Button clicked!&quot;</span>);</span><span class="language-javascript">  &#125;);</span><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><ul><li><code>document.getElementById('myButton')</code>: Selects the HTML element with the id myButton and returns a reference to the button element.</li><li><code>.addEventListener</code>: Attaches an event handler to the selected element.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;keydown&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">key</span>);&#125;);</code></pre></div><ul><li><code>window</code>: The global window object represents the window containing the DOM document.</li></ul><h4 id="Page-Load">Page Load</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><span class="language-javascript">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Page loaded!&quot;</span>);</span><span class="language-javascript">  &#125;;</span><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><ul><li>The code inside <code>window.onload</code> runs when the entire page has finished loading.</li></ul><h4 id="Timers">Timers</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;This alert appears after 3 seconds&quot;</span>);&#125;, <span class="hljs-number">3000</span>);<span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;This message appears every 2 seconds&quot;</span>);&#125;, <span class="hljs-number">2000</span>);</code></pre></div><h2 id="Syntax">Syntax</h2><h3 id="Data-Types">Data Types</h3><p>Primitive Types:</p><ul><li>boolean (true, false)</li><li>number (12, 1.3, -45.6, 0)</li><li>string (“Hello”)</li><li>null</li><li>undefined</li></ul><h3 id="Variables">Variables</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">&quot;John Doe&quot;</span>;<span class="hljs-keyword">let</span> age = <span class="hljs-number">30</span>;<span class="hljs-keyword">const</span> isStudent = <span class="hljs-literal">true</span>;</code></pre></div><ul><li>var: Declares a variable that can be globally or functionally scoped.</li><li>let: Declares a block-scoped variable, which means it is limited to the <code>{}</code> to which it is defined.</li><li>const: Declares a block-scoped variable that cannot be reassigned.</li></ul><h3 id="Operaters">Operaters</h3><ul><li><code>===</code>: Compares two values for equality without performing type conversion.</li><li><code>==</code>: Forcing the arguments to be of the same type before comparing them.</li></ul><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-number">5</span> == <span class="hljs-string">&quot;5&quot;</span>; <span class="hljs-comment">// true</span><span class="hljs-number">5</span> === <span class="hljs-string">&quot;5&quot;</span>; <span class="hljs-comment">// false</span><span class="hljs-string">&quot;hello&quot;</span> === <span class="hljs-string">&quot;hello&quot;</span>; <span class="hljs-comment">// true</span></code></pre></div><p><code>===</code> can only compare primitive types! For objects, <code>===</code> compares references to them.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<span class="hljs-keyword">let</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];arr1 === arr2; <span class="hljs-comment">// false</span></code></pre></div><h3 id="Arrays">Arrays</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> colors = [<span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-string">&quot;green&quot;</span>, <span class="hljs-string">&quot;blue&quot;</span>]; <span class="hljs-comment">// initialize</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(colors[<span class="hljs-number">1</span>]); <span class="hljs-comment">// &quot;green&quot;</span>colors[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;white&quot;</span>;colors.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// remove the last</span>colors.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;black&quot;</span>); <span class="hljs-comment">// add to the back</span>colors.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">&quot;purple&quot;</span>); <span class="hljs-comment">// add to the front</span></code></pre></div><h3 id="Conditional-Statements">Conditional Statements</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> time = <span class="hljs-number">20</span>;<span class="hljs-keyword">if</span> (time &lt; <span class="hljs-number">12</span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Good morning!&quot;</span>);&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (time &lt; <span class="hljs-number">18</span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Good afternoon!&quot;</span>);&#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Good evening!&quot;</span>);&#125;</code></pre></div><h3 id="Loops">Loops</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Number: &quot;</span> + i);&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">5</span>) &#123;  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Number: &quot;</span> + i);  i++;&#125;</code></pre></div><h3 id="Objects">Objects</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Objects is key-value pairs inside a &#123;&#125;</span><span class="hljs-keyword">let</span> person = &#123;  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;Songlin&quot;</span>,  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;Zhao&quot;</span>,  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,&#125;;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">age</span>); <span class="hljs-comment">// 30</span><span class="hljs-comment">// object destructing: obtain multiple properties at once</span><span class="hljs-keyword">const</span> &#123; firstName, lastName &#125; = person;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(firstName); <span class="hljs-comment">// &quot;Songlin&quot;</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastName); <span class="hljs-comment">// &quot;Zhao&quot;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// Array of objects</span><span class="hljs-keyword">const</span> snakeBody = [  &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">11</span> &#125;,  &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">12</span> &#125;,  &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">13</span> &#125;,];</code></pre></div><h4 id="Copying-two-objects">Copying two objects</h4><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<span class="hljs-keyword">let</span> copyArr = [...arr];<span class="hljs-keyword">let</span> obj = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Eric&quot;</span> &#125;;<span class="hljs-keyword">let</span> copyObj = &#123; ...obj &#125;;</code></pre></div><h3 id="Functions">Functions</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">addOne</span> = (<span class="hljs-params">num</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> result = num + <span class="hljs-number">1</span>;  <span class="hljs-keyword">return</span> result;&#125;;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">addOne</span>(<span class="hljs-number">4</span>)); <span class="hljs-comment">// Output: 5</span></code></pre></div><ul><li>Function is unmodifiable, so use <strong>const functionName</strong></li><li>(parameters) =&gt; {function contents}</li></ul><h3 id="Class">Class</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;  <span class="hljs-comment">// Constructor method to initialize the object</span>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;  &#125;  <span class="hljs-title function_">displayDetails</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Name: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>, Age: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.age&#125;</span>`</span>);  &#125;  <span class="hljs-comment">// Static method</span>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello!&#x27;</span>);  &#125;&#125;<span class="hljs-keyword">const</span> person1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-number">30</span>);person1.<span class="hljs-title function_">displayDetails</span>(); <span class="hljs-comment">// Output: Name: Alice, Age: 30</span><span class="hljs-title class_">Person</span>.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// Output: Hello!</span></code></pre></div><h2 id="Advanced">Advanced</h2><h3 id="Callback-Functions">Callback Functions</h3><p>Pass functions as parameters: Convert array of Celsius to Fahrenheit.</p><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">modifyArray</span> = (<span class="hljs-params">arr, func</span>) =&gt; &#123;  <span class="hljs-keyword">const</span> newArr = [];  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) &#123;    newArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">func</span>(arr[i]));  &#125;  <span class="hljs-keyword">return</span> newArr;&#125;;<span class="hljs-keyword">const</span> <span class="hljs-title function_">T2F</span> = (<span class="hljs-params">tempC</span>) =&gt; &#123;  <span class="hljs-keyword">return</span> (tempC * <span class="hljs-number">9</span>) / <span class="hljs-number">5</span> + <span class="hljs-number">32</span>;&#125;;<span class="hljs-keyword">const</span> tempsC = [<span class="hljs-number">0</span>, <span class="hljs-number">25</span>, <span class="hljs-number">100</span>];<span class="hljs-keyword">const</span> tempsF1 = <span class="hljs-title function_">modifyArray</span>(tempsC, <span class="hljs-variable constant_">T2F</span>);<span class="hljs-keyword">const</span> tempsF2 = <span class="hljs-title function_">modifyArray</span>(tempsC, <span class="hljs-function">(<span class="hljs-params">tempC</span>) =&gt;</span> (tempC * <span class="hljs-number">9</span>) / <span class="hljs-number">5</span> + <span class="hljs-number">32</span>); <span class="hljs-comment">// directly put the function in the parameter</span></code></pre></div><ul><li>When using <code>{}</code>, the return value should be specified by the <code>return</code> keyword.</li></ul><h3 id="map">map()</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> myArray = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<span class="hljs-keyword">const</span> newArray = myArray.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> num * <span class="hljs-number">3</span>;&#125;); <span class="hljs-comment">// newArray = [3,6,9,12,15]</span><span class="hljs-keyword">const</span> newArray = myArray.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> num * <span class="hljs-number">3</span>); <span class="hljs-comment">// equivalent</span></code></pre></div><ul><li>map() creates a new array.</li><li>map() applies the callback function to every element of the array.</li></ul><h3 id="filter">filter()</h3><div class="code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> values = [-<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<span class="hljs-keyword">const</span> filteredArray = values.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &gt; <span class="hljs-number">0</span>); <span class="hljs-comment">// filteredArray = [3,4,5]</span></code></pre></div><ul><li>filter() creates a new array.</li><li>filter() selects the element which passes the “test”.</li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell - How Shell Works</title>
    <link href="/2024/06/24/CS_Basis/Shell2/"/>
    <url>/2024/06/24/CS_Basis/Shell2/</url>
    
    <content type="html"><![CDATA[<h3 id="Configuration-file">Configuration file</h3><ul><li><code>~/.zshrc</code>: The primary config file for zsh</li><li><code>~/.bashrc</code>: The primary config file for bash (on linux systems)<br>The shell automatically reads (it “sources”) this file every time you open a new terminal. The source command is a built-in shell command that executes a script in the current shell session. For example, if the script exports a variable (e.g., export MY_VAR=“hello”), that variable becomes part of your current shell’s environment.</li></ul><h3 id="How-the-shell-executes-programs">How the shell executes programs</h3><p>When a command is entered in the shell, it follows these steps to execute:</p><ol><li><strong>Parsing:</strong> The shell reads the command line input and breaks it into components. <strong>The first word is the command (program), and the following words are arguments.</strong></li><li><strong>Command Lookup:</strong> The shell searches for the command in the directories listed in the <code>$PATH</code> environment variable.<div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span></code></pre></div></li><li><strong>Forking:</strong> The shell <strong>creates a new process</strong> (child process) to execute the command.</li><li><strong>Return:</strong> After the child process finishes, control returns to the user.</li></ol><h3 id="Executing-programs">Executing programs</h3><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>/Users/.../bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</code></pre></div><p>The <code>echo $PATH</code> command executes the program <code>echo</code>. The shell searches for it in the directories defined in <code>$PATH</code>. To find where the <code>echo</code> program resides:</p><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">which</span> <span class="hljs-built_in">echo</span><span class="hljs-built_in">echo</span>: shell built-in <span class="hljs-built_in">command</span></code></pre></div><p>Other examples:</p><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">which</span> <span class="hljs-built_in">ls</span>/bin/ls% <span class="hljs-built_in">which</span> <span class="hljs-built_in">mkdir</span>/bin/mkdir% <span class="hljs-built_in">which</span> npm/Users/.../bin/npm% <span class="hljs-built_in">which</span> python/opt/anaconda3/bin/python</code></pre></div><p>Check where is my python:</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">There are two python3 installed on my commputer</span><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">which</span> -a python3</span>/opt/miniconda3/bin/python3/usr/bin/python3<span class="hljs-meta prompt_"></span><span class="hljs-meta prompt_"># </span><span class="language-bash">But this <span class="hljs-built_in">command</span> only <span class="hljs-built_in">return</span> one</span><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">which</span> python3</span>/opt/miniconda3/bin/python3</code></pre></div><p><strong>When you have multiple versions of the same command, The shell executes the first one it finds, searching the directories in your <code>$PATH</code> from left to right.</strong></p><h3 id="Export">Export</h3><p>In Linux, every time you run a command or a script, the system creates a process. The child process won’t see the variables defined in parent process unless declared using <code>export</code>.</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">--worker.sh--</span><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>echo &quot;Starting worker in $APP_MODE mode on port $DB_PORT...&quot;</code></pre></div><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>export APP_MODE=&quot;production&quot;export DB_PORT=5432./worker.sh</code></pre></div><p>Without <code>export</code>, the process running <code>./worker.sh</code> won’t see the two variables.</p><h3 id="Types-of-Commands">Types of Commands</h3><ul><li><p>Built-in commands<br>A built-in command is a command that is part of the shell program itself. Examples: <code>cd, echo, exit, export, alias, pwd</code>.</p>  <div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">type</span> <span class="hljs-built_in">pwd</span></span>     pwd is a shell builtin</code></pre></div></li><li><p>External Commands<br>An external command is a separate program that exists as a file on your system. Examples: <code>ls, grep, git, python, node</code>.</p>  <div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">type</span> <span class="hljs-built_in">ls</span></span>ls is /bin/ls</code></pre></div></li></ul><h2 id="Advanced">Advanced</h2><h3 id="Redirection">Redirection</h3><p>In the shell, each program has an input stream and an output stream — by default, the keyboard and terminal. We can redirect input or output using <code>&lt; file</code> or <code>&gt; file</code>.</p><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, World&quot;</span> &gt; output.txt</code></pre></div><ul><li><code>echo &quot;Hello, World&quot;</code>: prints text to the terminal.</li><li><code>&gt;</code>: redirects output to the file specified on its right.</li></ul><p>Result: the text “Hello, World” is written to <code>output.txt</code>. <code>&gt;</code> overwrites a file, while <code>&gt;&gt;</code> appends to it.</p><h3 id="Pipes">Pipes</h3><p>Pipes (<code>|</code>) pass the output of one command as input to another.</p><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">ls</span> -l | grep <span class="hljs-string">&quot;.txt&quot;</span>-rw-r--r--  1 user  staff  13 Jun 24 16:18 output.txt</code></pre></div><p>Explanation:</p><ul><li><code>ls -l</code>: lists files in long format.</li><li><code>|</code>: passes output to the next command.</li><li><code>grep &quot;.txt&quot;</code>: filters for <code>.txt</code> files.</li></ul><p>Combining redirection and pipes:</p><div class="code-wrapper"><pre><code class="hljs bash">% <span class="hljs-built_in">ls</span> -l | grep <span class="hljs-string">&quot;.txt&quot;</span> &gt; txt_files_list.txt% <span class="hljs-built_in">cat</span> txt_files_list.txt-rw-r--r--  1 user  staff  13 Jun 24 16:18 output.txt-rw-r--r--  1 user  staff   0 Jun 24 16:34 txt_files_list.txt</code></pre></div><hr><h2 id="Useful">Useful</h2><h3 id="Alias">Alias</h3><div class="code-wrapper"><pre><code class="hljs bash">bash-3.2$ <span class="hljs-built_in">alias</span> gs=<span class="hljs-string">&quot;git status&quot;</span>bash-3.2$ gsOn branch mainnothing to commit, working tree cleanbash-3.2$ git statusOn branch mainnothing to commit, working tree clean</code></pre></div><p>To make an alias persistent, include it in configuration files like <code>.bashrc</code> or <code>.zshrc</code>.</p>]]></content>
    
    
    <categories>
      
      <category>Computer Basis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MIT Weblab笔记 - HTML &amp; CSS Basis</title>
    <link href="/2024/06/24/MIT_Weblab/html-css-basis/"/>
    <url>/2024/06/24/MIT_Weblab/html-css-basis/</url>
    
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><p>HTML provides the structure of the web pages, while CSS is used to control the layout of these pages.</p><h2 id="HTML">HTML</h2><h3 id="Structure">Structure</h3><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    # appears at the browser tabs    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Web Page<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    # link to the css file for styling    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;styles.css&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, World!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Welcome to my first web page.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><ul><li><code>&lt;head&gt;</code> contains meta-information about the document, such as its title, link to CSS files</li><li><code>&lt;body&gt;</code> contains the content that will be displayed on the web page.</li></ul><h3 id="Syntax">Syntax</h3><h4 id="Headings">Headings</h4><p><code>&lt;h1&gt;</code> to <code>&lt;h6&gt;</code>.</p><h4 id="Paragraphs">Paragraphs</h4><p><code>&lt;p&gt;</code>, start on new line.</p><h4 id="Divisions">Divisions</h4><p><code>&lt;div&gt;</code>, represents a block-level portion of a document such as a few paragraphs, or an image with its caption. Starts on new line.</p><h4 id="Sections">Sections</h4><p><code>&lt;section&gt;</code>, is used to group meaningful components, like introduction, about, ,etc. Starts on new line.</p><h4 id="Spans">Spans</h4><p><code>&lt;span&gt;</code> represents an <strong>inline</strong> portion of a document, for example words within a sentence.</p><h4 id="Lists">Lists</h4><p>Unordered Lists</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></code></pre></div><p>Ordered Lists</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item 3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></code></pre></div><h4 id="Links">Links</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;http://xxx&quot;</span>&gt;</span> content <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre></div><h4 id="Images">Images</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;image.png&quot;</span> /&gt;</span></code></pre></div><h3 id="Relative-Path">Relative Path</h3><p>A relative path points to a location that is relative to the current file’s location.</p><ul><li>Current Directory (<code>./</code>). It refers to the folder that contains the current file you’re working on. e.g. <code>&lt;img src=&quot;./image.jpg&quot;&gt;</code>, image.jpg is in the same directory as the HTML file or the script calling it.</li><li>Parent Directory (<code>../</code>)</li></ul><h2 id="CSS">CSS</h2><h3 id="Types">Types</h3><ul><li>Inline CSS<br>Using the style attribute:</li></ul><div class="code-wrapper"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">color</span>: red;&quot;&gt;This is <span class="hljs-selector-tag">a</span> heading&lt;/<span class="hljs-selector-tag">h1</span>&gt;</code></pre></div><ul><li>Internal CSS<br>Define within a <code>&lt;style&gt;</code> tag inside the HTML document’s <code>&lt;head&gt;</code> section:</li></ul><div class="code-wrapper"><pre><code class="hljs css">&lt;head&gt;  &lt;style&gt;    <span class="hljs-selector-tag">p</span> &#123;      <span class="hljs-attribute">color</span>: green;      <span class="hljs-attribute">font-family</span>: Arial, sans-serif;    &#125;  &lt;/style&gt;&lt;/head&gt;</code></pre></div><ul><li>External CSS<br>Define in a separate file:</li></ul><div class="code-wrapper"><pre><code class="hljs css">&lt;head&gt;  &lt;link rel=&quot;stylesheet&quot; href=&quot;styles<span class="hljs-selector-class">.css</span>&quot;&gt;&lt;/head&gt;</code></pre></div><h3 id="Syntax-2">Syntax</h3><p>Import fonts from <code>https://fonts.google.com/</code>.</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">&quot;[https://fonts.googleapis.com/css?family=Open+Sans:300,600](https://fonts.googleapis.com/css?family=Open+Sans:300,600)&quot;</span>);</code></pre></div><h4 id="Global-Definition">Global Definition</h4><p>Root variables, defining CSS custom properties (variables) for colors that can be reused throughout the stylesheet. Other parts of the css file can use it by <code>var(--grey)</code>.</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-pseudo">:root</span> &#123;  <span class="hljs-attr">--primary</span>: <span class="hljs-number">#396dff</span>;  <span class="hljs-attr">--grey</span>: <span class="hljs-number">#f7f7f7</span>;  <span class="hljs-attr">--white</span>: <span class="hljs-number">#fff</span>;  <span class="hljs-attr">--xs</span>: <span class="hljs-number">4px</span>;  <span class="hljs-attr">--s</span>: <span class="hljs-number">8px</span>;  <span class="hljs-attr">--m</span>: <span class="hljs-number">16px</span>;  <span class="hljs-attr">--l</span>: <span class="hljs-number">24px</span>;&#125;</code></pre></div><h4 id="Element">Element</h4><p>The style defined here automatically applies to the entire body of the document (inside <code>&lt;body&gt;</code> and <code>&lt;/body&gt;</code>).</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;Open Sans&quot;</span>, sans-serif;&#125;</code></pre></div><h4 id="Class">Class</h4><p>Style for class. <code>&lt;div class=&quot;navTitle&quot;&gt;</code>. <strong>An element can have multiple classes. Can use the same class on multiple elements.</strong></p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.navTitle</span> &#123;  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--primary);  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;  <span class="hljs-attribute">font-weight</span>: normal;&#125;</code></pre></div><h4 id="ID">ID</h4><p>Style for ID. <code>&lt;div id=&quot;unique&quot;&gt;</code>. An element can only have one ID. ID must be unique in any give HTML document.</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-id">#unique</span> &#123;  <span class="hljs-attribute">color</span>:red;  <span class="hljs-attribute">font-family</span>: Arial;&#125;</code></pre></div><h3 id="Style-Rules">Style Rules</h3><p>Priority:</p><ol><li>Inline Style</li><li>ID Attributes (<code>#unique {}</code>)</li><li>Classes (<code>.container {}</code>)</li><li>Elements (<code>div {}</code>)</li></ol><h2 id="Formatting-Techniques">Formatting Techniques</h2><h3 id="The-Box-Model">The Box Model</h3><ul><li>Margin: the space outside the element’s border.</li><li>Border: border surrounds the padding of the element.</li><li>Padding: the space between the element’s border and its content. It creates space inside the parent element, around the content area.</li></ul><div style="text-align: center;"><img src="box.png" style="width: 300px; height: auto;" alt="Box Model"></div><p>Margin and padding are transparent. Width and height are dimensions of the element.</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.xxClass</span> &#123;  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0px</span>;  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;&#125;</code></pre></div><p><strong>To inspect an element’s box model and other detailed attributes:</strong></p><p><strong>1. Open the browser</strong><br><strong>2. Inspect</strong><br><strong>3. Command + Shift + C</strong><br><strong>4. Click on the element to inspect</strong></p><div style="text-align: center;"><img src="inspect.png" style="width: 80%; height: auto;" alt="Inspect Element"></div><h3 id="Margin-Ordering">Margin Ordering</h3><p>Margin orders in the sequence of top, right, bottom, left</p><ol><li>margin: 10px;: All sides 10px</li><li>margin: 10px 20px;: top and bottom 10px, left and right 20px</li><li>margin: 10px 20px 30px;: top 10px, right 20px, bottom 30px, left 20px</li><li>margin: 10px 20px 30px 40px;: top 10px, right 20px, bottom 30px, left 40px</li></ol><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/margin">See this demo</a></p><h3 id="Positioning">Positioning</h3><p>In HTML, elements are typically laid out according to the normal document flow. This means they appear in the order they are defined in the HTML. If we want to explicitly set an element’s position, we can use the top, bottom, left, and right properties. However, these properties will not work unless the position property is set first.</p><p><a href="https://www.w3schools.com/css/css_positioning.asp">See this demo</a></p><ul><li>static: Default, position in document flow</li><li>relative: Position relative to default position via top, right, bottom, left properties</li><li>fixed: Position relative to the viewport, which means it always stays in the same place even if the page is scrolled</li><li>absolute: Position relative to the nearest positioned ancestor</li></ul><h3 id="Flex">Flex</h3><p>Flex is a flexible box. It can control direction, sizing, distribution. All direct children of a flexible container becomes flexible items. <a href="https://www.w3schools.com/css/css3_flexbox_items.asp">See this flex demo</a>.</p><div style="text-align: center;"><img src="flex.png" style="width: 50%; height: auto;" alt="Flex Example"></div><p>An example flex container defined in CSS:</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.flex-container</span> &#123;  <span class="hljs-attribute">display</span>: flex;  # this attribute makes this class <span class="hljs-selector-tag">a</span> <span class="hljs-attribute">flex</span> <span class="hljs-attribute">container</span>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f1f1f1</span>;&#125;</code></pre></div><h4 id="Order">Order</h4><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-container&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;order: 3&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;order: 2&quot;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;order: 4&quot;</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;order: 1&quot;</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h4 id="Sizing">Sizing</h4><p>Make the third flex item grow 2 times faster than the other flex items:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-container&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;flex-grow: 1&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;flex-grow: 1&quot;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;flex-grow: 2&quot;</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>Set the initial length of the third flex item to 200 pixels:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-container&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;flex-basis: 200px&quot;</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>An example of horizontal direction: The two sections are now in a row and evenly distributed in the flex container.</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;u-flex&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;subContainer u-textCenter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>About Me<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>      I am more of a turtle person but I&#x27;m just trying to fit in and get a catbook.    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;subContainer u-textCenter&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>My Favorite Type of Cat<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>      I actually prefer turtles.    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-class">.u-flex</span> &#123;  <span class="hljs-attribute">display</span>: flex;  <span class="hljs-comment">/* justify-content: space-between; */</span>&#125;<span class="hljs-selector-class">.subContainer</span> &#123;  <span class="hljs-attribute">flex-grow</span>: <span class="hljs-number">1</span>;  <span class="hljs-attribute">flex-basis</span>: <span class="hljs-number">0</span>;&#125;</code></pre></div><div style="text-align: center;">    <img src="flex1.png" style="width: 300px; height: auto;" alt="Flex Result"></div>]]></content>
    
    
    <categories>
      
      <category>MIT Weblab</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web Development</tag>
      
      <tag>CSS</tag>
      
      <tag>HTML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell - Basic Syntax</title>
    <link href="/2024/06/24/CS_Basis/Shell1/"/>
    <url>/2024/06/24/CS_Basis/Shell1/</url>
    
    <content type="html"><![CDATA[<h3 id="What-is-the-shell">What is the shell?</h3><p>A shell is a program that acts as the outermost layer of an operating system. It provides an interface for users to access the services of the kernel. It takes human-readable instructions and converts them into system calls that the kernel understands. The shell in macOS before Catalina is bash (Bourne Again Shell) and currently it’s Zsh (Z Shell). On most Linux distributions, the default shell is bash.</p><h3 id="Basic-shell-commands">Basic shell commands</h3><div class="code-wrapper"><pre><code class="hljs shell">. # current directory.. # parent directorylsmkdircd # change directorypwd # print working directoryecho &quot;text&quot; # prints the specified text to the terminalcat # displays the contents of the specified filetouch example.txt # creates a filegrep &quot;Hello&quot; example.txt # searches for the string “Hello” in a file named example.txt and returns the line containing itexport NODE_ENV=production # make a variable an environment variable</code></pre></div><h3 id="Basic-Bash-Syntax">Basic Bash Syntax</h3><p>Every shell script starts with a shebang line:</p><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-meta">#!/bin/bash</span></code></pre></div><p>This tells the system to run the script with Bash.</p><ul><li>Define variables</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">name=<span class="hljs-string">&quot;Alice&quot;</span> <span class="hljs-comment"># no space around &quot;=&quot;</span><span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$&#123;name&#125;</span>!&quot;</span></code></pre></div><p>In this example, <code>name</code> is variable name, <code>$name</code> represents getting the value of the variable.</p><ul><li>Command substitution</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">% <span class="hljs-built_in">date</span>Fri Oct 24 01:19:10 PDT 2025today=$(<span class="hljs-built_in">date</span>) <span class="hljs-comment"># $(date) runs the date command first, and replace it with its output</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Today is <span class="hljs-variable">$today</span>&quot;</span></code></pre></div><p><code>$()</code> means running a command and store its output.</p><ul><li>If statements</li></ul><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$age</span> -gt 18 ]; <span class="hljs-keyword">then</span>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Adult&quot;</span><span class="hljs-keyword">else</span>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Minor&quot;</span><span class="hljs-keyword">fi</span></code></pre></div><p>Common operators: <code>-eq, -ne, -gt, -ge, -lt, -le</code>.</p><ul><li>For loop</li></ul><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> item1 item2 item3; <span class="hljs-keyword">do</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$var</span>&quot;</span><span class="hljs-keyword">done</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> *.txt; <span class="hljs-keyword">do</span> <span class="hljs-comment"># get all *.txt in the current directory</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;file: <span class="hljs-variable">$f</span>&quot;</span><span class="hljs-keyword">done</span></code></pre></div><ul><li>While loop</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">count=1<span class="hljs-keyword">while</span> [ <span class="hljs-variable">$count</span> -le 5 ]; <span class="hljs-keyword">do</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Count <span class="hljs-variable">$count</span>&quot;</span>  ((count++))<span class="hljs-keyword">done</span></code></pre></div><ul><li>Arithmetic<br><code>(( ))</code> is used for arithmetic evaluation (like addition, subtraction, comparisons, and increments) in Bash.</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">((a = <span class="hljs-number">5</span> + <span class="hljs-number">3</span>))<span class="hljs-built_in">echo</span> <span class="hljs-variable">$a</span>   <span class="hljs-comment"># 8</span>((a++))((c += <span class="hljs-number">5</span>))((d *= <span class="hljs-number">2</span>))</code></pre></div><div class="code-wrapper"><pre><code class="hljs Bash">a=5b=3<span class="hljs-keyword">if</span> ((a &gt; b)); <span class="hljs-keyword">then</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a is greater&quot;</span><span class="hljs-keyword">fi</span><span class="hljs-keyword">for</span> ((i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">5</span>; i++)); <span class="hljs-keyword">do</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Number <span class="hljs-variable">$i</span>&quot;</span><span class="hljs-keyword">done</span></code></pre></div><ul><li>Functions</li></ul><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-function"><span class="hljs-title">greet</span></span>() &#123;    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$1</span>&quot;</span>&#125;greet <span class="hljs-string">&quot;Alice&quot;</span></code></pre></div><p><code>$1</code> refers to the first argument passed to the function.</p><ul><li>Special Functions<br><code>?</code> and <code>*</code> can be used to match one or any amount of characters respectively.</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">% <span class="hljs-built_in">ls</span>01 hstack.py04 mask.pybasic.ipynb02 transpose.py04 slicing.ipynb03 least-square.py05 histogram.py% <span class="hljs-built_in">ls</span> *.ipynb04 slicing.ipynbbasic.ipynb% <span class="hljs-built_in">ls</span> b?sic.ipynbbasic.ipynb</code></pre></div><p><code>{}</code> can be used when a set of strings have common substrings.</p><div class="code-wrapper"><pre><code class="hljs Bash">% <span class="hljs-built_in">mkdir</span> a b% <span class="hljs-built_in">touch</span> &#123;a,b&#125;/&#123;x,y,z&#125;<span class="hljs-comment"># The above command will create three files inside a and b folder (a/x, a/y, a/z, b/x, b/y, b/z) respectively.</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-built_in">mv</span> *&#123;.py,.ipynb&#125; dest<span class="hljs-comment"># Will move all *.py and *.ipynb files to folder dest</span></code></pre></div><ul><li>Exit Status<br>Every command in Linux returns an exit status. 0 means success, and non-zero means failure. <code>$?</code> is a special variable that stores the exit code of the most recent command.</li></ul><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-built_in">ls</span> /etc<span class="hljs-built_in">echo</span> $?   <span class="hljs-comment"># 0 = success</span><span class="hljs-built_in">ls</span> /no/such/file<span class="hljs-built_in">echo</span> $?   <span class="hljs-comment"># non-zero = error</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-keyword">if</span> <span class="hljs-built_in">ls</span> /no/such/file; <span class="hljs-keyword">then</span> <span class="hljs-comment"># if the ls command succeed, then print &quot;Command succeeded&quot;</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Command succeeded&quot;</span><span class="hljs-keyword">else</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Command failed&quot;</span><span class="hljs-keyword">fi</span></code></pre></div><h3 id="Tests">Tests</h3><p>Tests are used in conditional statements.</p><ul><li><code>-f file</code>, File exists and is a regular file</li></ul><div class="code-wrapper"><pre><code class="hljs Bash"><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;config.txt&quot;</span> ]; <span class="hljs-keyword">then</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Config file found&quot;</span><span class="hljs-keyword">else</span>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;No config file&quot;</span><span class="hljs-keyword">fi</span></code></pre></div><ul><li><code>-d file</code>, file is a directory</li><li><code>-z &quot;$str&quot;</code>, string is empty</li><li><code>-n &quot;$str&quot;</code>, string is not empty</li><li><code>&quot;$a&quot; != &quot;$b&quot;</code>, strings are not equal</li></ul><h4 id="Find-Files">Find Files</h4><div class="code-wrapper"><pre><code class="hljs Bash">find . -name src -<span class="hljs-built_in">type</span> d</code></pre></div><ul><li><code>find .</code>: Start searching in the current directory.</li><li><code>-name src</code>: Match directories named src.</li><li><code>-type d</code>: Ensure that the match is a directory.</li></ul><div class="code-wrapper"><pre><code class="hljs Bash">find . -path <span class="hljs-string">&#x27;*/test/*.py&#x27;</span> -<span class="hljs-built_in">type</span> f</code></pre></div><ul><li><code>-path ‘/test/.py’</code>: Match files where test appears as a directory in their path and the filename ends with .py (* can substitute any string).</li><li><code>-type f</code>: Ensure that the match is a regular file (not a directory).</li></ul><h3 id="Special-Parameters">Special Parameters</h3><ul><li><code>$0</code>, name of the current script</li><li><code>$1</code>, first parameter</li><li><code>$#</code>, number of parameters</li><li><code>$$</code>, current script’s process ID</li><li><code>$?</code>, exit status of the last command</li><li><code>$SHELL</code>, current shell path</li><li><code>$PATH</code>, directories to search for executables</li></ul>]]></content>
    
    
    <categories>
      
      <category>Computer Basis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>My first Blog</title>
    <link href="/2024/06/23/test/"/>
    <url>/2024/06/23/test/</url>
    
    <content type="html"><![CDATA[<h2 id="Post">Post</h2><h3 id="Create-a-new-post">Create a new post</h3><div class="code-wrapper"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;Name&quot;</span>$ hexo new post <span class="hljs-string">&quot;topic&quot;</span> --path <span class="hljs-string">&quot;folder/topic&quot;</span></code></pre></div><h3 id="Include-image-in-a-post">Include image in a post</h3><p>Move the image to the folder created automatically by Hexo, and then use the relative path to refer to the image.</p><p>Using hexo syntax, but unable to resize the image:</p><div class="code-wrapper"><pre><code class="hljs Markdown">&#123;% asset<span class="hljs-emphasis">_img sample.jpeg &#x27;This is my picture&#x27; %&#125;</span></code></pre></div><img src="/2024/06/23/test/sample.jpeg" class="" title="This is my picture"><p>Or directly use an <code>&lt;img&gt;</code> tag:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;sample.jpeg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 300px; height: auto;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Sample Image&quot;</span>&gt;</span></code></pre></div><img src="sample.jpeg" style="width: 300px; height: auto;" alt="Sample Image"><p>With centered alignment:</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;sample.jpeg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 300px; height: auto;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Sample Image&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><div style="text-align: center;">  <img src="sample.jpeg" style="width: 300px; height: auto;" alt="Sample Image"></div><hr><h2 id="Blog">Blog</h2><h3 id="Generate-static-files">Generate static files</h3><div class="code-wrapper"><pre><code class="hljs bash">$ hexo g</code></pre></div><h3 id="Run-server">Run server</h3><div class="code-wrapper"><pre><code class="hljs bash">$ hexo s</code></pre></div><h3 id="Deploy">Deploy</h3><div class="code-wrapper"><pre><code class="hljs bash">$ hexo d</code></pre></div><h3 id="Generate-and-Deploy">Generate and Deploy</h3><div class="code-wrapper"><pre><code class="hljs bash">$ hexo g -d</code></pre></div><h3 id="Post-Image">Post Image</h3><div class="code-wrapper"><pre><code class="hljs Markdown">index<span class="hljs-emphasis">_img: /img/test.jpeg</span><span class="hljs-emphasis">banner_</span>img: /img/sky<span class="hljs-emphasis">_castle.jpg</span></code></pre></div><h2 id="Create-a-new-page">Create a new page</h2><div class="code-wrapper"><pre><code class="hljs bash">$ hexo new page <span class="hljs-string">&quot;name&quot;</span></code></pre></div><h3 id="Creating-a-new-navigation-bar">Creating a new navigation bar</h3><ol><li>Create a new <code>.ejs</code> file in <code>/themes/fluid/layout/</code></li><li>Add page attributes in <code>_config.fluid.yml</code>, and include a new menu item inside <code>navbar.menu</code></li><li>Modify <code>/themes/fluid/languages/en.yml</code> to add titles and subtitles</li></ol>]]></content>
    
    
    <categories>
      
      <category>test</category>
      
    </categories>
    
    
    <tags>
      
      <tag>test</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
